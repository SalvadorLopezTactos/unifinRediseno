/*
 * Your installation or use of this SugarCRM file is subject to the applicable
 * terms available at
 * http://support.sugarcrm.com/06_Customer_Center/10_Master_Subscription_Agreements/.
 * If you do not agree to all of the applicable terms or do not have the
 * authority to bind the entity as an authorized representative, then do not
 * install or use this SugarCRM file.
 *
 * Copyright (C) SugarCRM Inc. All rights reserved.
 */(function(e){e.augment("config",{appId:"nomad",appVersion:"2.1.2",appBuild:"210/1008",brandName:"SugarCRM",env:"prod",debugSugarApi:!1,logLevel:"WARN",logWriter:"ConsoleWriter",logFormatter:"SimpleFormatter",showLogLevelSetting:!1,fastClickEnabled:!0,layoutCacheEnabled:!0,layoutCacheSize:10,disableLayoutCache:["login","associate","search","about","settings","pickerlist","TxLog"],pullToRefresh:!0,refreshOnResumeTimeout:3e4,viewAnimation:{enabled:!1,rules:{edit:"right-to-left",detail:"right-to-left",list:"right-to-left",pickerlist:"bottom-to-top"}},authStore:"cache",keyValueStore:"cache",cacheMeta:!0,minServerVersion:"6.7.1",supportedServerFlavors:["PRO","CORP","ENT","ULT"],siteUrl:"..",serverUrl:"../rest/v10",serverTimeout:30,hideLoginUrl:!1,allowUrlReconfigure:!1,clientID:"sugar",restVersion:"10",useHttps:!0,alertAutoCloseDelay:6e3,maxQueryResult:20,maxPageSize:60,alwaysShowMyItems:!1,platform:"mobile",metadataTypes:["server_info","labels","modules","relationships","currencies","_override_values","config","modules_info"],knownModules:["Home","Settings","About","TxLog","NomadErrors","Users","Accounts","Contacts","Documents","Leads","Opportunities","Meetings","Calls","Tasks","Notes","Reports","Cases","Quotes","Employees","Bugs","Campaigns","Contracts","KBDocuments","Products","Project","Prospects","Targets","Emails"],unsupportedModules:["Bugs","Campaigns","Contracts","KBDocuments","Products","Project","Prospects","Targets","Emails"],modulesWithFiles:["Documents"],modulesWithPDFs:["Reports"],nonDuplicatableModules:["Users","Documents","Employees","KBDocuments","Reports","Quotes","Emails"],nonCreatableModules:["TxLog","Users","Documents","Employees","KBDocuments","Reports","Quotes","Emails"],nonEditableModules:["KBDocuments","Quotes","Employees","Reports","Emails"],nonDeletableModules:["Users","Employees"],nonDeletableSalesStages:["Closed Won","Closed Lost"],nonLinkableModules:[],followableModules:["Accounts","Contacts","Leads","Opportunities","Cases","RevenueLineItems","Tasks","Notes","Products"],readonlyModules:["Teams","ProductTypes","ProductCategories","ProductTemplates","Manufacturers"],includeModuleBuckets:!1,includeUpcomingBuckets:!0,includeRecentBuckets:!0,activityItemsPerModule:3,numberOfAdditionalListFields:1,displayListFieldLabel:!1,displayDetailFieldLabel:!1,showAdditionalFieldsOnSearch:!1,supportEmail:"support@sugarcrm.com",displaySupportEmail:!1,url:{privacy:"http://www.sugarcrm.com/mobile_privacy",tos:"http://support.sugarcrm.com/06_Customer_Center/10_Master_Subscription_Agreements",trademark:"http://www.sugarcrm.com/about/trademark-information",support:"support.sugarcrm.com",sugarcrm:"http://www.sugarcrm.com"},analytics:{enabled:!1,id:{"native":"UA-33012372-5",web:"UA-33012372-6"},appName:"SugarCRM",optOut:!1,debug:!1,dryRun:!1,dispatchInterval:120,sessionTimeout:30,sampleRate:100,anonymize:!1,useHttps:!0},canvasTestModeOnUpload:!1,resizeImagesOnUpload:600,imageResizeTimeout:8e3,additionalComponents:{header:{target:"#header"}},syncConfig:!1,transMap:null,allowBrowserContextMenu:!1,skipStringCleanup:!1,emulateBackButton:!0,skipTutorial:!1,maxPreloaderPanelMessages:4,offline:{enabled:!1,storageProvider:"sql",storageAdapter:"native",storageSize:5,debug:{ignoreEnabled:!1,render:!1,forceMigrate:!1,online:!0,syncManagerEnabled:!0,monitorStatus:!0,outOfSpace:!1},minServerVersion:"7.1.5RC1",httpThrottlingEnabled:!0,httpThrottleTimeout:1e4,httpThrottleCacheSize:10,exclude:["About","Settings","Login","Offline","TxLog","NomadErrors","ErrorEmulation"],prefetch:{enabled:!0,staticModules:{Users:20,Teams:20,ProductCategories:20,ProductTypes:40,ProductTemplates:20,Manufacturers:20},maxThreshold:100,pageSize:20},syncManager:{enabled:!0,syncTimeout:10,executors:{wins:{enabled:!0,interval:180,priority:1,preSyncMaxRecords:100,syncPageSize:20,preSyncPageSize:20},txLog:{enabled:!0,interval:20,priority:0}}},defaultPurgeInterval:7,maxMixedCollectionQueryResult:30,monitorTimeout:5e3,txLogMaxQueryLimit:20,cleanupConfirmationInterval:6e4,periodicSync:{enabled:!1}},raven:{enabled:!0,url:"https://0c866dad58bb4a29b88e405491cfc6a6@app.getsentry.com/22007",env:"store"},errorEmulation:{enabled:!1,user:"Max"}},!1)})(SUGAR.App),function(e){e.raven={ravenDataCallback:function(t){return t.tags=_.extend(t.tags||{},{"native":e.isNative,osVersion:e.clientInfo?e.clientInfo.device.osVersion:undefined,uuid:e.clientInfo?e.clientInfo.device.uuid:undefined,device:e.clientInfo?e.clientInfo.device.model:undefined}),t.extra=_.extend(t.extra||{},{device:e.clientInfo?e.clientInfo.device.modelName:undefined,serverUrl:e.nomad?e.nomad.getServerUrl():undefined,serverVersion:e.nomad?e.nomad.getServerVersion():undefined}),t},ravenShouldSendCallback:function(){return e.config.raven.enabled},ravenReported:function(t){if(e.error){var n=t.data||{};e.error.logFatalError(n.message,n)}},setUser:function(e){Raven.setUser(e?{id:e}:null)}},e.config.raven&&e.config.raven.enabled&&!_.isEmpty(e.config.raven.url)&&(document.addEventListener("ravenSuccess",e.raven.ravenReported,!1),document.addEventListener("ravenFailure",e.raven.ravenReported,!1),Raven.config(e.config.raven.url,{tags:{version:e.config.appVersion,build:e.config.appBuild,env:e.config.raven.env},dataCallback:e.raven.ravenDataCallback,shouldSendCallback:e.raven.ravenShouldSendCallback}).install(),e.events.on("app:start",function(){e.raven.setUser(e.api.isAuthenticated()?e.user.get("id"):null)}).on("app:login:success",function(){e.raven.setUser(e.user.get("id"))}).on("app:logout",function(){e.raven.setUser()}))}(SUGAR.App),function(e){var t="SugarCRM",n=function(){},r={OAUTH:{},get:function(e){return this.OAUTH[e]},set:function(e,r){this.OAUTH[e]=r,window.plugins.keychain.setForKey(e,r,t,n,n)},cut:function(e){delete this.OAUTH[e],window.plugins.keychain.removeForKey(e,t,n,n)}};e.augment("keychain",r)}(SUGAR.App),function(e){e.view.NomadView=e.view.View.extend({globalEvents:{"acl:change":"onModelAclChange"},onModelAclChange:function(e){_.each(this.fields,function(t){var n=t.type==="address"?t.def.fields[0].name:t.name;n in e&&t.render()},this)},initialize:function(t){e.view.View.prototype.initialize.call(this,t),this.config=e.config},_render:function(){return this.onBeforeRender(),e.config.analytics.enabled&&e.analytics.detachAnalytics(this.$el),e.view.View.prototype._render.call(this),e.config.analytics.enabled&&e.analytics.attachAnalytics(this.$el),this.onAfterRender(),this},bindGlobalEvents:function(){var t=this._populateGlobalEvents(this);_.each(t,function(t,n){t=_.isFunction(t)?t:this[t],e.events.on(n,t,this)},this),_.each(this.fields,function(t){_.each(t.globalEvents,function(t,n){t=_.isFunction(t)?t:this[t],e.events.on(n,t,this)},t)})},unbindGlobalEvents:function(){var t=this._populateGlobalEvents(this);_.each(t,function(t,n){e.events.off(n,null,this)},this),_.each(this.fields,function(t){_.each(t.globalEvents,function(t,n){e.events.off(n,null,this)},t)})},_populateGlobalEvents:function(e){var t=[],n={},r=function(e,t){e&&(t.push(e.constructor.prototype.globalEvents),r(e.constructor.__super__,t))};return r(e,t),_.each(t.reverse(),function(e){n=_.extend(n,e)}),n},exit:function(t,n){e.isBackPressed=!n,t=_.isNumber(t)?t:parseInt(this.context?this.context.get("depth"):0,10)||1,e.router.go(-t)},initRelationshipFields:function(t,n){var r=e.data.getRelationshipFields(t,n);return r&&r.length&&(this.relationshipFields=_.map(r,function(t){return e.metadata.getModule(this.module).fields[t]},this)),this.relationshipFields},getFieldNames:function(t){var n=e.metadata.getModule(this.module,"mergedFields")||[];return this.model instanceof e.Bean&&this.model.canHaveAttachments()&&n.push("attachment_list"),this.relationshipFields&&(n=_.union(n,_.pluck(this.relationshipFields,"name"))),t&&(n=_.filter(n,function(t){var n=this._getFieldViewDef(t)||{};return e.acl.hasAccessToModel(this.action,this.model,t)&&n.type!=="fieldset"&&e.nomad.canDisplay(this,n)},this)),n},_getFieldViewDef:function(e){return _.find(this.meta.panels[0].fields,function(t){return t.name===e})},isEditView:function(){return this.action==="create"||this.action==="edit"},isCurrent:function(){return this.layout===e.controller.layout},onAfterRender:function(){},onAfterShow:function(){},onBeforeRender:function(){},getState:function(e){var t=this._getState();return e?t[e]:t},setState:function(e,t){var n=this._getState();n[e]=t,this._setState(n)},_getStateKey:function(){return this.name+"."+this.module},_getState:function(){return e.nomad.getSetting(this._getStateKey())||{}},_setState:function(t){e.nomad.setSetting(this._getStateKey(),t||{})},showRecordDeletedOverlay:function(t){document.activeElement&&document.activeElement.blur();var n=e.lang.getAppString(t.link?"LBL_OFFLINE_DELETED_RELATED":"LBL_OFFLINE_DELETED"),r=this.getHeaderData();r.save=!1,r.plus=!1,e.trigger("app:header:changed",r),this.$el.find(".overlay-view").length||this.$el.append("<div class='overlay-view'><span class='message'>"+n+"</span></div>")}})}(SUGAR.App),function(e){e.view.NomadField=e.view.Field.extend({delegateEvents:function(e){Backbone.View.prototype.delegateEvents.call(this,e)},initialize:function(t){t.view.name==="view"&&(t.viewName="readonly"),e.view.Field.prototype.initialize.call(this,t),t.view.name==="edit"&&(Boolean(this.def.calculated)&&Boolean(this.def.enforced)||Boolean(this.def.readonly))&&(t.viewName="readonly"),t.view.name==="detail"&&(this.showLabel=_.isUndefined(this.def.displayLabel)?_.isUndefined(t.view.meta.displayFieldLabel)?e.config.displayDetailFieldLabel:t.view.meta.displayFieldLabel:this.def.displayLabel)},handleValidationError:function(e){this.view.isCurrent()&&this._displayValidationMessage(e)},_displayValidationMessage:function(t){var n,r=[];this.$(".controls").children(".error-display").remove(),this.$(".control-group").removeClass("error"),t&&(this.$(".control-group").addClass("error"),_.each(t,function(t,n){r.push(e.error.getErrorString(n,t))}),n=e.template.get("edit-field-error"),this.$(".controls").append(n(r))),e.analytics.trackEvent("validation",this.name)},_render:function(){return this.onBeforeRender(),e.config.analytics.enabled&&e.analytics.detachAnalytics(this.$el),e.view.Field.prototype._render.call(this),this.onAfterRender(),e.config.analytics.enabled&&e.analytics.attachAnalytics(this.$el),this.hasAccess=this.getAccess(),this},getAccess:function(){var t=this.options.def.view||this.options.viewName||(this.view.meta&&this.view.meta.type?this.view.meta.type:this.view.name),n=t!==this.view.action?this.view.action:t;return e.acl.hasAccessToModel(n,this.model,this.name)},onBeforeRender:function(){},onAfterRender:function(){},unformat:function(e){return _.isString(e)?e.trim():e},isReadOnly:function(){return this.tplName==="readonly"},isDisabled:function(){return this.action==="readonly"},bindDomChange:function(){if(!(this.model instanceof Backbone.Model))return;var e=this.$el.find(this.fieldTag);e.on("change",_.bind(this.onFieldChange,this)),this._$fieldEl=e},onFieldChange:function(){this.model.set(this.name,this.unformat(this._$fieldEl.val()))},bindDataChange:function(){this.model&&this.model.on("change:"+this.name,function(e,t,n){if(n&&n.disableRenderForContext===this.view)return!1;this.render()},this)}})}(SUGAR.App),function(e){e.view.NumericField=e.view.NomadField.extend({isFloat:!1,format:function(t){return!t&&t!==0||_.isString(t)&&t.trim().length===0?"":(isNaN(t)||(t=e.utils.formatNumber(t,null,this.isFloat?this.def.precision||e.user.getPreference("decimal_precision"):0,this.def.number_group_seperator||e.user.getPreference("number_grouping_separator"),this.def.decimal_seperator||e.user.getPreference("decimal_separator")),this.isFloat&&this.model.set(this.name,this.unformat(t),{silent:!0})),t)},unformat:function(t){var n=e.utils.unformatNumberStringLocale(t.toString(),this.isFloat);return n===""||isNaN(n)?t:n}})}(SUGAR.App),function(e){function i(e){return e.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var t=/-|,| |;/g,n={};e.offline&&(n[e.offline.SYNC_ACTIONS.CREATE]="LBL_ACTION_CREATE",n[e.offline.SYNC_ACTIONS.UPDATE]="LBL_ACTION_UPDATE",n[e.offline.SYNC_ACTIONS.DELETE]="LBL_ACTION_DELETE",n[e.offline.SYNC_ACTIONS.LINK]="LBL_ACTION_LINK",n[e.offline.SYNC_ACTIONS.UNLINK]="LBL_ACTION_UNLINK",n[e.offline.SYNC_ACTIONS.FAVORITE]="LBL_ACTION_FAVORITE",n[e.offline.SYNC_ACTIONS.FOLLOW]="LBL_ACTION_FOLLOW");var r={};e.offline&&(r[e.offline.SYNC_ACTIONS.CREATE]="LBL_ACTION_CREATE_EXPLANATION",r[e.offline.SYNC_ACTIONS.UPDATE]="LBL_ACTION_UPDATE_EXPLANATION",r[e.offline.SYNC_ACTIONS.DELETE]="LBL_ACTION_DELETE_EXPLANATION",r[e.offline.SYNC_ACTIONS.LINK]="LBL_ACTION_LINK_EXPLANATION",r[e.offline.SYNC_ACTIONS.UNLINK]="LBL_ACTION_UNLINK_EXPLANATION",r[e.offline.SYNC_ACTIONS.FAVORITE]="LBL_ACTION_FAVORITE_EXPLANATION",r[e.offline.SYNC_ACTIONS.FOLLOW]="LBL_ACTION_FOLLOW_EXPLANATION");var s=function(){var t=function(t){var n,r,i=e.serverInfo.isSevenUp;i?(n=/<strong>.*?<\/strong>/g,r=/(<strong>)|(<\/strong>)/g):(n=/<span class="highlight">.*?<\/span>/g,r=/(<span class="highlight">)|(<\/span>)/g);var s=Handlebars.Utils.escapeExpression,o=s(t),u=t.match(n),a;return _.each(u,function(e){a=e.replace(r,""),a=s(a),o=o.replace(s(e),'<span class="highlight">'+a+"</span>")}),o};return Handlebars.helpers.__sanitizeSearchResult=t,t}();Handlebars.registerHelper("shouldDisplay",function(t,n){return e.nomad.canDisplay(t,this)?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("ifHasAccessToModel",function(t,n,r){var i=r.hash.field;return e.acl.hasAccessToModel(t,n,i)?r.fn(this):r.inverse(this)}),Handlebars.registerHelper("moduleNameSingular",function(t){return e.nomad.getSingularModuleName(t)}),Handlebars.registerHelper("optionLabel",function(t,n){var r=_.isString(t)?e.lang.getAppListStrings(t):t;return r[n]}),Handlebars.registerHelper("globalSearchItem",function(n){var r=n.searchInfo,o=r?r.highlighted:null,u=Handlebars.Utils.escapeExpression(n.get("name")),a="",f=r?r.isOffline:!1;if(o){_.each(o,function(t,n){var r=s(t.text);n==="name"?u='<div class="clip">'+r+"</div>":a+='<div class="search-result clip">'+e.lang.get(t.label,t.module)+": "+r+"</div>"},this);var l=_.isEmpty(a)?u:'<div class="clip">'+u+"</div>"+a;return new Handlebars.SafeString(l)}var c="",h,p,d,v,m=", ",g,y=(n.collection.query||"").trim(),b="",w="";return y&&(g=e.serverInfo.fts.enabled&&e.metadata.getModule(n.module).ftsEnabled,v=new RegExp("("+i(Handlebars.Utils.escapeExpression(y))+")","i"),g&&(p=_.filter(y.split(t),function(e){return!!e}),d=new RegExp("("+i(Handlebars.Utils.escapeExpression(p.toString().replace(/,/g,"|")))+")","i")),w=b=Handlebars.Utils.escapeExpression(n.get("name")),y=Handlebars.Utils.escapeExpression(y),_.each(n.attributes,function(e,t){var r=n.fields[t];r&&(_.isString(e)||_.isNumber(e))&&(e=_.isNumber(e)?""+e:e,e=Handlebars.Utils.escapeExpression(e),!f&&g&&r.full_text_search?(h=e.match(d),h&&(t&&t.indexOf("name")>-1&&b.indexOf(e)>-1?w=b.replace(d,"<b>$1</b>"):c+=e.replace(d,"<b>$1</b>")+m)):(!g&&r.unified_search||t==="name"||f&&(r.full_text_search||r.unified_search))&&y&&e.toString().toLowerCase().indexOf(y.toLowerCase())===0&&(h=e.match(v))&&(t&&t.indexOf("name")>-1&&b.indexOf(e)>-1?w=b.replace(h[0],"<b>"+h[0]+"</b>"):c+=e.replace(h[0],"<b>"+h[0]+"</b>")+m))},this),c&&(c=c.substr(0,c.length-2),w+=m),c=w+c),new Handlebars.SafeString(c)}),Handlebars.registerHelper("getTxLogActionName",function(t){t=n[t];var r=e.lang.getAppString(t)||t;return new Handlebars.SafeString(r)}),Handlebars.registerHelper("getTxLogModuleName",function(){return e.nomad.getPluralModuleName(this.model.attributes._tx_bean_module)}),Handlebars.registerHelper("getTxLogActionExplanation",function(){var t=this.model.attributes._tx_action,n,i=this.model.attributes.bean,s={module:e.nomad.getSingularModuleName(this.model.attributes._tx_bean_module),name:i?i.name:e.lang.get("LBL_RECORD_DELETED")};t===e.offline.SYNC_ACTIONS.FAVORITE&&!this.model.attributes._tx_updated_fields.my_favorite.after?n="LBL_ACTION_UNFAVORITE_EXPLANATION":t===e.offline.SYNC_ACTIONS.FOLLOW&&!this.model.attributes._tx_updated_fields.following.after?n="LBL_ACTION_UNFOLLOW_EXPLANATION":this.model.attributes.related&&(s.relatedModule=e.nomad.getSingularModuleName(this.model.attributes._tx_related_module),s.relatedName=this.model.attributes.related.name,t===e.offline.SYNC_ACTIONS.CREATE&&(n="LBL_ACTION_CREATE_RELATED_EXPLANATION")),n=n||r[t]||"Unknown action",s.relatedName=s.relatedName||e.lang.get("LBL_RECORD_DELETED"),s.relatedModule=s.relatedModule||e.nomad.getSingularModuleName(this.model.attributes._tx_related_module);var o=e.lang.get(n,null,s);return new Handlebars.SafeString(o)}),Handlebars.registerHelper("getTxLogItemStatusClass",function(){var t;if(this.model.attributes._tx_error_count){var n=parseInt(this.model.attributes._tx_error,10),r=e.offline.TRANSACTION_STATUSES.UNRECOVERABLE;t=_.indexOf(r,n)>-1?"error":"warning"}return t}),Handlebars.registerHelper("getErrorDescription",function(t){var n=t;switch(t){case"403":n=e.lang.getAppString("ERR_MOBILE_NOT_AUTHORIZED");break;case"409":n=e.lang.getAppString("ERR_OFFLINE_SYNC_CONFLICT");break;case"412":n=e.lang.getAppString("ERR_MOBILE_METADATA_CHANGED");break;case"500":n=e.lang.get("ERR_MOBILE_INTERNAL",null,{code:t})}return new Handlebars.SafeString(n)}),Handlebars.registerHelper("teamSearchItem",function(e){var t,n,r="",s="",o=(e.collection.query||"").trim();return o&&(n=new RegExp("("+i(Handlebars.Utils.escapeExpression(o))+")","i"),_.each(["name","name_2"],function(i){s=e.get(i),t=s.match(n),t?r+=s.replace(t[0],"<b>"+t[0]+"</b>"):r+=s,r+=" "})),new Handlebars.SafeString(r)}),Handlebars.registerHelper("humanFileSize",function(t){var n=e.nomad.utils.humanFileSize(t);return n===null?e.lang.get("LBL_NOT_AVAILABLE"):n.toString(!0)}),Handlebars.registerHelper("ifShowAdditionalFieldsOnSearch",function(t){var n=this.model.collection.query;return n?e.config.showAdditionalFieldsOnSearch?t.fn(this):t.inverse(this):t.fn(this)}),Handlebars.registerHelper("include",function(t,n,r,i){var s=i.hash.fields||r.viewDefs[i.hash.module],o=r.options.templateOptions&&r.options.templateOptions.partials?r.options.templateOptions.partials[t]:e.template.get(t);return new Handlebars.SafeString(o({model:n,view:r,context:r.context||e.controller.context,fields:s}))}),Handlebars.registerHelper("partial",function(t,n,r){var i=r.hash.view,s=i&&i.options.templateOptions&&i.options.templateOptions.partials?i.options.templateOptions.partials[t]:e.template.get(t);return new Handlebars.SafeString(s?s(n):"")}),Handlebars.registerHelper("emailPlaceholder",function(t,n){return e.lang.get(t&&t.length?"LBL_EMAIL_ADD":n.hash.required?"":"LBL_OPTIONAL")}),Handlebars.registerHelper("primaryEmail",function(e){return e&&e.length?e[0].email_address:""}),Handlebars.registerHelper("buildRoute",function(t,n){var r,i=n.hash.action,s=n.hash.link;return s?r=e.nomad.buildLinkRoute(t.link.bean.module,t.link.bean.id,s,t.id,i):r=e.router.buildRoute(t.module,t.id,i),new Handlebars.SafeString(r)}),Handlebars.registerHelper("ifHasValue",function(e,t,n){return e.get(t)?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("imageUrl",function(t,n){function i(){var i=e.api.buildFileURL({field:r.name,module:t.module,id:t.id},e.nomad.getFileOptions());return n&&(i+="&ts="+(new Date).getTime()),i}var r=this;return r&&t.get(r.name)?i():""}),Handlebars.registerHelper("moduleIconLabel",function(t){var n=e.lang.getAppListStrings("moduleIconList")[t]||e.lang.getAppListStrings("moduleListSingular")[t]||e.lang.getAppListStrings("moduleList")[t]||t,r=n.indexOf(" ");return r!==-1?n.substring(0,1)+n.substring(r+1,r+2):n.substring(0,2)}),Handlebars.registerHelper("iterate",function(e,t){var n="",r;return _.isObject(e)&&(r=function(e,r){n+=t.fn({key:r,value:e})}),_.each(e,r,this),new Handlebars.SafeString(n)}),Handlebars.registerHelper("favoriteable",function(t,n){var r,i;t instanceof Backbone.Model?(r=t.module,i={isFavorite:t.get("my_favorite")}):(r=t,i={});var s=r&&e.nomad.supportsFavs(r)?n.fn(i):"";return r.toLowerCase()==="home"&&(s=n.fn(this)),new Handlebars.SafeString(s)}),Handlebars.registerHelper("join",function(e,t){var n=t.hash.delimiter||",",r=t.hash.start||0,i=e?e.length:0,s=t.hash.end||i,o="";s>i&&(s=i);if(_.isFunction(t.fn)){for(var u=r;u<s;u++)u>r&&(o+=n),_.isString(e[u])?o+=e[u]:o+=t.fn(e[u]);return o}return[].concat(e).slice(r,s).join(n)}),Handlebars.registerHelper("joinPrimaryFirst",function(e,t){var n=_.sortBy(e,function(e){return!e.primary});return Handlebars.helpers.join(n,t)}),Handlebars.registerHelper("multienumStr",function(t,n){var r="",i=", ";if(n&&n.length){var s=_.isString(t)?e.lang.getAppListStrings(t):t;n=_.isString(n)?n.replace(/(\^)/g,"").split(","):n,_.each(n,function(e){s[e]&&(r+=s[e]+i)})}return r&&(r=r.substr(0,r.length-2)),new Handlebars.SafeString(r)}),Handlebars.registerHelper("multienumLabels",function(t,n,r){var i="";if(n&&n.length){var s=_.isString(t)?e.lang.getAppListStrings(t):t;_.each(n,function(e){s[e]&&(i+=r.fn({id:e,name:s[e]}))})}return i&&(i=i.substr(0,i.length-2)),new Handlebars.SafeString(i)}),Handlebars.registerHelper("fieldWithName",function(t,n,r,i,s){var o=e.view.createField({view:i,model:r,def:{type:n,name:t,view:s.hash.tpl}});return o.getPlaceholder()}),Handlebars.registerHelper("prop",function(t,n,r){return _.isString(t)&&(t=e.lang.getAppListStrings(t)),t[n]?t[n]:_.isUndefined(r.hash.defaultValue)?e.nomad.isEmptyValue(n)?"":n:r.hash.defaultValue}),Handlebars.registerHelper("nl2",function(e,t){var n=t.hash.str||" ";return e.replace(/\n|\r|\t/,n)}),Handlebars.registerHelper("ifHasValueAndReadAccessToParent",function(t){var n=this.model.get("parent_type");return!_.isEmpty(this.value)&&e.acl.hasAccess("read",n)&&_.isObject(e.metadata.getModule(n))?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("ifFewCurrenciesAreAvailable",function(t){var n=_.some(e.metadata.getCurrencies(),function(e){return e.status==="Active"});return n?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("isEmpty",function(t,n){return e.nomad.isEmptyValue(t)?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("isNotEmpty",function(t,n){return e.nomad.isEmptyValue(t)?n.inverse(this):n.fn(this)}),Handlebars.registerHelper("withObjectProp",function(e,t,n){var r="";return e.hasOwnProperty(t)&&(r+=n.fn(e[t])),r}),Handlebars.registerHelper("checkDisplayListFields",function(t,n){return t.length!==1||e.config.displayListFieldLabel?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("ifFeatureSupported",function(t,n){return e.supportedFeatures[t]?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("brandName",function(){return e.config.brandName||"SugarCRM"}),Handlebars.registerHelper("html2text",function(e,t){var n=/(<([^>]+)>)/ig,r=e.replace(n,"").replace(/\s\s+/g," ");return r.length>=t&&(r=r.substr(0,t)),r&&(r+="..."),r}),Handlebars.registerHelper("ternary",function(e,t,n){return e?t:n}),Handlebars.registerHelper("eachPair",function(e,t){var n="";for(var r=0;r<e.length;r++)n+=t.fn({key:e[r],value:e[++r]});return new Handlebars.SafeString(n)})}(SUGAR.App),function(e){e.view.NomadLayout=e.view.Layout.extend({searchBoxName:"search-box",initialize:function(t){e.view.Layout.prototype.initialize.call(this,t),this.$el.addClass(this.module?"layout_"+this.module:"layout_"+this.meta.type)},enableSearch:function(e,t){var n=this.getComponent(t||this.searchBoxName),r=this.getComponent(e);n&&r&&n.on("search:text",r.search,r)},bindGlobalEvents:function(){_.invoke(this._components,"bindGlobalEvents")},onAfterRender:function(){_.invoke(this._components,"onAfterRender")},onAfterShow:function(){_.invoke(this._components,"onAfterShow")},onBeforeRender:function(){_.invoke(this._components,"onBeforeRender")},unbindGlobalEvents:function(){_.invoke(this._components,"unbindGlobalEvents")},getHeaderData:function(){var e;return _.each(this._components,function(t){t.getHeaderData&&(e=t.getHeaderData())}),e},_dispose:function(){e.analytics.detachAnalytics(this.$el),this.$el.off(),e.view.Layout.prototype._dispose.call(this)}})}(SUGAR.App),function(e){var t={type:"list",components:[{view:"search-box"},{view:"list-associate"}]};e.view.layouts.AssociateLayout=e.view.NomadLayout.extend({className:"list-layout",initialize:function(n){this.options.meta=t,e.view.Layout.prototype.initialize.call(this,n),this.enableSearch("list-associate")}})}(SUGAR.App),function(e){var t={type:"list",components:[{view:"search-box"},{view:"list"}]};e.view.layouts.ListLayout=e.view.NomadLayout.extend({className:"list-layout",initialize:function(n){var r=t;_.contains(e.config.readonlyModules,n.module)&&(r=_.extend({},t,{components:[{view:"readonly-list"}]})),this.options.meta=r,e.view.NomadLayout.prototype.initialize.call(this,n),this.enableSearch("list")},loadData:function(t){t=t||{},e.config.alwaysShowMyItems&&(t.myItems=!0),this.collection.orderBy||(this.collection.orderBy=this.module==="Meetings"?{field:"date_start",direction:"ASC"}:null),e.view.NomadLayout.prototype.loadData.call(this,t)}})}(SUGAR.App),function(e){var t={type:"list",components:[{view:"list"}]};e.view.layouts.RelationshipsLayout=e.view.NomadLayout.extend({className:"list-layout",initialize:function(n){this.options.meta=t,e.view.Layout.prototype.initialize.call(this,n);var r=this.getComponent("list");r.template=e.template.get("list")}})}(SUGAR.App),function(e){var t={type:"list",components:[{view:"list-picker"}]};e.view.layouts.PickerlistLayout=e.view.NomadLayout.extend({className:"list-layout",initialize:function(n){this.options.meta=t,e.view.Layout.prototype.initialize.call(this,n);var r=this.getComponent("list-picker"),i=this.context.get("action"),s=e.nomad.getSubpanels(this.context.get("parentModule")),o=i==="create"?_.filter(s,function(t){return t.creatable&&e.acl.hasAccess("create",t.module)}):_.filter(s,function(t){return t.linkable&&e.acl.hasAccess("list",t.module)}),u=this.context.get("parentModule");_.each(o,function(e){e.currentModule=u}),r.setData({items:o,parentModelId:this.context.get("parentModelId"),parentModule:this.context.get("parentModule"),context:this.context,action:i}),r.on("row:clicked",function(t){var n=e.nomad.buildLinkRoute(this.data.parentModule,this.data.parentModelId,t,this.data.action)+"?depth=2";e.router.navigate(n,{trigger:!0})}),r.on("cancel:clicked",function(t){e.router.goBack()})}})}(SUGAR.App),function(e){var t={type:"list",components:[{view:"global-search-box"},{view:"home"}]};e.view.layouts.HomeLayout=e.view.NomadLayout.extend({className:"list-layout",initialize:function(n){this.options.meta=t,this.moduleCollections={},this.currentRequestList=[],this.ftsModules=[],_.each(e.metadata.getModules(),function(e,t){e.ftsEnabled&&this.ftsModules.push(t)},this),e.view.Layout.prototype.initialize.call(this,n),this.initializeBucketMeta(),this.enableSearch("home","global-search-box")},loadData:function(t){t=t||{},t.force!==!0&&_.isEmpty(this.collection.query)?(this.collection.module_list=e.serverInfo.fts&&e.serverInfo.fts.enabled?this.ftsModules:null,this.loadModulesData(t.disableGlobalDataAlerts,t)):e.view.Layout.prototype.loadData.call(this,t)},initializeBucketMeta:function(){var t=[],n=[];this.activityBucketsData=[];var r=e.metadata.getModuleNames({filter:"visible",access:"view"});n=e.config.excludeFromHomePage,n&&_.each(n,function(e){r=_.without(r,e)});var i=[{name:"Recent",label:e.lang.get("LBL_RECENTLY_UPDATED"),modules:r,numberOfItems:e.config.activityItemsRecent||10,displayMore:!1,displayModule:!0,enabled:e.config.includeRecentBuckets,labelNoRecords:e.lang.getAppString("LBL_MOBILE_NO_RECORDS"),noSkipModules:!0}];this._canDisplayModule("Meetings")&&i.unshift({name:"Upcoming",label:e.lang.get("LBL_UPCOMING"),module:"Meetings",numberOfItems:e.config.activityItemsUpcoming||4,displayMore:!1,displayModule:!0,myItemsOnly:!0,enabled:e.config.includeUpcomingBuckets,labelNoRecords:e.lang.getAppString("LBL_MOBILE_NO_RECORDS")});for(var s in i)i.hasOwnProperty(s)&&(t=this.addCustomBucket(i[s],t));if(e.config.includeModuleBuckets)for(s in r)t.indexOf(r[s])===-1&&this.activityBucketsData.push({name:r[s],label:e.nomad.getPluralModuleName(r[s]),numberOfItems:e.config.activityItemsPerModule||3,displayMore:!0,labelNoRecords:e.lang.getAppString("LBL_MOBILE_NO_RECORDS")})},loadModulesData:function(t,n){n.params=n.params||{};var r=this,i=this.moduleCollections;_.each(this.activityBucketsData,function(s){i[s.name]||(s.modules?(i[s.name]=e.data.createMixedBeanCollection(),i[s.name].fetchConfig={orderBy:{field:"date_modified",direction:"desc"},myItems:s.myItemsOnly||r.collection.myItems,favorites:r.collection.favorites,limit:s.numberOfItems||e.config.activityItemsPerModule||3,module_list:s.modules||[]}):(i[s.name]=e.data.createBeanCollection(s.module||s.name),i[s.name].fetchConfig={myItems:s.myItemsOnly||r.collection.myItems,favorites:r.collection.favorites,fields:e.metadata.getModule(s.module).mergedFields,limit:s.numberOfItems||e.config.activityItemsPerModule||3},i[s.name].module_list=[s.module||s.name]),i[s.name].bucketName=s.name,i[s.name].isActivityCollection=!0,i[s.name].displayModule=s.displayModule||!1,i[s.name].displayMore=s.displayMore,i[s.name].label=s.label||s.name,i[s.name].myItemsOnly=s.myItemsOnly||!1),i[s.name].fetchConfig.byPtr=t,i[s.name].fetchConfig.disableGlobalDataAlerts=!0,i[s.name].options=null,i[s.name].fetchConfig.params=null,i[s.name].orderBy=s.name==="Upcoming"?{field:"date_start",direction:"ASC"}:{field:"date_modified",direction:"DESC"};var o=e.utils.deepCopy(_.extend({},i[s.name].fetchConfig,n));s.name==="Upcoming"&&(o.myItems=!0),i[s.name].fetch(o),r.currentRequestList.push(s.name)})},addCustomBucket:function(e,t){if(e.enabled){if(!e.noSkipModules)if(e.modules)_.each(t,function(t){e.modules.splice(e.modules.indexOf(t),1)});else if(t.indexOf(e.module)>-1)return t;this.activityBucketsData.push(e),t=t.concat(e.modules||e.module)}return t},_canDisplayModule:function(t){return e.metadata.getModule(t)&&e.acl.hasAccess("access",t)&&e.acl.hasAccess("list",t)}})}(SUGAR.App),function(e){e.view.layouts.MobileTxLogListLayout=e.view.NomadLayout.extend({className:"list-layout",initialize:function(t){e.view.Layout.prototype.initialize.call(this,t),this.collection.sync=function(t,n,r){var i=r.success;n.options.add||(r.offset=0),async.waterfall([function(t){r.success=function(e){var i;e&&!_.isArray(e)&&(e=[e]),n.options.add||(n.offset=0),n.options.update=!1,n.options.add=!1,i=e.pop().totalTransactions,n.offset=n.offset+e.length,n.next_offset=i-n.offset,n.next_offset||(n.next_offset=-1),n.page=n.getPageNumber(r),e=_.map(e,function(e){return e.id=e._tx_uid,e}),t(null,n,e,r)},e.offline.storage.readTransactions(_.extend({limit:e.config.offline.txLogMaxQueryLimit,count:!0,errFirst:!0},r))},function(t,n,r,i){e.offline.storage.fillTxLogData(n,function(){i(null,t,n,r)})}],function(e,t,n,r){e||i(t,n,r)})}}})}(SUGAR.App),function(e){var t=function(){};e.view.layouts.MobileTxLogDetailLayout=e.view.NomadLayout.extend({className:"detail-layout",initialize:function(t){e.view.Layout.prototype.initialize.call(this,t)},loadData:function(n){var r=this;this.model.sync=function(n,i,s){var o=s.success;async.waterfall([function(t){s.success=function(e){t(null,e)},e.offline.storage.readTransactions(s,{id:i.id})},function(n,r){n?e.offline.storage.fillTxLogData([n],function(){r(null,n)}):r(new t)}],function(n,u){n?n instanceof t&&(e.controller.clean(),e.router.goBack()):(o(i,u,s),i.hasChanged()&&r.render())})},this.model.fetch(n)}})}(SUGAR.App),function(e){var t;e.view.views.HeaderView=e.view.NomadView.extend({events:{"click #desktop":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)},"click .nav li.disabled a":function(e){return!1},'click .nav li:not(.disabled) a:not([target="_blank"])':"onMenuItemClicked","click .cube":"onHomeClicked","click .create-entity":"onAddClicked",swipeRight:"onSwipeRight",swipeLeft:"onSwipeLeft","click #saveBtn":"onSave","click #cancelBtn":"onCancel","click #backBtn":"onBack","click h1":"onHeaderClicked"},plugins:["fast-click-highlight"],allowCreateMenuInModule:["About","Home","Settings"],offlineStatusIconPartial:"offline-status-icon",RIGHT_MENU:"right_menu",LEFT_MENU:"left_menu",initialize:function(n){e.view.NomadView.prototype.initialize.call(this,n),this.defaults={title:"SugarCRM",cube:!0,plus:!0,back:!1,save:!1,cancel:!1},this.data=null,e.events.on("app:header:changed",function(t,n){this.data=t||this.defaults,this.data.offlineEnabled=e.offlineEnabled,this.closeMenus(e.controller.layout.name==="login",_.bind(function(){this.render(n)},this))},this),e.events.on("app:logout",function(){delete this.avatar},this),e.events.on("app:header:picturechanged",_.bind(this._loadUserPicture,this)),e.events.on("offline:status:update",function(t){var n=this.$el.find(".offline-icon");n.removeClass("status-success status-warning status-error status-default"),n.addClass(e.nomad.utils.getOfflineStatusClass())},this),t=$(document.body),e.isMenuDisabled=!1,e.isLeftMenuOpen=!1,e.isRightMenuOpen=!1,this.isAnimationEnabled=e.supportedFeatures.menuAnimation,this.rightMenuData={},this.leftMenuData={};var r=_.bind(function(t){e.isMenuDisabled||e.nomad.closeHeaderMenu()},this);e.$rootEl.find("#content-overlay").on({click:r,swipe:r})},setButtonsEnabled:function(t,n,r){if(t){n&&r==="read"&&(!e.offlineEnabled||n instanceof e.offline.Error)?this.$("#saveBtn").hide():this.$("#saveBtn").show();if(n||r==="read"||e.controller.layout.name!=="edit")this.$("#saveBtn").removeAttr("disabled"),this.$("#cancelBtn").removeAttr("disabled")}else this.$("#saveBtn").attr("disabled","disabled"),this.$("#cancelBtn").attr("disabled","disabled")},render:function(t){return e.controller.layout&&e.controller.layout.name!=="login"&&(e.api.isAuthenticated()||e.controller.layout.name==="about")?(t||(t={}),this.$el.removeClass("hide"),this.buildLeftMenu(),this.buildRightMenu(t),this.offlineStatusClass=e.nomad.utils.getOfflineStatusClass(),e.view.NomadView.prototype._render.call(this),this.$menuContainer=this.$(".nav-collapse"),this.$header=this.$(".navbar-inner"),this.$contentWrapper=$("#content"),e.api.isAuthenticated()&&this.data.cube&&this._loadUserPicture()):this.$el.addClass("hide"),e.isMenuDisabled=!1,this},buildLeftMenu:function(){if(!this.data.cube)return;var t=this;this.leftMenuData={items:_.map(e.metadata.getModuleNames({filter:"visible",access:"list"}),function(t){return{url:t,label:e.nomad.getPluralModuleName(t)}}),userName:e.user.get("full_name"),userId:e.user.get("id"),desktopURI:e.nomad.getDesktopUrl(),offlineEnabled:e.offlineEnabled,errorEmulationEnabled:e.nomad.utils.isErrorEmulationEnabled(),offlineStatusIconPartial:this.offlineStatusIconPartial,offlineStatusClass:e.nomad.utils.getOfflineStatusClass()},this.leftMenuTemplate="menu-left"},buildRightMenu:function(t){if(!this.data.plus)return;var n,r,i,s,o,u,a;if(t.layout==="relationships")i=t.parentModule,s=t.parentModelId,o=t.link,u=e.data.getRelatedModule(i,o),n="menu-right-rel-list",a=e.nomad.getSingularModuleName(u),r={createRelationshipHref:{url:e.nomad.buildLinkRoute(i,s,o,"create?depth=1"),label:e.lang.get("LBL_CREATE_RELATED",u,a),disabled:!e.nomad.canCreateModule(u)||!e.nomad.canCreateRelated(i,o)},associateRelationshipHref:{url:e.nomad.buildLinkRoute(i,s,o,"associate?depth=1"),label:e.lang.get("LBL_ASSOC_EXISTING",u,a),disabled:!e.nomad.canLinkRelated(i,o)}},this.data.plus=!r.createRelationshipHref.disabled||!r.associateRelationshipHref.disabled;else if(t.layout==="detail")n="menu-right-detail",t.link?(i=t.parentModule,s=t.parentModelId,o=t.link,u=e.data.getRelatedModule(i,o),r={duplicateHref:{url:e.nomad.buildLinkRoute(i,s,o,t.modelId,"duplicate"),label:e.lang.getAppString("LBL_DUPLICATE_BUTTON"),disabled:!e.nomad.canCreateModule(u)||_.include(e.config.nonDuplicatableModules,u)}},this.data.plus=!r.duplicateHref.disabled):(r={duplicateHref:{url:e.router.buildRoute(t.module,t.modelId,"duplicate"),label:e.lang.getAppString("LBL_DUPLICATE_BUTTON"),disabled:!e.nomad.canCreateModule(t.module)||_.include(e.config.nonDuplicatableModules,t.module)||!e.nomad.hasAccessToRequiredFields(t.module)},createRelationshipHref:{url:e.router.buildRoute(t.module,t.modelId)+"/links/create",label:e.lang.getAppString("LBL_CREATE_RELATED_RECORD"),disabled:!this.data.hasCreatableRels},associateRelationshipHref:{url:e.router.buildRoute(t.module,t.modelId)+"/links/associate",label:e.lang.getAppString("LBL_ASSOC_RELATED_RECORD"),disabled:!this.data.hasRels}},this.data.plus=!(r.duplicateHref.disabled&&r.createRelationshipHref.disabled&&r.associateRelationshipHref.disabled));else{n="menu-right-list";if(t.module&&!e.nomad.canCreateModule(t.module))this.data.plus=!1;else if(_.contains(this.allowCreateMenuInModule,t.module)){var f=_.reject(e.metadata.getModuleNames({filter:"visible"}),function(t){return!e.nomad.canCreateModule(t)});f.length>0?r=_.map(f,function(t){return{url:t,label:e.lang.get("LBL_CREATE_MODULE",t,e.nomad.getSingularModuleName(t))}}):this.data.plus=!1}else r={createOnly:!0,module:t.module}}this.rightMenuData=r,this.rightMenuTemplate=n},isMenuOpen:function(){return e.isLeftMenuOpen||e.isRightMenuOpen},onMenuItemClicked:function(t){if(e.isMenuDisabled)return t.preventDefault(),t.stopPropagation(),!1;if(e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()){t.preventDefault(),t.stopPropagation();var n=$(t.currentTarget).attr("href");return e.routing.buggyLocationReplace?(e.activeComponents.executeOnActiveComponentClose(function(){window.location.hash=n}),window.history.back()):window.location.replace(n),!1}$(t.currentTarget).attr("href")===window.location.hash&&this.closeMenus(),e.nomad.fillContent(!0),_.delay(function(){e.nomad.fillContent(!1)},300)},onHomeClicked:function(t){t.preventDefault();if(e.isMenuDisabled)return;this.showLeftMenu(!e.isLeftMenuOpen),e.trigger("app:header:home",e.isLeftMenuOpen),e.tutorial.show("home-menu"),e.nomad.dismissAlerts()},showRightMenu:function(t,n,r){if(e.isMenuDisabled)return;var i=this.RIGHT_MENU,s=e.activeComponents;t?(this._closeActiveComponents(),s.add(i,function(e){e!==s.CLOSE_ALL&&this.showRightMenu(!1,n,r)},this)):s.remove(i);var o=n||!this.isAnimationEnabled?0:200;e.isMenuDisabled=!0;var u=this.$menuContainer.find("#createList"),a={menuAnimation:{"-webkit-transform":t?"translate3d(14%, 0, 0)":"translate3d(-100%, 0, 0)"},headerAnimation:{"-webkit-transform":t?"translate3d(-86%, 0, 0)":"translate3d(0, 0, 0)"},contentAnimation:{"-webkit-transform":t?"translate3d(-86%, 0, 0)":"translate3d(0, 0, 0)"},overlayAnimation:{"-webkit-transform":t?"translate3d(-86%, 0, 0)":"translate3d(-100%, 0, 0)"}},f=function(){e.isRightMenuOpen=!!t,r&&r()};this.animateMenu(t,a,u,f,o)},showLeftMenu:function(t,n,r){if(e.isMenuDisabled)return;var i=this.LEFT_MENU,s=e.activeComponents;t?(this._closeActiveComponents(),s.add(i,function(e){e!==s.CLOSE_ALL&&this.showLeftMenu(!1,n,r)},this)):s.remove(i);var o=n||!this.isAnimationEnabled?0:200;e.isMenuDisabled=!0;var u=this.$menuContainer.find("#moduleList"),a={menuAnimation:{"-webkit-transform":t?"translate3d(0, 0, 0)":"translate3d(-100%, 0, 0)"},headerAnimation:{"-webkit-transform":t?"translate3d(86%, 0, 0)":"translate3d(0, 0, 0)"},contentAnimation:{"-webkit-transform":t?"translate3d(86%, 0, 0)":"translate3d(0, 0, 0)"},overlayAnimation:{"-webkit-transform":t?"translate3d(86%, 0, 0)":"translate3d(-100%, 0, 0)"}},f=function(){e.isLeftMenuOpen=!!t,r&&r()};this.animateMenu(t,a,u,f,o)},_closeActiveComponents:function(){e.activeComponents.closeRecent()},animateMenu:function(t,n,r,i,s){e.$rootEl.find("#content-overlay").animate({"-webkit-transform":"translate3d(0px, 0px, 0px)"},0),t&&r.animate(n.menuAnimation,0),this.$header.animate(n.headerAnimation,s,"ease-out"),this.$contentWrapper.animate(n.contentAnimation,s,"ease-out",_.bind(function(){t||r.animate(n.menuAnimation,0),e.isMenuDisabled=!1,i&&i(),e.$rootEl.find("#content-overlay").animate(n.overlayAnimation,0),e.trigger("app:header:menu:open",t)},this))},onAddClicked:function(t){t.preventDefault();if(e.isMenuDisabled)return;if(this.rightMenuData.createOnly){var n=e.router.buildRoute(this.rightMenuData.module,null,"create");e.router.navigate(n,{trigger:!0})}else this.showRightMenu(!e.isRightMenuOpen),e.tutorial.show("plus-menu");e.trigger("app:header:add",!!e.isRightMenuOpen),e.nomad.dismissAlerts()},onHeaderClicked:function(t){t.preventDefault(),e.trigger("app:header:head")},onSwipeRight:function(t){if(e.isMenuDisabled)return;this.data.cube&&(e.isRightMenuOpen&&!e.isLeftMenuOpen?this.showRightMenu(!1):!e.isLeftMenuOpen&&!e.isRightMenuOpen&&(this.showLeftMenu(!0),e.tutorial.show("home-menu")),e.nomad.dismissAlerts())},onSwipeLeft:function(t){if(e.isMenuDisabled)return;e.isLeftMenuOpen&&!e.isRightMenuOpen?this.showLeftMenu(!1):this.data.plus&&!this.rightMenuData.createOnly&&!e.isLeftMenuOpen&&!e.isRightMenuOpen&&(this.showRightMenu(!0),e.tutorial.show("plus-menu")),e.nomad.dismissAlerts()},onSave:function(e){this.$("#saveBtn").attr("disabled")||this._onButtonClicked(e,"app:header:save")},onCancel:function(e){this.$("#cancelBtn").attr("disabled")||this._onButtonClicked(e,"app:header:cancel")},onBack:function(t){if(e.isMenuDisabled)return;this._onButtonClicked(t,"app:header:cancel")},_onButtonClicked:function(t,n){e.nomad.dismissAlerts(),t&&t.preventDefault(),e.trigger(n)},closeMenus:function(t,n){this.isMenuOpen()?e.isLeftMenuOpen?this.showLeftMenu(!1,t,n):this.showRightMenu(!1,t,n):n&&n()},_loadUserPicture:function(t){var n=e.api.buildFileURL({field:"picture",module:"Users",id:e.user.get("id")},e.nomad.getFileOptions()),r=new Image,i;t&&(n+="&id="+t,i=!0),this.avatar||(i=!0),r.onload=_.bind(this._applyUserPicture,this,{img:r,url:n}),i?r.src=n:this._applyUserPicture(this.avatar)},_applyUserPicture:function(t){var n=this.$("#me i"),r={image:t.img,height:n.css("height"),width:n.css("width")};if(t.el){n.replaceWith(t.el);return}e.nomad.utils.sizePicture(r),n.css({backgroundSize:r.sizeProp,backgroundImage:"url("+t.url+")"}).addClass("withPicture"),this.avatar={url:t.url,el:n}}})}(SUGAR.App),function(e){e.view.views.AboutView=e.view.NomadView.extend({globalEvents:{"app:header:cancel":"exit"},events:{"click .legal a":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)},"click .support_email":function(t){t.preventDefault();var n=e.isNative?"\n\n\nrequest ID: "+e.clientInfo.device.uuid:"";e.nomad.sendConsoleLog(e.config.supportEmail,e.config.brandName+" Mobile support request",n)},"click .support_website":function(t){t.preventDefault(),e.nomad.openUrl("http://"+e.config.url.support)},"swipeRight .support_website":function(e){this._feedBack=(this._feedBack||0)+1,this._feedBack>=3&&this.getField("support_email").$el.removeClass("hide")}},onAfterRender:function(){!e.config.displaySupportEmail||this.getField("support_email").$el.removeClass("hide"),e.config.url.support||this.getField("support_website").$el.addClass("hide")},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.fallbackFieldTemplate="readonly";var n=e.nomad.getServerVersion(),r;r=this._getServerUrl().replace(/(http:\/\/)|(https:\/\/)|(\/rest\/v10\/)/,""),this.model.set({app_version:e.nomad.getVersion(),server_version:n,server_url:r,support_email:e.config.supportEmail,support_website:e.config.url.support,privacy:e.config.url.privacy,tos:e.config.url.tos})},_getServerUrl:function(){var t;return e.isNative?e.config.hideLoginUrl?t=e.config.defaultServerUrl:e.api.isAuthenticated()&&(t=e.nomad.getSetting("loginUrl")||"N/A"):(t=e.config.siteUrl,t.indexOf("..")===0&&(t=e.nomad.utils.resolveUrl(t,window.location.href))),t||"N/A"},getHeaderData:function(){return{title:e.lang.getAppString("LNK_ABOUT"),cube:e.api.isAuthenticated()&&e.isSynced,plus:!1,back:!0}}})}(SUGAR.App),function(e){e.view.views.AddressEditView=e.view.NomadView.extend({_bodyScroll:!0,globalEvents:{"app:header:save":"save","app:header:cancel":"cancel"},plugins:["clear-field","hide-alerts-onfocus"],initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.action="edit",this.fallbackFieldTemplate="edit",this.addressFields=t.addressFields,this.addressFieldsNames=_.pluck(this.addressFields,"name"),this._addressBackup={},_.each(this.addressFields,function(e){this._addressBackup[e.name]=this.model.get(e.name)},this)},getHeaderData:function(){var e=this.options.editedFieldName;return{title:e,save:!0,saveLabel:"LBL_DONE_BUTTON_LABEL",cancel:!0}},save:function(){var e=this;this.model.doValidate(this.addressFieldsNames,function(t){t&&e.trigger("close:clicked")})},cancel:function(){this.restoreAddress(),this.trigger("close:clicked")},restoreAddress:function(){this.model.set(this._addressBackup)}})}(SUGAR.App),function(e){e.view.views.SettingsView=e.view.NomadView.extend({globalEvents:{"app:header:save":"saveSettings","app:header:cancel":"cancel"},initialize:function(t){this._modelBackup=null,this._showOfflineButton=e.config.offline.enabled&&(e.config.offlineEnabled||e.config.offline.debug.ignoreEnabled)&&e.serverInfo.offlineSupported,this._offlineEnabled=e.offlineEnabled;var n=new Backbone.Model(e.user.get("preferences")),r=e.logger.levels[e.config.logLevel];r&&n.set("logging",r.value-1),t.layout.context.set("model",n),t.layout.model=n,e.view.NomadView.prototype.initialize.call(this,t)},getHeaderData:function(){return{title:e.lang.getAppString("LNK_SETTINGS"),save:!0,cancel:!0}},onAfterRender:function(){this.backupModel(),e.config.showLogLevelSetting||this.getField("logging").remove()},saveSettings:function(){var t=this,n=this.model.get("language"),r=this.$el.find("#offline-toggle").attr("checked");async.series([function(n){t._showOfflineButton&&r!==e.offlineEnabled?t.toggleOffline(!e.offlineEnabled,n):n(null)},function(t){e.controller.clean(!0,!0),e.lang.setLanguage(n,function(e){t(e)})},function(n){if(t.model.get("logging")!==t._modelBackup.logging){var r=t.getField("logging");e.config.logLevel=r.options.def.options[r.value],e.config.debugSugarApi=r.value<=1}n(null)}],function(e){e||t.exit()})},cancel:function(){this.restoreModel(),this.exit()},backupModel:function(){var e=JSON.stringify(this.model.toJSON());this._modelBackup=JSON.parse(e)},restoreModel:function(){e.user.set("preferences",this._modelBackup)},toggleOffline:function(t,n){var r=t?"LBL_OFFLINE_ENABLE_PROMPT":"LBL_OFFLINE_DISABLE_PROMPT",i=function(){e.offline.userEnabled=t,e.nomad.setSetting("offlineEnabled",t),n(null)};e.nomad.showConfirm(e.lang.getAppString(r),function(r){r===2?(e.logger.debug("Offline enabled: "+t),t?i():e.offline.stop({dropDb:!0,callback:i})):n("cancelled")})}})}(SUGAR.App),function(e){e.view.views.OfflineView=e.view.NomadView.extend({_devMode:e.config.offline.debug.render,globalEvents:{"app:header:cancel":"cancel","offline:status:update":"onOfflineStatusUpdated"},events:{"click #preload_records_button":"onPreloadRecordsClick"},offlineStatusIconPartial:"offline-status-icon",initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t)},render:function(t){this.offlineStatusClass=e.nomad.utils.getOfflineStatusClass(),this.offlineMessage=this.getOfflineMessage(),e.view.NomadView.prototype.render.call(this,t)},onOfflineStatusUpdated:function(){var t=this.$el.find(".offline-icon"),n=this.$el.find("#offline-message");t.removeClass("status-success status-warning status-error status-default"),t.addClass(e.nomad.utils.getOfflineStatusClass()),n.html(this.getOfflineMessage())},onPreloadRecordsClick:function(){e.nomad.promptAndPreloadUserRecords(!1)},getHeaderData:function(){return{title:e.lang.getAppString("LNK_OFFLINE_SETTINGS"),save:!1,cancel:!0}},cancel:function(){this.exit()},getOfflineMessage:function(){var t=e.offline.status,n="",r="",i="LBL_OFFLINE_STATUS_ONLINE",s="LBL_OFFLINE_STATUS_NO_PENDING_TX",o="ERR_OFFLINE_OUT_OF_SPACE";return t?(t.isSyncing?r="LBL_OFFLINE_SYNC_IN_PROGRESS":t.lastSyncTs&&t.totalTransactions>0&&(n=e.lang.get("LBL_OFFLINE_LAST_SYNC_TS",null,{ts:t.lastSyncTs.toLocaleString()})),e.offline.isOnline()?t.noConnection&&(i="LBL_OFFLINE_STATUS_BAD_NETWORK"):i="LBL_OFFLINE_STATUS_OFFLINE",t.state===e.offline.STATE.ERROR?s="LBL_OFFLINE_STATUS_SYNC_FAILED":t.state===e.offline.STATE.WARNING&&t.totalTransactions>0&&(s="LBL_OFFLINE_STATUS_PENDING_TX"),e.lang.getAppString(s)+" "+(t.isOutOfSpace?e.lang.getAppString(o)+" ":"")+e.lang.getAppString(i)+" "+e.lang.getAppString(r)+" "+n):"..."}})}(SUGAR.App),function(e){e.view.views.OfflineSettingsView=e.view.NomadView.extend({globalEvents:{"app:header:cancel":"cancel"},events:{"touchstart .offline-property input":"onPropTouchstart"},onBeforeRender:function(){var t=e.config.offline.debug;this.configProperties={online:t.online,forceMigrate:t.forceMigrate,syncManagerEnabled:t.syncManagerEnabled,monitorStatus:t.monitorStatus,outOfSpace:t.outOfSpace}},getHeaderData:function(){return{title:e.lang.getAppString("LBL_OFFLINE_SETTINGS"),save:!1,cancel:!0}},cancel:function(){this.exit()},onPropTouchstart:function(t){var n=$(t.target).attr("class");e.config.offline.debug[n]=!e.config.offline.debug[n]}})}(SUGAR.App),function(e){e.view.views.OfflineStatsView=e.view.NomadView.extend({globalEvents:{"app:header:cancel":"cancel"},events:{"click #compactDbButton":"onCompactDbClick","click #clearDbButton":"onClearDbClick"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.getStatsAndRender()},getStatsAndRender:function(){var t=this;e.offline.storage.getStats({success:function(n){function i(t){r.push(e.nomad.getPluralModuleName(t),n.count[t])}var r=[];n.totalRecordsCount=_.reduce(n.count,function(e,t){return _.isNumber(t)&&(e+=t),e},0);var s=e.metadata.getModuleNames({filter:"enabled"});_.each(s,i),s=_.difference(_.keys(n.count),s),_.each(s,i),n.count=r,t.dbStats=n,t.render()}})},getHeaderData:function(){return{title:e.lang.getAppString("LBL_OFFLINE_STATS"),save:!1,cancel:!0}},cancel:function(){this.exit()},onCompactDbClick:function(){var t=this;e.nomad.showConfirm(e.lang.getAppString("LBL_OFFLINE_CLEAN_UP_PROMPT"),function(n){if(n===2){var r="db_cleanup";e.nomad.dismissAlerts(),e.overlay.show(r),e.alert.show(r,{level:"info",messages:e.lang.getAppString("LBL_OFFLINE_DB_CLEANING_IN_PROGRESS"),autoClose:!1,closable:!1}),e.offline.compactStorage({callback:function(n){e.overlay.hide(r),e.alert.dismiss(r),n?e.alert.show(r,{level:"error",messages:e.lang.getAppString("ERR_OFFLINE_DB_CLEANING_ERROR"),autoClose:!0,closable:!0}):e.alert.show(r,{level:"success",messages:e.lang.getAppString("LBL_OFFLINE_DB_CLEANING_COMPLETED"),autoClose:!0,closable:!0}),e.controller.clean(!0,!0),t.getStatsAndRender()}})}})},onClearDbClick:function(){var t=this;e.nomad.showConfirm(e.lang.getAppString("LBL_OFFLINE_CLEAR_DB_PROMPT"),function(n){if(n===2){var r="db_cleanup";e.nomad.dismissAlerts(),e.overlay.show(r),e.alert.show(r,{level:"info",messages:e.lang.getAppString("LBL_OFFLINE_DB_CLEANING_IN_PROGRESS"),autoClose:!1,closable:!1}),e.offline.clearStorage({callback:function(n){e.overlay.hide(r),e.alert.dismiss(r),n?e.alert.show(r,{level:"error",messages:e.lang.getAppString("ERR_OFFLINE_DB_CLEANING_ERROR"),autoClose:!0,closable:!0}):e.alert.show(r,{level:"success",messages:e.lang.getAppString("LBL_OFFLINE_DB_CLEANING_COMPLETED"),autoClose:!0,closable:!0}),e.controller.clean(!0,!0),t.getStatsAndRender()}})}})}})}(SUGAR.App),function(e){e.view.NomadAlertView=e.view.AlertView.extend({initialize:function(e){this.maxViewCounter=e.maxViewCounter||2},close:function(t){t=t||{};var n=this,r=!$.os.android||this.options.level!=="load";r=_.isUndefined(t.animate)?r:t.animate,r?this.$el.animate({height:"0",borderTop:"0"},500,"ease",function(){e.view.AlertView.prototype.close.call(n)}):e.view.AlertView.prototype.close.call(n)},getCloseSelector:function(){return this.$el}})}(SUGAR.App),function(e){e.view.views.LoginView=e.view.NomadView.extend({className:"login",privacyLink:e.config.url.privacy,tosLink:e.config.url.tos,appVersion:e.config.appVersion,useHttps:e.config.useHttps,_bodyScroll:!0,events:{"click .about-link":function(){var t=e.context.getContext({module:"About",create:!0}).prepare(),n=e.controller.createDynamicLayout("about","about",[{name:"about",context:t}]),r=n.getComponent("about");r.exit=function(){e.controller.disposeDynamicLayout()},e.controller.showDynamicLayout("about")},"click #login_btn":"login","click .legal-link":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)},"keypress input":function(e){e.which===13&&(e.srcElement.blur(),this.login())}},plugins:["clear-field","hide-alerts-onfocus"],onAfterShow:function(){e.nomad.closeHeaderMenu(!0),_.delay(_.bind(function(){e.overlay.hideAll(),this.$el.animate({opacity:"1"},500,"ease")},this),100)},login:function(){e.alert.dismissAll();var t=this.$("#login_btn");t.focus();if(t.is("[disabled=disabled]"))return!1;t.attr("disabled","disabled").html('<i class="icon icon-spinner rotate3"></i>'+e.lang.getAppString("LBL_LOADING"));var n=this.model.get("url"),r=this.$el.find(".checkbox"),i=r.length?r.attr("checked"):e.config.useHttps,s={password:this.model.get("password"),username:this.model.get("username")},o=this.model.fields;e.isNative||(o={username:this.model.fields.username,password:this.model.fields.password});var u=this;this.model.doValidate(o,function(t){if(!t){u.reEnableLogin();return}e.alert.dismiss("field_validation_error"),e.logger.debug("Username: "+s.username),e.isNative&&(e.config.siteUrl=e.view.views.LoginView.normalizeUrl(n,i),e.api.serverUrl=e.nomad.getServerUrl(),e.logger.debug("Site URL: "+e.config.siteUrl)),e.nomad.setSetting({loginName:s.username,loginUrl:n,siteUrl:e.config.siteUrl}),e.login(s,e.clientInfo,{error:function(e){e&&e.status>=400&&e.status<=403&&u.model.unset("password"),u.reEnableLogin()},success:function(){_.delay(function(){u.reEnableLogin()},500)}})})},reEnableLogin:function(){if(this.disposed)return;this.$("#login_btn").removeAttr("disabled").text(e.lang.getAppString("LBL_LOGIN"))},render:function(){var t=e.nomad.getSetting("loginUrl")||e.config.defaultServerUrl;this.model.set({username:e.nomad.getSetting("loginName"),url:t===""?null:t},{silent:!0}),e.view.NomadView.prototype.render.call(this);if(!e.isNative||e.config.hideLoginUrl)this.getField("url").remove(),this.$el.find(".control-ssl").remove();return this}},{normalizeUrl:function(e,t){e=e.trim();var n=/^no-ssl:\/\//.test(e);return!n&&!/^https?:\/\//.test(e)&&(e="http://"+e),t&&!n&&e.indexOf("http://")===0&&(e="https:"+e.substr(5)),e.indexOf("no-ssl://")===0&&(e="http://"+e.substr(9)),e.replace(/\/+$/,"")}})}(SUGAR.App),function(e){e.view.views.ListView=e.view.NomadView.extend({events:{"click  article .grip":"onClickGrip","swipeLeft article":"onSwipeLeftItem","swipeRight article":"onSwipeRightItem","click .list-view-item":"onClickItem","click .cm-item-btn:not(.disabled)":"onClickCMItem","longTap    article":"onLongTapItem"},plugins:["fast-click-highlight","pagination"],contextMenuActions:[{name:"view",label:"LBL_VIEW_BUTTON",icon:"icon-eye-open",isEnabled:function(t){return!e.acl.hasAccessToModel("edit",t)||_.contains(e.config.nonEditableModules,t.module)},action:"onEditItem"},{name:"edit",label:"LBL_EDIT_BUTTON",icon:"icon-pencil",isEnabled:function(t){return e.acl.hasAccessToModel("view",t)&&!_.contains(e.config.nonEditableModules,t.module)},action:"onEditItem"},{name:"follow",label:"LBL_FOLLOW",icon:"icon-ok-circle",isEnabled:function(t){return e.nomad.canFollow(t)},isFollow:!0,action:"onFollowItem"},{name:"unfollow",label:"LBL_UNFOLLOW",icon:"icon-ok-sign",isEnabled:function(t){return e.nomad.canFollow(t)},isFollow:!0,action:"onFollowItem"},{name:"unlink",label:"LBL_UNLINK_BUTTON",icon:"icon-minus-sign",isEnabled:function(e){return this.unlinkVisible&&e.hasUnlinkAccess(this.relateFields,this.relationship)},action:"onUnlinkItem"},{name:"delete",label:"LBL_DELETE_BUTTON",isEnabled:function(e){return!e.link&&e.hasDeleteAccess()},icon:"icon-trash",action:"onRemoveItem"},{name:"call",access:"list",label:"LBL_CALL_BUTTON",icon:"icon-phone",isEnabled:function(e){var t=this.modContextData[e.module];return t.actions.phone&&!!e.isDataDefined(t.phoneFields)},isMultiple:function(e){var t=e.getFieldsDataArray(this.modContextData[e.module].phoneFields);return t.length>1},action:"onCall",autoClose:!0},{name:"email",access:"list",label:"LBL_EMAIL_BUTTON",icon:"icon-envelope",isEnabled:function(e){var t=this.modContextData[e.module];return t.actions.email&&e.hasActiveEmail(t.emailFields)},isMultiple:function(t){var n=t.getFieldsDataArray(this.modContextData[t.module].emailFields),r=e.nomad.utils.extractAndSortEmails(n);return r.length>1},action:"onEmail",autoClose:!0},{name:"sms",access:"list",label:"LBL_SMS_BUTTON",icon:"icon-comment",isEnabled:function(e){var t=this.modContextData[e.module];return t.actions.phone&&!!e.isDataDefined(t.phoneFields)},isMultiple:function(e){var t=e.getFieldsDataArray(this.modContextData[e.module].phoneFields);return t.length>1},action:"onSMS",autoClose:!0},{name:"map",access:"list",label:"LBL_MAP_BUTTON",icon:"icon-map-marker",isEnabled:function(e){var t=this.modContextData[e.module];return t.actions.map&&_.any(e.getAddresses(t.addressFieldsGroups))},isMultiple:function(e){var t=e.getAddresses(this.modContextData[e.module].addressFieldsGroups);return t.length>1},action:"onMap",autoClose:!0},{name:"url",access:"list",label:"LBL_URL_BUTTON",icon:"icon-external-link",isEnabled:function(t){var n=this.modContextData[t.module],r=e.view.fields.UrlField.prototype.regexp;return n.actions.url&&t.isDataDefined(n.urlFields,r)},isMultiple:function(e){var t=e.getFieldsDataArray(this.modContextData[e.module].urlFields);return t.length>1},action:"onURL",autoClose:!0},{name:"file",access:"list",label:"LBL_FILE_BUTTON",icon:"icon-file",isEnabled:function(t){var n=this.modContextData[t.module].docFields,r=!_.isEmpty(n)||!_.isEmpty(t.docData)||t._canHaveFiles()||t.canHaveAttachments()||t._canHavePDFs(),i=e.acl.hasAccessToModel("view",t);return r&&i},isMultiple:function(e){return e.docData&&e.docData.length>1},isFile:!0,action:"onViewFile",autoClose:!0}],globalEvents:{"offline:data:updated":function(e){this.scroll&&this.scroll.reflow();if(this.collection.query)return;this.isCurrentListUpdated(e)&&this.collection.fetch({add:!0,params:{skipServerSync:!0,serverOffset:e.serverOffset}})},"app:header:cancel":function(){e.router.goBack()},"app:header:head":"scrollToTop","data:sync:start":"onDataSyncStart","data:sync:success":"onDataSyncSuccess","data:sync:error":"onDataSyncError","app:view:beforechange":"onBeforeViewChanged","app:logout":"destroyPullToRefresh","app:header:menu:open":"onMenuOpen","actionsheet:show":"onMenuOpen"},LIST_VIEW_CONTEXT_MENU:"list_view_context_menu",initialize:function(t){t.templateOptions={partials:{"list-item":e.template.get("list-item")}},e.view.NomadView.prototype.initialize.call(this,t),this.activeListItem=null,this.relationshipFields=null,this.unlinkVisible=!1,this.disableListItemClick=!1;var n=this.context.get("link");if(n){var r=this.context.get("parentModule"),i=e.metadata.getModule(r,"fields")[n];this.relationship=e.metadata.getRelationship(i.relationship),this.relateFields=e.data.getRelateFields(r,n),this.unlinkVisible=e.nomad.canUnlinkRelated(r,n)&&_.reduce(this.relateFields,function(e,t){return e&&!t.required},!0),this.initRelationshipFields(r,n)}this.modContextData=e.nomad.contextMeta.list},initLabels:function(){this.labelLoading=e.lang.getAppString("LBL_LOADING"),this.labelNoRecords=e.lang.getAppString("LBL_MOBILE_NO_RECORDS"),this.labelShowMoreTop=e.lang.getAppString("LBL_MOBILE_SHOW_MORE_TOP"),this.labelShowMoreBottom=e.lang.getAppString("LBL_MOBILE_SHOW_MORE"),this.labelServerFetch=e.lang.getAppString("LBL_OFFLINE_SERVER_FETCH")},onBeforeRender:function(){this.initLabels()},onAfterRender:function(){this.initScroll()},destroyScroll:function(){this.scroll&&(this.destroyPullToRefresh(),this.scroll.destroy())},initScroll:function(){if(e.isRightMenuOpen||e.isLeftMenuOpen)return!1;this.destroyScroll(),window.EasyScroller&&(this.scroll=new window.EasyScroller(this.layout.el,e.$contentEl.get(0),{scrollingY:!0,scrollingX:!1})),this.initPullToRefresh()},onAfterShow:function(){this.scroll&&this.scroll.reflow()},initPullToRefresh:function(){if(e.config.pullToRefresh&&this.scroll){var t=this.layout.$el;t.pullToRefresh({callback:_.bind(this.onRefresh,this,!0),template:e.template.get("ptr"),templateTarget:$("#content"),height:50,scroller:this.scroll.scroller,command:e.lang.getAppString("LBL_MOBILE_PTR_PULL"),action:e.lang.getAppString("LBL_MOBILE_PTR_RELEASE"),refresh:e.lang.getAppString("LBL_LOADING")})}},onRefresh:function(t){t&&e.analytics.trackEvent("app","ptr"),this.refresh(t,{complete:_.bind(this.hidePullToRefresh,this),byPtr:t})},refresh:function(e,t){this.collection.options=null,this.collection.fetch(_.extend({disableGlobalDataAlerts:!!e,relate:!!this.context.get("link"),params:{forceServerSync:!0}},t))},onMenuOpen:function(e){e?this.destroyScroll():this.initScroll()},hidePullToRefresh:function(){e.config.pullToRefresh&&this.layout.$el&&this.layout.$el.pullToRefresh("hide")},destroyPullToRefresh:function(){this.layout&&this.layout.$el.pullToRefresh&&e.controller.layout===this.layout&&this.layout.$el.pullToRefresh("destroy")},getHeaderData:function(){var t=this.modulePlural,n=!1;return this.context.get("link")&&(t=e.lang.get("LBL_RELATED_MODULE_PLURAL",this.module,this.modulePlural),n=!0),{title:t,cube:!0,back:n,plus:!0}},search:function(t){this.collection.options=null,this.collection.fetch({query:t,complete:function(){e.trigger("search:complete")}})},onItemAdded:function(t,n,r){this.$el.find(".no-records-found").hide();var i=e.view.getFieldId(),s=Handlebars.helpers.include("list-item",t,this,{hash:this.meta&&this.meta.panels?this.meta.panels[0]:{}});r.addTop?this.$(".items").prepend(s.toString()):this.$(".items").append(s.toString());for(var o=i+1;o<=e.view.getFieldId();++o)this._renderField(this.fields[o])},onItemRemoved:function(e){this.$("#"+this.cid+this.module+e.id).remove()},bindDataChange:function(){this.collection&&(this.collection.on("reset",this.render,this),this.collection.on("add",this.onItemAdded,this),this.collection.on("remove",this.onItemRemoved,this))},getMaxPageSize:function(){return Math.max(e.config.maxPageSize||20,e.config.maxQueryResult)},onClickGrip:function(e){if(this.disableListItemClick)return this.disableListItemClick=!1,!1;e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).closest("article");return t.hasClass("active-list-item")?this.hideContextMenu(t,!0):(this.activeListItem&&this.hideContextMenu(this.activeListItem,!0,!!this.activeListItem),this.showMenu(t)),!1},onSwipeLeftItem:function(e){if(this.contextMenuDisabled)return;if($.__swipeHelper.swipeOrientation!=="vertical"){var t=$(e.currentTarget);if(this.activeListItem){if(e.currentTarget.id===this.activeListItem.attr("id"))return;this.hideContextMenu(this.activeListItem,!0,!!this.activeListItem)}this.showMenu(t)}},onSwipeRightItem:function(e){if(this.contextMenuDisabled)return;var t=this.activeListItem&&this.activeListItem.get(0);e.currentTarget===t&&this.hideContextMenu(null,!0)},showMenu:function(t){var n=t.find(".menu-container"),r=t.attr("module")||this.module,i=this._extractId(t.attr("id"),r),s=this.getModel(i,r);if(_.isEmpty(n))return;this.activeListItem=t,s&&(this.initContextMenu(n,s),this.renderContextMenu(n,s)),_.delay(function(){n.addClass("on")},0),this.activeListItem.addClass("active-list-item"),e.config.analytics.enabled&&e.analytics.attachAnalytics(n),e.activeComponents.add(this.LIST_VIEW_CONTEXT_MENU,function(t){var n=t!==e.activeComponents.CLOSE_ALL;this.hideContextMenu(null,!0,n)},this)},initContextMenu:function(e,t){var n=this,r=this.modContextData&&this.modContextData[t.module];this.calculateContextMenuItems(t),r&&this.hasDocAction&&(t.once("docs:ready",function(r){t.docData=r,n.calculateContextMenuItems(t),n.renderContextMenu(e,t)}),t.getDocuments(r.docFields))},renderContextMenu:function(t,n){var r={contextMenuItems:this.contextMenuItems,isEmptyMenu:_.isEmpty(this.contextMenuItems),fileIconDisabled:!n.docsLoading&&!e.nomad.utils.docIsAvailable(n.docData),docsLoading:n.docsLoading,following:n.get("following")},i=e.template.get("context-menu")(r);t.find(".context-menu").remove(),t.append(i)},calculateContextMenuItems:function(t){var n=5,r=t.get("following"),i=[],s=!1;_.each(this.contextMenuActions,function(o){var u=e.acl.hasAccessToModel(o.access||o.name,t),a=u&&o.isEnabled&&o.isEnabled.call(this,t);a&&i.length<n&&(o.name!=="follow"||!r)&&(o.name!=="unfollow"||r)&&(i.push(o),o.isFile&&(s=!0))},this),this.contextMenuItems=i,this.hasDocAction=s},hideContextMenu:function(t,n,r){var i=t||this.activeListItem;if(i){i=$(i);var s=i.attr("module")||this.module,o=this._extractId(i.attr("id"),s),u=this.getModel(o,s),a=i.find(".menu-container");_.delay(function(){a.removeClass("on").find(".context-menu").remove()},n?0:400),i.removeClass("active-list-item"),e.config.analytics.enabled&&e.analytics.detachAnalytics(a),u&&u.off("docs:ready")}this.activeListItem=null,e.activeComponents.remove(this.LIST_VIEW_CONTEXT_MENU,null,null,!r)},onClickCMItem:function(t){t.preventDefault(),t.stopPropagation(),_.delay(_.bind(function(){function h(){c.call(n,t,f),!l&&o.autoClose&&n.hideContextMenu()}var n=this,r=$(t.target).closest("article"),i=$(t.currentTarget),s=i.attr("action"),o=_.find(this.contextMenuActions,function(e){return e.name===s}),u=r.attr("module")||this.module,a=this._extractId(r.attr("id"),u),f=this.getModel(a,u),l=_.isFunction(o.isMultiple)&&o.isMultiple.call(n,f),c=o.action&&this[o.action];c?e.routing.emulateBackButton&&!l?e.activeComponents.executeOnActiveComponentClose(h):h():e.nomad.showAlert("Action not implemented"),e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()&&!l?(window.manualGoBack=!0,window.history.back()):this.hideContextMenu(r,!0)},this),0)},onViewFile:function(t,n){var r=n.docData;if(_.isEmpty(r)){alert(e.lang.getAppString(n.docsLoading?"LBL_LOADING_FILES":"ERR_NO_DOCS"));return}e.nomad.openDoc(n.docData)},onCall:function(t,n){var r=n.getFieldsDataArray(this.modContextData[n.module].phoneFields);e.nomad.callPhone(r,n)},onSMS:function(t,n){var r=n.getFieldsDataArray(this.modContextData[n.module].phoneFields);e.nomad.sendSms(r)},onEmail:function(t,n){var r=n.getFieldsDataArray(this.modContextData[n.module].emailFields),i=e.nomad.utils.extractAndSortEmails(r);_.isEmpty(i)||e.nomad.sendEmail(i)},onURL:function(t,n){var r=n.getFieldsDataArray(this.modContextData[n.module].urlFields);e.nomad.openUrl(r)},onMap:function(t,n){var r=n.getAddresses(this.modContextData[n.module].addressFieldsGroups);e.nomad.openAddress(r)},onRemoveItem:function(e){return this._deleteRecord(e)},onUnlinkItem:function(e){return this._deleteRecord(e,!0)},onFollowItem:function(e,t){var n=$(e.currentTarget).filter(".follow-item, .unfollow-item"),r="."+n.attr("action")+"-item",i=n.siblings(".follow-item, .unfollow-item").not(r),s=t.get("following"),o=function(){t.set("following",s),this.toggleFollowEl(n,i)};t.follow(!s,{error:_.bind(o,this)}),this.toggleFollowEl(i,n),this.hideContextMenu()},toggleFollowEl:function(e,t){e.show(),t.hide()},_deleteRecord:function(t,n){var r=this,i=e.lang.getAppString(n?"LBL_MOBILE_UNLINK_CONFIRM":"LBL_MOBILE_DELETE_CONFIRM"),s=this.activeListItem;return r.hideContextMenu(),e.nomad.showConfirm(i,function(e){e===2&&(r.activeListItem=s,r._deleteRecordAction(s,n))}),!1},_deleteRecordAction:function(e,t){var n=e.attr("module")||this.module,r=this._extractId(e.attr("id"),n);this.collection.get(r).destroy({relate:t,wait:!0})},onEditItem:function(t){var n,r=this.context.get("link"),i=$(this.activeListItem),s=i.attr("module")||this.module,o=this._extractId(i.attr("id"),s);if(r){var u=this.context.get("parentModule"),a=this.context.get("parentModelId");n=e.nomad.buildLinkRoute(u,a,r,o,"edit")}else n=e.router.buildRoute(s,o,"edit");return e.router.navigate(n,{trigger:!0}),this.activeListItem&&this.hideContextMenu(this.activeListItem,!0,!1),e.controller.executeOnViewChange(function(){e.controller.context.set("fromListView",!0)}),!1},onDataSyncStart:function(t,n,r){this.$(".no-records-found").hide(),r.disableGlobalDataAlerts&&e.nomad.showDataSyncOverlay()},onDataSyncSuccess:function(e,t,n){this.onDataSyncComplete(e,t,n)},onDataSyncError:function(e,t,n,r){this.onDataSyncComplete(e,t,n,r)},onDataSyncComplete:function(t,n,r,i){this.hideContextMenu();if(t==="update")return;r.disableGlobalDataAlerts&&e.nomad.hideDataSyncOverlay(i,t),n instanceof e.BeanCollection&&(this.initPullToRefresh(),this.collection.options.disableGlobalDataAlerts=!1),this.collection.length||this.$(".no-records-found").show(),this.scroll&&this.scroll.reflow()},scrollToTop:function(){this.scroll&&this.scroll.scroller.scrollTo(0,0,!0)},onClickItem:function(t){if(this.disableListItemClick)return this.disableListItemClick=!1,!1;e.trigger("list:item:clicked");var n=$(t.currentTarget).closest("article");this.activeListItem&&this.activeListItem[0]!==n[0]&&this.activeListItem.find(".menu-container").hasClass("on")&&(this.hideContextMenu(null,null,!0),t.preventDefault());if(!t.defaultPrevented&&!t.cancelBubble&&!$(t.currentTarget).hasClass("active-list-item")){var r=$(t.target).closest("article"),i,s=r.attr("module")||this.module,o=this.getModel(this._extractId($(t.currentTarget).attr("id"),s),s);o&&e.acl.hasAccessToModel("view",o)&&(i=Handlebars.helpers.buildRoute(o,{hash:{link:this.context.get("link")}}),i&&e.router.navigate("#"+i,{trigger:!0})),this.activeListItem=null}},onBeforeViewChanged:function(){this.destroyPullToRefresh(),this.scroll&&(this.scroll.destroy(),this.scroll=null)},getModel:function(e){return this.collection.get(e)},onLongTapItem:function(t){if(this.contextMenuDisabled||this.activeListItem&&this.activeListItem.get(0)===t.currentTarget)return;$.os.android&&(this.disableListItemClick=!0,e.analytics.trackEvent("longTap","c-menu"),this.activeListItem&&this.hideContextMenu(null,!0,!0),this.showContextMenuActionSheet(t))},showContextMenuActionSheet:function(t){this.disableListItemClick=!0;var n=$(t.currentTarget).closest("article"),r=n.attr("module")||this.module,i=this._extractId(n.attr("id"),r),s=this.getModel(i,r),o=[],u=[],a=this,f=s.get("following");this.activeListItem=n,_.each(this.contextMenuActions,function(t){var n=e.acl.hasAccessToModel(t.access||t.name,s),r=t.isEnabled&&t.isEnabled.call(a,s);n&&r&&(t.name!=="follow"||!f)&&(t.name!=="unfollow"||f)&&(o.push(t),u.push(e.lang.get(t.label)))}),u.length>0&&e.nomad._showActionSheet(e.lang.get("LBL_SELECT_ACTION_LABEL"),u,function(i,u){function c(){a[f.action].call(a,t,s),a.activeListItem=null}var f=o[u],l=_.isFunction(f.isMultiple)&&f.isMultiple.call(a,s);a.onCloseContextMenuActionSheet(n),e.routing.emulateBackButton&&!l?e.activeComponents.executeOnActiveComponentClose(c):c();if(e.isNative)return;return l?!1:!0},function(){a.onCloseContextMenuActionSheet(n),a.activeListItem=null}),s.off("docs:ready"),s.on("docs:ready",function(e){s.docData=e}),s.getDocuments(this.modContextData[s.module].docFields)},onCloseContextMenuActionSheet:function(e){e.removeClass("selected-item"),this.disableListItemClick=!1},loadData:function(t){this.collection.dataFetched=!1,e.view.NomadView.prototype.loadData.call(this,t)},_dispose:function(){this.destroyPullToRefresh(),this.scroll&&(this.scroll.destroy(),this.scroll=null),this.activeListItem=null,this.disableListItemClick=!1,e.view.NomadView.prototype._dispose.apply(this)},_getRelateSubpanel:function(t){var n=this.module;return _.find(e.nomad.getSubpanels(t),function(e){return e.module===n})},_extractId:function(e,t){var n=new RegExp((t||this.module)+"|"+this.cid,"g");return e.replace(n,"")},isCurrentListUpdated:function(e){var t=e.relationsData,n=this.context.get("parentModule"),r=this.context.get("link");return e.isCollection&&t&&t.link===r&&t.relatedModule===this.module&&e.module===n||!t&&e.module===this.module||this.module==="Home"&&(e.module==="Meetings"||e.mixedCollection)}})}(SUGAR.App),function(e){e.view.views.TextareaEditView=e.view.NomadView.extend({editElTag:"textarea",globalEvents:{"app:header:save":"save","app:header:cancel":"cancel"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t)},getHeaderData:function(){var e=this.options.editedFieldName;return{title:e,save:!this.options.isReadOnly,saveLabel:"LBL_DONE_BUTTON_LABEL",cancel:!0}},setValue:function(e){var t=this.$(this.editElTag);t.val(e);if(e||this.options.isReadOnly)return;_.delay(function(){t.attr("tabindex",1e5).attr("name","somename").get(0).focus()},0)},getValue:function(){return this.$(this.editElTag).val()},save:function(){this.trigger("textarea:edit:saved",this.getValue())},cancel:function(){this.trigger("cancel:clicked")}})}(SUGAR.App),function(e){e.view.views.EmailbodyEditView=e.view.views.TextareaEditView.extend({events:{"click .email-body-content a":function(t){t.preventDefault(),t.stopPropagation();var n=t.target.getAttribute("href");e.nomad.openUrl(n)}},getHeaderData:function(){var e=this.options.editedFieldName;return{title:e,save:!1,cancel:!0}}})}(SUGAR.App),function(e){e.view.views.DetailView=e.view.NomadView.extend({className:"summary-view",events:{"click .record-action .phone:not(.disabled)":function(){var t=this._checkFieldsAccess(this.phoneFields),n=this.model.getFieldsDataArray(t);e.nomad.callPhone(n,this.model)},"click .record-action .email:not(.disabled)":function(){var t=this._checkFieldsAccess(this.emailFields),n=this.model.getFieldsDataArray(t),r=e.nomad.utils.extractAndSortEmails(n);_.isEmpty(r)||e.nomad.sendEmail(r)},"click .record-action .message:not(.disabled)":function(){var t=this._checkFieldsAccess(this.phoneFields),n=this.model.getFieldsDataArray(t);e.nomad.sendSms(n)},"click .record-action .link:not(.disabled)":function(){var t=this._checkFieldsAccess(this.urlFields),n=this.model.getFieldsDataArray(t,e.view.fields.UrlField.prototype.regexp);e.nomad.openUrl(n)},"click .record-action .map:not(.disabled)":function(){var t=this._checkFieldsGroupsAccess(this.addressFieldsGroups),n=this.model.getAddresses(t);e.nomad.openAddress(n)},"click .record-action .doc:not(.disabled)":function(){_.isEmpty(this.docData)?e.nomad.showAlert(e.lang.getAppString("ERR_NO_DOCS")):e.nomad.openDoc(this.docData)},"click .record-action .emailbody:not(.disabled)":function(){e.nomad.showEmailBody(this.emailbodyFields,this.model)},"click .show-more":"toggleSummaryView"},plugins:["fast-click-highlight"],globalEvents:{"app:header:cancel":"exit","data:sync:complete":function(){e.session.set(this.model.id,this.model.attributes),this.model.getDocuments(this.docFields),this._renderActionButtons()},"field:image:filechanged":"_onImageFieldFilechanged","offline:data:updated":function(e){if(e.id!==this.model.id)return;if(e.action==="delete"){this.showRecordDeletedOverlay(e.data);return}this.model.fetch({params:{skipServerSync:!0}})},"data:sync:error":"_onDataSyncError"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.initLabels();var n,r=[],i=this.context.get("link"),s=999;i&&(r=this.initRelationshipFields(this.context.get("parentModule"),i),r&&r.length>s&&(r.length=s),r||(r=[])),n=e.nomad.contextMeta.detail[this.model.module],this.headerField=n.headerField,this.showIcon=n.showIcon,this.imageField=n.imageField,this.subpanels=n.subpanels,this.subpanels=_.filter(this.subpanels,function(t){return e.acl.hasAccess("list",t.module)}),this.hasLinkableSubpanels=n.hasLinkableSubpanels,this.hasCreatableSubpanels=n.hasCreatableSubpanels,this.phoneFields=n.phoneFields,this.emailFields=n.emailFields,this.urlFields=n.urlFields,this.docFields=n.docFields,this.emailbodyFields=n.emailbodyFields,this.otherFields=_.union(r,n.otherFields),this.addressFieldsGroups=n.addressFieldsGroups,this.actions=n.actions,this._setDocLoading(!0),this.actions.available=n.actions.available,this.followable=e.nomad.canFollow(this.model)},initLabels:function(){this.labelShowMore=e.lang.getAppString("LBL_MOBILE_DETAIL_SHOW_MORE"),this.labelShowLess=e.lang.getAppString("LBL_MOBILE_DETAIL_SHOW_LESS")},_renderHtml:function(){this.model.off("change:attachment_list docs:ready"),this.model.on("change:attachment_list",function(){this.model.getDocuments(this.docFields)},this),this.model.on("docs:ready",function(e){this.docData=e,this._setDocLoading(!1),this._renderActionButtons()},this),e.view.NomadView.prototype._renderHtml.call(this)},_renderActionButtons:function(){var t=this.actions,n=this._checkFieldsAccess(this.phoneFields),r=this._checkFieldsAccess(this.emailFields),i=this._checkFieldsAccess(this.urlFields),s=this._checkFieldsGroupsAccess(this.addressFieldsGroups);t.phone&&(t.phone.state=!!this.model.isDataDefined(n)),t.message&&(t.message.state=!!this.model.isDataDefined(n)),t.email&&(t.email.state=this.model.hasActiveEmail(r)),t.url&&(t.url.state=!!this.model.isDataDefined(i,e.view.fields.UrlField.prototype.regexp)),t.map&&(t.map.state=_.any(this.model.getAddresses(s))),t.doc&&(t.doc.state=e.nomad.utils.docIsAvailable(this.docData)),t.emailbody&&(t.emailbody.state=!!this.emailbodyFields);var o=e.template.get("record-actions"),u=this.$(".record-action");e.config.analytics.enabled&&e.analytics.detachAnalytics(u),u.html(o(t)),e.config.analytics.enabled&&e.analytics.attachAnalytics(u)},_checkFieldsGroupsAccess:function(e){var t={};return _.each(e,function(e,n){e=this._checkFieldsAccess(e),e.length&&(t[n]=e)},this),t},_checkFieldsAccess:function(t){return t=_.filter(t,function(t){return e.acl.hasAccessToModel("read",this.model,t.name)},this),t||[]},_setDocLoading:function(e){if(!this.actions.doc)return;this.actions.doc.loading=e},getHeaderData:function(){var t=this.context.get("link")?e.lang.get("LBL_RELATED_MODULE",this.module,this.moduleSingular):this.moduleSingular;return{title:t,cube:!0,plus:!0,back:!0,hasRels:this.hasLinkableSubpanels,hasCreatableRels:this.hasCreatableSubpanels}},onBeforeRender:function(){this.model.dataFetched=!1,this.expanded=this.getState("expanded")||!1},onAfterRender:function(){e.view.NomadView.prototype.onAfterRender.apply(this,arguments),this.initShowMore(),this._renderActionButtons();if($.os.ios&&window.ScrollFix)var t=new ScrollFix(this.$el.find(".card").get(0)),n=new ScrollFix(this.$el.find(".scroll").get(0))},toggleSummaryView:function(){return this.expanded?(this.$el.removeClass("bizcard-more"),this.showMoreEl.text(this.labelShowMore)):(this.$el.addClass("bizcard-more"),this.showMoreEl.text(this.labelShowLess)),this._redrawScrollFix(),this.expanded=!this.expanded,this.setState("expanded",this.expanded),!1},_redrawScrollFix:function(){this.el.querySelector(".card").style.display="none",this.el.querySelector(".card").offsetHeight,this.el.querySelector(".card").style.display="block",this.el.querySelector(".scroll").style.display="none",this.el.querySelector(".scroll").offsetHeight,this.el.querySelector(".scroll").style.display="block"},initShowMore:function(){var e=this.$el.find(".bizcard");this.$el.toggleClass("bizcard-more",this.expanded),this.showMoreEl=e.find(".show-more")},_onImageFieldFilechanged:function(t,n,r){r==="fileselected"?t.prepareFile():r==="preparing"?this._showOverlay():r==="prepared"?this._postFile(t,n):r==="error"&&(this._hideOverlay(),e.alert.show("file_upload_error",{level:"error",messages:arguments[1],autoClose:!0,closeable:!0}),this.render())},_showOverlay:function(){e.overlay.show("uploading_image",{spinner:!1}),e.alert.show("upload_mask",{level:"info",messages:e.lang.getAppString("LBL_MOBILE_UPLOAD_IN_PROGRESS"),autoClose:!1,closeable:!1})},_hideOverlay:function(){e.overlay.hide("uploading_image"),e.alert.dismiss("upload_mask")},_postFile:function(t,n){var r={success:_.bind(function(n){e.alert.show("file_upload_success",{level:"success",messages:e.lang.getAppString("LBL_MOBILE_UPLOAD_SUCCESS"),autoClose:!0,closeable:!0}),this.model.set(t.name,n[t.name].name),this.model.getDocuments(this.docFields),this._hideOverlay()},this),error:_.bind(function(n){e.alert.show("file_upload_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_UPLOAD"),autoClose:!0,closeable:!0}),t.render(),this._hideOverlay()},this)};this.model.uploadFile(t.name,n,r,{htmlJsonFormat:!1})},_onDataSyncError:function(e,t,n,r){t===this.model&&r.status===404&&this.showRecordDeletedOverlay(t)}})}(SUGAR.App),function(e){var t=e.view.NomadView.prototype.exit;e.view.views.EditView=e.view.NomadView.extend({_bodyScroll:!0,events:{"click .delete":"deleteRecord"},plugins:["fast-click-highlight","clear-field","hide-alerts-onfocus"],globalEvents:{"app:header:save":"saveRecord","app:header:cancel":"cancel","data:sync:success":"_onDataSyncSuccess","data:sync:error":"_onDataSyncError","field:image:filechanged":"_onImageFieldFilechanged","field:image:fileclear":"_onImageFieldFileclear","offline:data:updated":function(t){if(t.isCollection||t.id!==this.model.id)return;if(t.action==="delete"){this.showRecordDeletedOverlay(t.data);return}if(t.date_modified===this._modelBackup.date_modified)return;var n=e.lang.getAppString("LBL_OFFLINE_MERGE_DATA_CONFIRM"),r=_.pick(this.model.attributes,this._getChangedFields());_.isEmpty(r)?this.model.fetch({params:{skipServerSync:!0}}):e.nomad.showConfirm(n,_.bind(function(e){this.model.fetch({params:{skipServerSync:!0},dataToMerge:e===2?r:null})},this))}},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this._fileUploads={},this._modelBackup=null,this.relateFields=null,this.selectedItem=null;var n=this.context.get("link");if(n){var r=this.context.get("parentModule"),i=e.data.getRelateFields(r,n);this.relateFields=_.isEmpty(i)?null:_.pluck(i,"name"),this.initRelationshipFields(r,n)}},_render:function(){var t=this.context.isCreate()?"create":"edit";if(t==="create")this.action="create";else{this.isReadOnly=!e.acl.hasAccessToModel(t,this.model)||e.config.nonEditableModules.indexOf(this.model.module)>=0;var n=this.isReadOnly?"view":"edit";this.action=n,this.name=n}e.view.NomadView.prototype._render.call(this)},onBeforeRender:function(){this.model.dataFetched=!1,this.model.off("error:validation"),this.model.on("error:validation",function(){e.alert.show("validation_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_VALIDATION"),autoClose:!0})},this)},onAfterRender:function(){this._isSendInvitesFieldExist=this.module==="Calls"||this.module==="Meetings";if(!this.context.isCreate()&&this._isSendInvitesFieldExist){var t=this.getField("invitees");t&&t.$el.hide()}this.context.isCreate()&&this._isSendInvitesFieldExist&&this.model.set({send_invites:!1}),e.view.NomadView.prototype.onAfterRender.apply(this,arguments);var n,r,i,s=e.metadata.getStrings("mod_strings")[this.module],o=s?s.LBL_RELATED_RECORD_DEFAULT_NAME:null,u=this.context.isCreate(),a=this.context.get("link"),f=this.context.get("parentModule");o&&u&&a&&!this.context.get("dupe")&&(n=e.session.get(this.context.get("parentModelId")),r=_.bind(function(t){if(t){o=e.lang.get("LBL_RELATED_RECORD_DEFAULT_NAME",this.module,t);var n=e.metadata.getModule(this.module),r=n?n.fields.name:null,i=r?r.len:null;i&&i<o.length&&(o=o.substr(0,i-3)+"..."),this.model.set("name",o)}},this),n?r(n.full_name||n.name):this.context.get("parentModel").fetch({success:function(e){r(e.get("full_name")||e.get("name"))}})),u&&a&&e.nomad.isStandardModule(f)&&(i=_.bind(this._populateParentInfo,this),n=e.session.get(this.context.get("parentModelId")),n?i(n,f,a):this.model.link&&this.model.link.bean.fetch({success:_.bind(function(e){i(e.toJSON(),f,a)},this)}));if(u){var l=e.metadata.getModule(this.module).fields.assigned_user_name;if(l&&l.type==="relate"){var c={};c[l.id_name]=e.user.get("id"),c[l.name]=e.user.get("full_name"),this.model.set(c)}var h=e.metadata.getModule(this.module).fields.team_name;if(h){var p=this.model.get(h.name)||e.user.getPreference("default_teams")||[];p.length||p.push({id:1,name:"Global",primary:!0}),this.model.set(h.name,p)}}this.$(".btn.delete").hide()},_populateParentInfo:function(t,n){var r=this.model.fields;(n==="Accounts"||t.account_id)&&r.account_id&&r.account_name&&e.acl.hasAccessToModel("edit",this.model,"account_name")&&this.model.set({account_id:t.account_id||t.id,account_name:t.account_name||t.name})},getHeaderData:function(){var t=this.onlyRelationshipEdit,n=this.context.get("link"),r=this.context.get("create"),i;return t?i=e.lang.getAppString("LBL_MOBILE_EDIT_REL"):r?i=n?e.lang.get("LBL_CREATE_RELATED",this.module,this.moduleSingular):e.lang.get("LBL_CREATE_MODULE",this.module,this.moduleSingular):this.isReadOnly?i=n?e.lang.get("LBL_RELATED_MODULE",this.module,this.moduleSingular):this.moduleSingular:i=n?e.lang.get("LBL_EDIT_RELATED",this.module,this.moduleSingular):e.lang.get("LBL_EDIT",this.module,this.moduleSingular),{title:i,save:!this.isReadOnly,cancel:!0}},_onDataSyncSuccess:function(e,t,n){this._onDataSyncComplete(e,t,n,null)},_onDataSyncError:function(e,t,n,r){this._onDataSyncComplete(e,t,n,r),t===this.model&&r.status===404&&this.showRecordDeletedOverlay(t)},_onDataSyncComplete:function(t,n,r,i){!this.context.isCreate()&&this.context.isDataFetched()&&(t==="read"&&this.backupModel(),e.config.nonEditableModules.indexOf(this.model.module)===-1&&this.action!==(e.acl.hasAccessToModel("edit",this.model)?"edit":"view")&&(this.render(),e.trigger("app:header:changed",this.getHeaderData())),this.model.hasDeleteAccess()&&(!i||t!=="read")&&this.$(".btn.delete").show())},deleteRecord:function(){var t=this,n=this.context.get("fromListView")?-1:-2;e.nomad.showConfirm(e.lang.getAppString("LBL_MOBILE_DELETE_CONFIRM"),function(e){e===2&&t.model.destroy({success:function(){t.exit(-n,!0)},wait:!0})})},saveRecord:function(t){var n=this.context.get("create");this._removeErrorMessages(),this.context.get("dupe")&&this.context.set("depth",2);var r=this,i=this.getFieldNames(!0),s=this.context.get("dupe")?_.keys(this.model.attributes):this._getChangedFields(i);t=t||[],(this._sendParentId||_.include(s,"parent_id"))&&t.push("parent_id","parent_type","parent_name"),s=_.isEmpty(s)?null:_.union(s,t);var o=r.model.get("send_invites"),u=[function(e){r._isSendInvitesFieldExist&&r.context.isCreate()&&r.model.unset("send_invites",{silent:!0}),r._validateAndSave(e,s,i)}];_.each(this._fileUploads,function(e){u.push(_.bind(e,this))},this);var a=this.model.get("invitees");if(a){var f=_.map(a,function(t){return function(n){var i=e.data.createRelatedBean(r.model,t.id,t.link);i.save(null,{relate:!0,disableGlobalDataAlerts:!0,fields:["id"],success:function(){n()},error:function(e){n(e)}})}});u=u.concat(f)}var l=async.series;this._isSendInvitesFieldExist&&o&&this.context.isCreate()&&u.push(function(e){r.model.set({send_invites:o},{silent:!0}),r._saveRecord(e,["send_invites"])}),l(u,function(t){e.nomad.showDataSyncEndAlert(e.lang.getAppString("LBL_SAVED"),t),t?t.isFileUploadError?(e.alert.show("file_upload_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_UPLOAD"),autoClose:!0,closeable:!0}),r.exit(null,n)):r.model&&r._isSendInvitesFieldExist&&r.model.set({send_invites:o},{silent:!0}):(r.trigger("edit:view:save"),r.exit(null,n))})},_validateAndSave:function(t,n,r){var i={};_.isEmpty(r)||(_.each(this.fields,function(t){if(t.def.required&&t.type!=="address"||_.contains(r,t.name)&&(!t.def.calculated||!t.def.enforced))i[t.name]=t.def;if(t.type==="address"){var n=t.module;_.each(t.fieldNames,function(t){i[t]=e.metadata.getModule(n).fields[t]})}}),e.controller.context.get("dupe")&&(i=_.reject(i,function(t,n){return!e.acl.hasAccessToModel("edit",this.model,n)},this)));var s=this;this.model.doValidate(i,function(e){e?_.isEmpty(n)?(s.cancel(),t(!0)):s._saveRecord(t,s._omitImageFields(n)):t(!0)})},_shouldUpdateNameAndFullname:function(t){if(_.intersection(t,["first_name","last_name","salutation"]).length===0)return!1;var n=e.metadata.getModule(this.model.module).fields,r=n.name,i=n.full_name,s="last_name";return r&&i&&r.group===s&&i.group===s},_saveRecord:function(t,n){if(e.offlineEnabled)if(this._shouldUpdateNameAndFullname(n)){var r=e.utils.formatNameModel(this.model.module,this.model.attributes);this.model.set("full_name",r),this.model.set("name",r),n.push("full_name"),n.push("name")}else this.model.module==="Documents"&&_.contains(n,"document_name")&&(this.model.set("name",this.model.get("document_name")),n.push("name"));e.nomad.showDataSyncStartAlert(e.lang.getAppString("LBL_SAVING")),_.isEmpty(n)?t():this.model.save(null,{relate:!this._viaParent&&!!this.context.get("link"),disableGlobalDataAlerts:!0,fields:n,modelBackup:this._modelBackup,success:function(){t()},error:function(e){t(e)}})},cancel:function(){this._fileUploads={},this.restoreModel(),this.exit(),this.trigger("cancel:view"),this._removeErrorMessages()},_removeErrorMessages:function(){this.$(".controls").find(".error-display").remove(),this.$(".control-group").removeClass("error")},backupModel:function(t){this._modelBackup=e.utils.deepCopy(t||this.model.attributes)},restoreModel:function(){this.model.set(this.model.getChangeDiff(this._modelBackup))},_getChangedFields:function(){return _.keys(this.model.getChangeDiff(this._modelBackup))||[]},_omitImageFields:function(t){var n=_.filter(e.metadata.getModule(this.module).fields,function(e){return e.type==="image"}).map(function(e){return e.name});return _.difference(t,n)},_onImageFieldFilechanged:function(t,n,r){var i=this;r==="fileselected"?(this._showOverlay(),t.prepareFile()):r==="prepared"?(this._hideOverlay(),this._enqueueFileHandler("create",t,n),i.model.set(t.name,t.name,{silent:!0}),i.model.doValidate([t.name],function(e){e&&t.handleValidationError()})):r==="error"&&(this._hideOverlay(),e.alert.show("file_upload_error",{level:"error",messages:arguments[1],autoClose:!0,closeable:!0}),this.render())},_onImageFieldFileclear:function(e){this._enqueueFileHandler("delete",e),this.model.set(e.name,"",{silent:!0})},_enqueueFileHandler:function(t,n,r){var i,s=this;t==="create"?i=function(e){var t={success:function(){s.model.trigger("change:attachment_list"),e()},error:function(t){e(t)}};this.model.uploadFile(n.name,r,t,{htmlJsonFormat:!1})}:t==="delete"&&(i=function(t){var r={success:function(e,r){s.model.unset(n.name),s.model.trigger("change:attachment_list"),t()},error:function(e){e.isFileUploadError=!0,t(e)}};e.api.file("delete",{module:this.module,id:this.model.id,field:n.name},null,r,{htmlJsonFormat:!1})}),this._fileUploads[n.name]=i},_showOverlay:function(){e.overlay.show("preparing_image",{spinner:!1}),e.alert.show("upload_mask",{level:"info",messages:e.lang.getAppString("LBL_MOBILE_PROCESSING_IMAGE"),autoClose:!1,closeable:!1})},_hideOverlay:function(){e.alert.dismiss("upload_mask"),e.overlay.hide("preparing_image")},exit:function(n,r){var i=arguments,s=this.context.get("create");if(r&&s&&e.config.detailAfterCreate){var o=[this.module,this.model.id].join("/");$.os.android&&!$.browser.chromeMobile?(window.history.replaceState(null,null,"#"+o),Backbone.history.loadUrl(o)):e.router.navigate(o,{replace:!0,trigger:!0}),i[0]=0}t.apply(this,i)}})}(SUGAR.App),function(e){e.view.views.EditRelationshipView=e.view.views.EditView.extend({initialize:function(t){e.view.views.EditView.prototype.initialize.call(this,t),this.template=e.template.get("edit"),this.meta=e.metadata.getView(this.module,"edit"),this.fallbackFieldTemplate="edit",this.onlyRelationshipEdit=!0},saveRecord:function(){this.trigger("edit:view:save")},exit:function(){}})}(SUGAR.App),function(e){e.view.views.ListSelectorView=e.view.views.ListView.extend({events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .menu-item":"onClickMenuItem"})},disabledPlugins:["fast-click-highlight"],contextMenuDisabled:!0,globalEvents:{"app:header:save":"save","app:header:cancel":"onCancel","data:sync:start":"onDataSyncStart","data:sync:success":"onDataSyncSuccess","data:sync:error":"onDataSyncError","app:view:beforechange":"onBeforeViewChanged"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.meta=e.metadata.getView(this.module,"list"),this.fallbackFieldTemplate="list"},onBeforeRender:function(){this.selected=[],_.each(this.$(".selected-flag:checked"),function(e){var t=this._extractId($(e).closest("article").attr("id"));this.selected.push(t)},this),e.view.views.ListView.prototype.onBeforeRender.call(this)},onAfterRender:function(){_.isEmpty(this.selected)||_.each(this.selected,function(e){this.selectItem(this.$("article[id="+this.cid+this.module+e+"]"))},this),this.selected=[],e.view.views.ListView.prototype.onAfterRender.call(this)},onClickMenuItem:function(e){!e.defaultPrevented&&!e.cancelBubble&&this.selectItem($(e.currentTarget).closest("article"))},selectItem:function(e){e.toggleClass("selected-item");var t=e.hasClass("selected-item");e.find(".selected-flag").prop("checked",t)},onCancel:function(){e.router.goBack()}})}(SUGAR.App),function(e){e.view.views.ListAssociateView=e.view.views.ListSelectorView.extend({initialize:function(t){e.view.views.ListSelectorView.prototype.initialize.call(this,t),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-associate")}),this.parentModule=this.context.get("toModule"),this.parentId=this.context.get("toId"),this.link=this.context.get("viaLink"),this.parentModel=this.context.get("parentModel")||e.data.createBean(this.parentModule,{id:this.parentId}),this.relFieldNames=e.data.getRelationshipFields(this.parentModule,this.link),this.multiselect=e.data.canHaveMany(this.parentModule,this.link),e.logger.debug("Record(s) are to be associated with "+this.parentModel+" via link "+this.link),e.logger.debug("Multiselect: "+this.multiselect),this.initRelationshipFields(this.parentModule,this.link)},onBeforeRender:function(){var t=this.parentId,n=this.collection.get(t);n&&this.collection.remove(n,{silent:!0}),e.view.views.ListSelectorView.prototype.onBeforeRender.call(this)},getHeaderData:function(){var t=e.lang.get("LBL_ASSOC",this.module,this.moduleSingular);return{title:t,save:!0,cancel:!0}},save:function(){var t=this.$(".selected-flag:checked");t.length===0?e.nomad.showAlert(e.lang.getAppString("ERR_NO_RECORDS_SELECTED"),function(){}):this._save(t)},_save:function(t){var n=this,r;e.nomad.showDataSyncStartAlert(e.lang.getAppString("LBL_SAVING"));var i=async.queue(function(e,t){e.relateBean.save(null,{disableGlobalDataAlerts:!0,relate:!0,fields:["id"],success:function(){t()},error:function(e){r=e,t(e)}})},1);i.drain=function(){e.nomad.showDataSyncEndAlert(e.lang.getAppString("LBL_SAVED"),r),r||n.exit(null,!0)},t.each(function(){var t=n._extractId($(this).closest("article").attr("id"));i.push({relateBean:e.data.createRelatedBean(n.parentModel,t,n.link)})})}})}(SUGAR.App),function(e){e.view.views.ListPickerView=e.view.NomadView.extend({events:{"click .picker-list-row":"onRowClick"},plugins:["fast-click-highlight"],globalEvents:{"app:view:beforechange":"onBeforeViewChanged","app:header:cancel":function(){this.trigger("cancel:clicked")}},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.data={}},_renderHtml:function(t){e.view.NomadView.prototype._renderHtml.call(this,t)},getHeaderData:function(){return{title:e.lang.getAppString("LBL_CHOOSE_LINK"),cancel:!0,plus:!1}},setData:function(e){this.data=e},onRowClick:function(e){var t=$(e.currentTarget).closest(".picker-list-row");t&&this.trigger("row:clicked",t.attr("entity-name"),t.attr("module"))},onAfterShow:function(){this.scroll&&this.scroll.destroy(),window.EasyScroller&&(this.scroll=new window.EasyScroller(this.layout.el,$("#content").get(0),{scrollingY:!0,scrollingX:!1}))},_dispose:function(){this.scroll&&(this.scroll.destroy(),this.scroll=null),e.view.NomadView.prototype._dispose.apply(this)}})}(SUGAR.App),function(e){e.view.views.ListRelateView=e.view.views.ListView.extend({events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .menu-item":"onClickMenuItem"})},contextMenuDisabled:!0,globalEvents:{"app:header:cancel":function(){this.trigger("menu:cancel:clicked")},"data:sync:start":"onDataSyncStart","data:sync:success":"onDataSyncSuccess","data:sync:error":"onDataSyncError","app:view:beforechange":"onBeforeViewChanged"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.meta=e.metadata.getView(this.module,"list"),this.fallbackFieldTemplate="list",this.setTemplateOption("partials",{"list-item":e.template.get("list-item-relate")})},onClickMenuItem:function(e){if(!e.defaultPrevented&&!e.cancelBubble){var t=this._extractId($(e.target).closest("article").attr("id")),n=this.collection.get(t);this.trigger("menu:item:clicked",n)}},getHeaderData:function(){return{title:e.lang.get("LBL_ASSIGN",this.module,this.moduleSingular),cancel:!0,plus:!1}}})}(SUGAR.App),function(e){e.view.views.ListTeamsetView=e.view.views.ListSelectorView.extend({globalEvents:{"app:header:cancel":function(){this.trigger("multienum:cancel:clicked")}},initialize:function(t){e.view.views.ListSelectorView.prototype.initialize.call(this,t),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-teamset")})},save:function(){var e=[],t=this;this.$(".selected-flag:checked").each(function(){var n=t._extractId($(this).closest("article").attr("id"));e.push(t.collection.get(n))},this),this.trigger("multienum:save:clicked",e)},getHeaderData:function(){return{title:e.lang.getAppString("LBL_MOBILE_SELECT_TEAMS"),cancel:!0,save:!0,saveLabel:"LBL_DONE_BUTTON_LABEL",plus:!1}}})}(SUGAR.App),function(e){e.view.views.ListMultiselectView=e.view.views.ListPickerView.extend({events:function(){return _.extend({},e.view.views.ListPickerView.prototype.events,{"click .picker-list-row":"onRowClick"})},disabledPlugins:["fast-click-highlight"],globalEvents:{"app:header:cancel":function(){this.trigger("cancel:clicked")},"app:header:save":"onClickSave"},initialize:function(t){e.view.views.ListPickerView.prototype.initialize.call(this,t),this.template=e.template.get("list-multiselect")},_renderHtml:function(){e.view.views.ListPickerView.prototype._renderHtml.call(this,this.data)},getHeaderData:function(){return{title:e.lang.getAppString("LBL_CHOOSE_ITEMS"),save:!0,saveLabel:"LBL_DONE_BUTTON_LABEL",cancel:!0,plus:!1}},onRowClick:function(e){this.selectItem($(e.currentTarget).closest("article"))},selectItem:function(e){e.toggleClass("selected-item");var t=e.hasClass("selected-item");e.find(".selected-flag").prop("checked",t)},onClickSave:function(){var e=[];this.$(".selected-flag:checked").each(function(){e.push($(this).attr("key"))}),this.trigger("multienum:save:clicked",e)}})}(SUGAR.App),function(e){e.view.views.ListParentView=e.view.views.ListView.extend({events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .parent-item":"onClickParentItem"})},globalEvents:{"app:header:save":"save","app:header:cancel":"onCancel","data:sync:start":"onDataSyncStart","data:sync:success":"onDataSyncSuccess","data:sync:error":"onDataSyncError","app:view:beforechange":"onBeforeViewChanged"},contextMenuDisabled:!0,initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.meta=e.metadata.getView(this.module,"list"),this.fallbackFieldTemplate="list",this.setTemplateOption("partials",{"list-item":e.template.get("list-item-parent")})},getHeaderData:function(){return{title:e.lang.get("LBL_ASSIGN",this.module,this.moduleSingular),cancel:!0,plus:!1,save:!1}},onClickParentItem:function(e){this.$selectedItem&&this.selectItem(this.$selectedItem,!1),!e.defaultPrevented&&!e.cancelBubble&&(this.$selectedItem=$(e.currentTarget).closest("article"),this.selectItem(this.$selectedItem,!0));var t=this._extractId(this.$selectedItem.attr("id")),n=this.collection.get(t);this.trigger("menu:item:clicked",n)},selectItem:function(e,t){e[t?"addClass":"removeClass"]("selected-item"),e.find(".selected-flag").prop("checked",t)},save:function(){var t=this.$(".selected-flag:checked");if(t.length===0)e.nomad.showAlert(e.lang.getAppString("ERR_NO_RECORDS_SELECTED"),function(){});else{var n=this._extractId(t.closest("article").attr("id")),r=this.collection.get(n);this.trigger("click:save",r)}},onCancel:function(){this.trigger("click:cancel")}})}(SUGAR.App),function(e){e.view.views.ListInviteesView=e.view.views.ListSelectorView.extend({disabledPlugins:["fast-click-highlight"],contextMenuDisabled:!0,globalEvents:{"app:header:save":"onClickSave"},onClickSave:function(){var t=[],n=this;this.$(".selected-flag:checked").each(function(){var e=n._extractId($(this).closest("article").attr("id"));t.push(n.collection.get(e))});if(t.length===0){e.nomad.showAlert(e.lang.getAppString("ERR_NO_RECORDS_SELECTED"),function(){});return}this.trigger("save:clicked",t)},getHeaderData:function(){return{title:e.lang.get("LBL_ASSOC",this.module,this.moduleSingular),cancel:!0,save:!0,plus:!1}},onCancel:function(){this.trigger("click:cancel")}})}(SUGAR.App),function(e){e.view.views.HomeView=e.view.views.ListView.extend({_numReads:0,globalEvents:{"offline:data:updated":function(e){this.scroll&&this.scroll.reflow();if(this.collection.query)return;this.isCurrentListUpdated(e)&&this.refresh(!0,{myItems:this.collection.myItems,params:{skipServerSync:!0}})}},events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .list-view-item":"onClickItem"})},onDataSyncStart:function(t,n,r){n instanceof e.BeanCollection&&(this.collection.query?this.$(".no-records-found").hide():(t==="read"&&!r.byPtr&&this._numReads++===0?e.nomad.showDataSyncStartAlert(e.lang.getAppString("LBL_LOADING")):t==="read"&&r.byPtr&&e.nomad.showDataSyncOverlay(),this.$("#bucket-"+n.bucketName+" .no-records-found").hide()))},initialize:function(){this.fallbackFieldTemplate="list",e.view.views.ListView.prototype.initialize.apply(this,arguments),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-global-search")})},_renderHtml:function(){this.activityModuleOrder=this.layout.activityBucketsData,e.view.views.ListView.prototype._renderHtml.call(this)},_deleteRecordAction:function(e,t){var n=$(e).closest("article"),r=n.attr("module")||this.module,i=this._extractId(n.attr("id"),r);this.getModel(i,r).destroy({relate:t,wait:!0})},refresh:function(t,n){this.collection.query?e.view.views.ListView.prototype.refresh.call(this,t,n):(e.offlineEnabled&&n.byPtr&&(n.params={forceServerSync:!0}),this.layout.loadData(_.extend(n,{force:!1,disableGlobalDataAlerts:t})))},onDataSyncComplete:function(t,n,r,i){this.hideContextMenu();if(n instanceof e.BeanCollection)if(this.collection.query)n.length||this.$(".no-records-found").show();else{t==="read"&&!r.byPtr&&--this._numReads===0?e.nomad.showDataSyncEndAlert(null,i,t):t==="read"&&r.byPtr&&e.nomad.hideDataSyncOverlay(i,t),this.collection.reset([],{silent:!0}),n.length||this.$("#bucket-"+n.bucketName+" .no-records-found").show(),n.isActivityCollection?this._renderActivityStreamBucket(n):this._renderActivityStream();var s=this.layout.currentRequestList.indexOf(n.bucketName);s>-1&&this.layout.currentRequestList.splice(s,1),this.layout.currentRequestList.length===0&&this.initScroll(),e.config.analytics.enabled&&(e.analytics.detachAnalytics(this.$el),e.analytics.attachAnalytics(this.$el))}else t==="delete"&&this._refreshActivityData(n.module);this.scroll&&this.scroll.reflow()},onLongTapItem:function(t){if(!_.isEmpty(this.collection.query))return;e.view.views.ListView.prototype.onLongTapItem.call(this,t)},_refreshActivityData:function(e){var t=this.getCollections(e);for(var n=0;n<t.length;n++)t[n].fetch(t[n].fetchConfig),this.layout.currentRequestList.push(t[n].bucketName)},_renderActivityStream:function(){_.each(this.layout.moduleCollections,function(e){this.collection.favorites===e.favorites&&this.collection.myItems===e.myItems?this._renderActivityStreamBucket(e):(e.fetchConfig.favorites=this.collection.favorites,e.fetchConfig.myItems=e.myItemsOnly||this.collection.myItems,e.fetch(e.fetchConfig),this.layout.currentRequestList.push(e.bucketName))},this)},_renderActivityStreamBucket:function(t){var n=e.view.getFieldId();this.createViewDefs(t.module_list||[t.module]),this.setTemplateOption("partials",{"list-item":e.template.get("list-item")});var r=e.template.get("bucket-items"),i=this.$("#bucket-items-"+(t.bucketName||t.module));if(i.length===0){var s=e.template.get("bucket"),o={label:t.label||t.module,name:t.bucketName||t.module,labelNoRecords:this.labelNoRecords};this.$("#activity-stream").append(s(o)),i=this.$("#bucket-items-"+(t.bucketName||t.module))}var u={collection:t,view:this,viewDefs:this.viewDefs};i.html(r(u)),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-global-search")});for(var a=n+1;a<=e.view.getFieldId();++a)this.fields[a]&&this._renderField(this.fields[a]);if(t.models.length===0){var f=this.$("#bucket-"+(t.bucketName||t.module));f.find(".no-records-found").show(),t.displayMore&&f.find("."+(t.bucketName||t.module)+"-more").hide()}},createViewDefs:function(t){var n={};_.each(t,function(t){var r=e.metadata.getView(t,"list").panels;r&&(n[t]=r[0].fields)}),this.viewDefs=n},getModel:function(t,n){var r=e.view.views.ListView.prototype.getModel.call(this,t,n);if(!r){var i=this.getCollections(n);for(var s=0;s<i.length;s++){r=i[s].get(t);if(r)break}}return r},getCollections:function(e){var t=[];return _.each(this.layout.moduleCollections,function(n){n.module_list.indexOf(e)>-1&&t.push(n)}),t},onAfterRender:function(){var t=[];_.each(this.layout.moduleCollections,function(e){t.push(_.map(e.models,function(e){return e.id}))});if(t.length){var n=_.intersection.apply(null,t);_.each(n,function(e){var t;_.each(this.layout.moduleCollections,function(n){if(!t)t=n.get(e);else{var r=n.get(e);r&&r.set(_.extend({},r.attributes,t.attributes))}},this)},this)}e.view.views.ListView.prototype.onAfterRender.call(this)},onItemAdded:function(){this.collection.query&&e.view.views.ListView.prototype.onItemAdded.apply(this,arguments)},_dispose:function(){e.view.views.ListView.prototype._dispose.call(this)}})}(SUGAR.App),function(e){e.view.views.SearchBoxView=e.view.NomadView.extend({plugins:["clear-field"],className:"search-box",touchOutsideEventName:"touchstart.outside",ITEM_TYPE_DELAY:600,events:{"textInput .search-query":"onKeyUp","keyup .search-query":"onKeyUp","cut   .search-query":"onCutOrPaste","paste .search-query":"onCutOrPaste","focusin .search-query":"onFocusIn","click .favorites-btn":"onClickFavoritesBtn","click .my-items-btn":"onClickMyItemsBtn"},globalEvents:{"search:clear:clicked":"onSearchClearClick","search:complete":function(){e.isMenuDisabled=!1,this.hideProgress()},"list:item:clicked":function(){this.timerId&&window.clearTimeout(this.timerId)}},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.isHideMyItems=!!t.isHideMyItems,this.timerId=null,this.searchStateFlag=!1,this.$searchBox=null,this._loadSearchState(),$.os.ios&&this.$el.find(".search-query").on("textInput",this.onKeyUp,this)},_renderHtml:function(){this.isHideMyItems=!e.nomad.supportsMyItems(this.module),e.view.NomadView.prototype._renderHtml.call(this),this.$searchBox=this.$(".search-query")},onAfterShow:function(){this.hideProgress()},onKeyUp:function(t){e.isMenuDisabled=!0,this.searchStateFlag=!0,this._clearTimer();var n=this,r=n.$searchBox.val();this.timerId=window.setTimeout(function(){n.search(r),r===""&&n.focusSearchBox()},this.ITEM_TYPE_DELAY)},onCutOrPaste:function(e){var t=this;window.setTimeout(function(){t.onKeyUp(e)},200)},onFocusIn:function(){this._bindTouchOutside()},onClickFavoritesBtn:function(e){if(this.searchStateFlag)return!1;e.preventDefault();var t=this.context.get("collection");this.fetchByOption($(e.currentTarget),t,"favorites")},onClickMyItemsBtn:function(e){if(this.searchStateFlag)return!1;e.preventDefault();var t=this.context.get("collection");this.fetchByOption($(e.currentTarget),t,"myItems")},fetchByOption:function(t,n,r,i){var s=!this.collection[r];i=i||{},this._setOptionState(t,n,r,i,s),i.byPtr=!1,e.offlineEnabled||(i.error=_.bind(function(){this._setOptionState(t,n,r,i,!s),this._onFetchError(r,!s)},this)),n.options=null,n.fetch(i)},loadData:function(){},_setOptionState:function(e,t,n,r,i){this._changeBtnState(e,i),this._saveSearchState(n,i,this.module),r[n]=i,n==="myItems"&&(r.myItems=t.myItemsOnly||i)},_loadSearchState:function(){var e=this.context.get("collection"),t=this._getSearchState(this.module);e.favorites=t.favorites,e.myItems=t.myItems},_getSearchState:function(t){var n=e.nomad.getSetting("searchState");return n?n[t]||{}:{}},_saveSearchState:function(t,n,r){var i=e.nomad.getSetting("searchState");i=i||{},i[r]=i[r]||{},i[r][t]=n,e.nomad.setSetting("searchState",i)},_changeBtnState:function(e,t){e[t?"addClass":"removeClass"]("active")},_onFetchError:function(e,t){},focusSearchBox:function(){this.$searchBox.get(0).focus(),this.$searchBox.get(0).select()},search:function(e){this.trigger("search:text",e),this.showProgress(),this.searchStateFlag=!1},showProgress:function(){this.$el.addClass("in-progress")},hideProgress:function(){this.$el.removeClass("in-progress")},getFieldNames:function(){return[]},_clearTimer:function(){this.timerId&&window.clearTimeout(this.timerId)},_dispose:function(){this._clearTimer(),e.view.NomadView.prototype._dispose.call(this)},onSearchClearClick:function(){this.searchStateFlag=!0;var e=this;this.timerId=window.setTimeout(function(){e.search("")},e.ITEM_TYPE_DELAY)},_bindTouchOutside:function(){var e=this,t=this.$searchBox.get(0);$(document).bind(this.touchOutsideEventName,function(n){n.target!==t&&(document.activeElement.blur(),e._unbindTouchOutside())})},_unbindTouchOutside:function(){$(document).unbind(this.touchOutsideEventName)}})}(SUGAR.App),function(e){e.view.views.GlobalSearchBoxView=e.view.views.SearchBoxView.extend({initialize:function(t){e.view.views.SearchBoxView.prototype.initialize.call(this,t),this.isGlobalSearch=!0,this.template=e.template.get("search-box"),this.collection.myItems=!0},onClearSearch:function(){e.view.views.SearchBoxView.prototype.onClearSearch.call(this)},onClickFavoritesBtn:function(t){t.preventDefault(),_.isEmpty(this.context.get("collection").query)?_.isEmpty(this.$searchBox.val())&&(_.each(this.layout.moduleCollections,function(e){e.fetchConfig.params={},this.fetchByOption($(t.currentTarget),e,"favorites",e.fetchConfig)},this),this.collection.favorites=!this.collection.favorites):e.view.views.SearchBoxView.prototype.onClickFavoritesBtn.call(this,t)},onClickMyItemsBtn:function(t){t.preventDefault(),_.isEmpty(this.context.get("collection").query)?_.isEmpty(this.$searchBox.val())&&(_.each(this.layout.moduleCollections,function(e){e.fetchConfig.params={},this.fetchByOption($(t.currentTarget),e,"myItems",e.fetchConfig)},this),this.collection.myItems=!this.collection.myItems):e.view.views.SearchBoxView.prototype.onClickMyItemsBtn.call(this,t)},_onFetchError:function(e,t){this.collection&&(this.collection[e]=t)}})}(SUGAR.App),function(e){e.view.views.ActivityEditView=e.view.views.EditView.extend({_populateParentInfo:function(t,n,r){var i=e.acl.hasAccessToModel("edit",this.model,"parent_name"),s=e.acl.hasAccessToModel("edit",this.model,"contact_name"),o=e.metadata.getRelationship(e.metadata.getModule(n,"fields")[r].relationship)||{};o.via_parent_id&&(this._viaParent=!0),n==="Contacts"?(s&&(this.model.set({contact_id:t.id,contact_name:t.full_name||t.name}),this._sendContactId=!0),i&&(this.model.set({parent_id:t.account_id,parent_type:"Accounts",parent_name:t.account_name}),this._sendParentId=!0)):i&&(this.model.set({parent_name:t.name,parent_id:t.id,parent_type:n}),this._sendParentId=!0)},saveRecord:function(t){t=t||[],this._sendContactId&&t.push("contact_id"),e.view.views.EditView.prototype.saveRecord.call(this,t)}})}(SUGAR.App),function(e){e.view.views.MeetingCallEditView=e.view.views.ActivityEditView.extend({onAfterRender:function(){e.view.views.ActivityEditView.prototype.onAfterRender.call(this),this.context.isCreate()&&this.model.fields.duration_hours&&!this.model.has("duration_hours")&&this.model.set({duration_hours:0,duration_minutes:"15"})},saveRecord:function(t){this.model.unset("date_end"),t=t||[],t.push("send_invites"),this._adjustReminder("reminder"),this._adjustReminder("email_reminder"),e.view.views.ActivityEditView.prototype.saveRecord.call(this,t)},_adjustReminder:function(e){var t=e+"_checked",n=e+"_time",r=null;this.model.get(t)?this.model.get(n)=="-1"&&(r=60):r="-1",r&&this.model.set(n,r,{silent:!0})}})}(SUGAR.App),function(e){e.view.views.MobileCallsEditView=e.view.views.MeetingCallEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileMeetingsEditView=e.view.views.MeetingCallEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileNotesEditView=e.view.views.ActivityEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileTasksEditView=e.view.views.ActivityEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileRevenueLineItemsEditView=e.view.views.EditView.extend({onAfterRender:function(){e.view.views.EditView.prototype.onAfterRender.call(this);var t;this.model.link&&(t=this.model.link.bean.id),this.context.isCreate()&&_.isEmpty(this.model.get("opportunity_id"))&&this.model.set("opportunity_id",t)}})}(SUGAR.App),function(e){e.view.views.MobileUsersEditView=e.view.views.EditView.extend({initialize:function(t){e.view.views.EditView.prototype.initialize.apply(this,arguments),this.model.on("change:attachment_list",_.bind(this._onChangeAttachmentList,this))},_onChangeAttachmentList:function(){this.model.hasChanged("picture")&&e.trigger("app:header:picturechanged",this.model.get("picture"))}})}(SUGAR.App),function(e){e.view.views.MobileTxLogListView=e.view.views.ListView.extend({contextMenuActions:[{name:"delete",label:"LBL_ROLLBACK_BUTTON",icon:"icon-trash",action:"onRollbackClick",isEnabled:function(){return!0}}],globalEvents:{"app:header:back":"onBack","data:sync:start":"onDataSyncStart","data:sync:end":"onDataSyncEnd","app:view:beforechange":"onBeforeViewChanged","offline:tx:delete":"onTxDeleted"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-tx-log")}),this.modContextData=e.nomad.contextMeta.list},onAfterRender:function(){e.view.views.ListView.prototype.onAfterRender.apply(this,arguments),this.toggleNoRecLbl()},getHeaderData:function(){return{title:e.lang.get("LBL_TX_LOG"),back:!0}},onBack:function(){e.router.goBack()},onRollbackClick:function(t,n){e.offline.syncManager.isSyncing()?e.nomad.showAlert(e.lang.getAppString("LBL_OFFLINE_SYNC_IN_PROGRESS")):this._rollbackTx(n)},_rollbackTx:function(t){var n=this;e.nomad.showConfirm(e.lang.getAppString("LBL_OFFLINE_ROLLBACK_PROMPT"),function(r){r===2&&e.offline.storage.rollbackTransaction(t.attributes,{},function(r){r?(e.alert.show("rollback_success",{level:"error",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_FAILED"),closeable:!0,autoClose:!0}),e.logger.error(""+r)):(n.collection.remove(n.collection.get(t.id)),e.alert.show("rollback_success",{level:"success",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_SUCCESS"),closeable:!0,autoClose:!0}),e.controller.clean(!0,!0),n.toggleNoRecLbl())})})},onTxDeleted:function(e){var t=this.collection.where({_tx_uid:e.txOptions.txId})[0];this.collection.remove(t),this.toggleNoRecLbl(),this.scroll.reflow()},toggleNoRecLbl:function(){this.collection.length||this.$(".no-records-found").show()}})}(SUGAR.App),function(e){e.view.views.MobileTxLogDetailView=e.view.NomadView.extend({events:{"click .delete:not(.disabled)":"rollbackRecord"},globalEvents:{"app:header:cancel":"exit","offline:tx:delete":"onTxDeleted"},getHeaderData:function(){var t=e.lang.get("LBL_TX_LOG_DETAIL");return{title:t,cancel:!0}},_render:function(){if(!this.model.get("_tx_action"))return;e.view.NomadView.prototype._render.apply(this,arguments)},onBeforeRender:function(){var t=this.model.get("_tx_bean_module"),n=parseInt(this.model.get("_tx_action"),10),r=e.metadata.getModule(t),i=r||{fields:{}};this.updatedFields=e.utils.deepCopy(this.model.get("_tx_updated_fields"));if(this.updatedFields){var s=this.updatedFields.currency_id,o=this.updatedFields.parent_type;o?o=_.clone(o):this.updatedFields.parent_id&&(this.model.attributes.parent_type=this.model.attributes.bean.parent_type);switch(n){case e.offline.SYNC_ACTIONS.CREATE:case e.offline.SYNC_ACTIONS.UPDATE:var u=this._getViewableFields(t);this.updatedFields=u?_.pick(this.updatedFields,this._getViewableFields(t)):this.updatedFields}e.offline.SYNC_ACTIONS.LINK===n||e.offline.SYNC_ACTIONS.UNLINK===n?this.updatedFields.link=!0:_.each(this.updatedFields,function(n,u){if(u==="my_favorite")n.vname="LBL_ACTION_FAVORITE",delete n.before,n.after=""+n.after;else if(u==="following")e.nomad.canFollow(this.model)?(n.vname="LBL_ACTION_FOLLOW",delete n.before,n.after=""+n.after):delete this.updatedFields.following;else{var a=_.contains(["assigned_user_id","deleted","currency_id"],u)||n.type==="id";if(r&&(!i.fields[u]||!e.config.offline.debug.render&&a)){delete this.updatedFields[u];return}n.vname=i.fields[u]||u,_.extend(n,i.fields[u]);var f={def:i.fields[u]||{type:"varchar",name:u},view:this,model:this.model,module:t};f.def.type==="email"&&(f.def=_.defaults({type:"varchar"},f.def),n.before=_.pluck(n.before,"email_address").join(", "),n.after=_.pluck(n.after,"email_address").join(", "));var l=e.view.createField(f),c=e.view.createField(f);if(n.before||n.before===0)l.model.set(u,n.before,{silent:!0}),n.type==="currency"&&s?l.model.set("currency_id",s.before,{silent:!0}):n.type==="parent"&&o&&l.model.set("parent_type",o.before,{silent:!0}),n.before=l.render();c.model.set(u,n.after,{silent:!0}),n.type==="currency"&&s?c.model.set("currency_id",s.after,{silent:!0}):n.type==="parent"&&o&&c.model.set("parent_type",o.after,{silent:!0}),n.after=c.render()}},this)}this.fields={},e.view.NomadView.prototype.onBeforeRender.apply(this,arguments)},_getViewableFields:function(t){var n=e.metadata.getView(t,"edit");return n?_.reduce(n.panels,function(e,t){var n=[];return _.each(t.fields,function(e){e.fields?n.push.apply(n,_.pluck(e.fields,"name")):n.push(e.name)}),_.union(e,n)},[]):null},onAfterRender:function(){e.view.NomadView.prototype.onAfterRender.apply(this,arguments),_.each(this.updatedFields,function(e,t){if(t==="my_favorite"||t==="following"||!e)return;e.before&&(e.before.dispose(),e.before=null),e.after&&(e.after.dispose(),e.after=null)},this)},_rollbackTx:function(){var t=this;e.nomad.showConfirm(e.lang.getAppString("LBL_OFFLINE_ROLLBACK_PROMPT"),function(n){n===2&&e.offline.storage.rollbackTransaction(t.model.attributes,{},function(n){n?(e.alert.show("rollback_success",{level:"error",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_FAILED"),closeable:!0,autoClose:!0}),e.logger.error(""+n)):(t.collection.remove(t.collection.get(t.model.id)),e.alert.show("rollback_success",{level:"success",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_SUCCESS"),closeable:!0,autoClose:!0}),e.controller.clean(!0,!0),e.router.goBack())})})},rollbackRecord:function(t,n){e.offline.syncManager.isSyncing()?e.nomad.showAlert(e.lang.getAppString("LBL_OFFLINE_SYNC_IN_PROGRESS")):this._rollbackTx()},onTxDeleted:function(t){t.txOptions.txId===this.model.get("_tx_uid")&&this.$el.find(".btn.delete").addClass("disabled").html(e.lang.getAppString("LBL_OFFLINE_TRANSACTION_SYNCED"))}})}(SUGAR.App),function(e){e.view.views.MobileReadonlyListView=e.view.views.MobileTeamsListView=e.view.views.ListView.extend({contextMenuActions:[],events:{},initialize:function(t){t.meta=e.metadata.getView(t.module,"list"),e.view.NomadView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-relate")}),this.modContextData=e.nomad.contextMeta.list},getHeaderData:function(){var t=e.view.views.ListView.prototype.getHeaderData.call(this);return delete t.plus,t}})}(SUGAR.App),function(e){e.view.views.ErrorView=e.view.NomadView.extend({className:"list-layout",events:{"click #sugar_url":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)}},errors:{403:"ERR_MOBILE_NOT_AUTHORIZED"},defaultErrorLabel:"ERR_GENERIC_TITLE",onBeforeRender:function(){var t=this.context.get("params");t.backToSugar&&(this.showSugarBackLink=t.backToSugar,this.sugarLink=e.nomad.getDesktopUrl()+"#"+t.sugarRoute),this.errorCode=t.code,this.errorLabel=this.errors[this.errorCode]||this.defaultErrorLabel},getHeaderData:function(){return{title:e.lang.getAppString("ERR_GENERIC_TITLE"),cube:!0}}})}(SUGAR.App),function(e){e.view.fields.BoolField=e.view.NomadField.extend({events:{"touchstart .checkbox":"touchCheckbox"},format:function(e){return e=="1"},onBeforeRender:function(){this.model&&this.view.isEditView()&&!this.model.has(this.name)&&this.model.set(this.name,!1,{silent:!0})},unformat:function(){return!!this.$(this.fieldTag)[0].checked},touchCheckbox:function(e){e.stopPropagation()}})}(SUGAR.App),function(e){e.view.fields.CurrencyField=e.view.NumericField.extend({events:{"change select":"onCurrencySelection"},initialize:function(){e.view.NumericField.prototype.initialize.apply(this,arguments),this.context.isCreate()&&e.metadata.getCurrency(e.user.getPreference("currency_id")).status==="Active"&&this.model.set("currency_id",e.user.getPreference("currency_id"),{silent:!0})},onBeforeRender:function(){_.isEmpty(this.model.get("currency_id"))&&this.model.set("currency_id",e.user.getPreference("currency_id")||"-99",{silent:!0}),this.availableCurrencies=this._getCurrencies()},_getCurrencies:function(){var t=this.model,n=t.get("currency_id"),r=e.user.getPreference("currency_id"),i={},s=e.metadata.getCurrencies(),o;_.each(s,function(e,t){var r=_.clone(e);r.id=t,r.status==="Active"?(i[t]=r,o=r):r.id===n&&(r.disabled=!0,i[t]=r)});var u="-99";n&&_.has(i,n)?u=n:_.has(i,r)&&(u=r);var a=i[u]||o;return a&&(a.selected="selected"),i},onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.call(this),this.$ct=$("select",this.$el),!this.model.get("currency_id")&&this.context.isCreate()&&this.model.changeCurrencyId(this.$ct.find("option[selected]").val(),{silent:!0})},format:function(t){if(!t&&t!==0||_.isString(t)&&t.trim().length===0)return"";var n=t;if(!isNaN(parseFloat(e.currency.unformatAmountLocale(t)))){var r=this.model.get("currency_id"),i=e.user.getPreference("currency_id");if(_.contains(["list","list-associate","list-parent"],this.action)&&r!==i)n=e.currency.formatAmountLocale(t,r);else if(this.action!=="edit"&&this.action!=="create"||this.tplName==="readonly")n=e.currency.formatAmountLocale(t,r);else{var s=e.currency.formatAmountLocale(t,r),o=e.currency.getCurrencySymbol(r);n=s.replace(o,"")}}return n},onCurrencySelection:function(){this.model.changeCurrencyId(this.$ct.val());var e=this.format(this.model.get(this.name));this.$("input").val(e)},onFieldChange:function(){this.model.set(this.name,this.unformat(this._$fieldEl.val()),{disableRenderForContext:this.view})}})}(SUGAR.App),function(e){var t;e.view.fields.DateField=t=e.view.NomadField.extend({events:function(){var n={"focusin input":"onFocus","focusout input":"onBlur"};e.isNative&&!t.nativeSupport&&(n["click input"]="onClick");var r=$.os.desktop?"click":"touchstart";return n[r+" .clear-button"]="onClear",n},validDateRE:/^\d{4}-\d{2}-\d{2}$/,ONCLICK_BLOCKER_TIMEOUT:2e3,chromeForAndroid:$.os.android&&$.browser.chrome,initialize:function(n){e.view.NomadField.prototype.initialize.call(this,n),t._dateFormat||t.initFormat(),this.setFormatting()},onBeforeRender:function(){this.setDefaultValue(),this.setClearButtonVisibility()},onAfterRender:function(){this.setControls(),this.toggleControls()},bindDomChange:function(){if(!this.model)return;this.setInputs(),t.nativeSupport&&this.dateInput.on($.browser.chromeMobile?"change":"blur",_.bind(this.handleValueChange,this))},format:function(n){if(_.isEmpty(n)||this.isFormView()&&t.nativeSupport&&!this.isReadOnly()){if(n&&!this.validDateRE.test(n)){var r=new Date(n);n=e.date.format(r,"Y-m-d")}return n}var i=new Date(n);isNaN(i.getDate())&&(i=e.date.parse(n,"Y-m-d"));var s=$.os.android&&$.os.version&&e.utils.versionCompare("4.1",$.os.version,">="),o=e.isNative&&s?0:i.getTimezoneOffset()*6e4,u=new Date(i.getTime()+o);return e.date.format(u,t._dateFormat)},unformat:function(n){var r=_.isEmpty(n),i;return r||t.nativeSupport&&this.isFormView()?n:(i=e.date.parse(n,t._dateFormat),i?e.date.format(i,"Y-m-d"):null)},setInputs:function(){this.dateInput=this.$el.find("input"),this.inputs=this.dateInput},onClick:function(e){if(this.isOnClickLocked())return;this.setOnClickBlocker(),this.showDatePicker(e)},onFocus:function(){this.placeholder.hide()},onBlur:function(){this.toggleControls()},onClear:function(e){return this.setChanged(),!t.nativeSupport&&$.os.android&&this.setOnClickBlocker(500),this.model.set(this.name,""),!1},setFormatting:function(){this.shouldFormatValues=!t.nativeSupport&&this.isFormView()},setDefaultValue:function(){if(this.context.isCreate()&&!this.getValue()&&this.def.display_default&&!this._changed){var t=e.date.parseDisplayDefault(this.def.display_default);this.model.set(this.name,this._adjustDefaultValue(t),{silent:!0})}},_adjustDefaultValue:function(t){return e.date.format(t,"Y-m-d")},getDateInputValue:function(){var n=this.dateInput.val();if(n&&this.shouldFormatValues){var r=e.date.parse(n,t._dateFormat);n=e.date.format(r,"Y-m-d")}return n},setDateInputValue:function(n){if(n&&this.shouldFormatValues){var r=e.date.parse(n,"Y-m-d");n=e.date.format(r,t._dateFormat)}this.dateInput.val(n)},setClearButtonVisibility:function(){this.showClearButton=!this.def.required&&!_.isEmpty(this.getValue())},setControls:function(){this.placeholder=this.$el.find(".placeholder"),this.clearButton=this.$el.find(".clear-button")},toggleControls:function(){var e=_.isEmpty(this.getValue());this.placeholder.toggle(!this.def.required&&e),this.clearButton.toggle(!this.def.required&&!e)},setChanged:function(){this._changed=!0},getValue:function(){return this.model.get(this.name)},handleValueChange:function(e){this.setChanged(),this.model.set(this.name,this.unformat(this.getDateInputValue()),{disableRenderForContext:this.view}),this.toggleControls()},showDatePicker:function(n){var r=this.unformat(this.value)||"";if(t.ios7){var i={date:r?e.date.parse(r,"Y-m-d"):new Date,mode:"date"};this._setPopoverCoordinates(i,n);var s=e.date.format(i.date,"Y-m-d");this.setDateInputValue(s),this.model.set(this.name,s),this.toggleControls(),window.datePicker.show(i,_.bind(function(n){this.clearOnClickBlocker();var r=e.date.format(n,"Y-m-d");this.model.set(this.name,r)},this),_.bind(function(){this.clearOnClickBlocker()},this));return}e.nomad.showDateTimePicker(r,"showDatePicker",_.bind(function(e){this.clearOnClickBlocker(),this.model.set(this.name,e)},this))},_setPopoverCoordinates:function(e,t){var n=t.screenX,r=t.screenY,i=document.body.scrollTop;r-i<250&&(r+=30),r-=i,e.x=String(n),e.y=String(r)},isFormView:function(){return _.contains(["create","edit"],this.view.action)},isOnClickLocked:function(){return t._onClickBlocker},setOnClickBlocker:function(e){t._onClickBlocker=window.setTimeout(_.bind(this.clearOnClickBlocker,this),e||this.ONCLICK_BLOCKER_TIMEOUT)},clearOnClickBlocker:function(){window.clearTimeout(t._onClickBlocker),t._onClickBlocker=!1},_dispose:function(){this.clearOnClickBlocker(),this.clearButton&&this.clearButton.off(),e.view.NomadField.prototype._dispose.call(this)}},{initFormat:function(){t._dateFormat=e.user.getPreference("datepref")},setNativeSupport:function(){this.nativeSupport=$.os.ios||$.browser.chromeMobile||$.browser.chrome||!$.os.ios&&!$.os.android&&$.browser.webkit||!1,this.ios7=$.os.ios&&$.os.version&&$.os.version[0]==="7",this.ios7&&e.isNative&&this.ios7CustomDatePicker&&(this.nativeSupport=!1)},ios7CustomDatePicker:!0}),e.events.on("app:sync:complete",function(){t.initFormat()}).on("app:init",function(){t.setNativeSupport()})}(SUGAR.App),function(e){var t;e.view.fields.DatetimecomboField=t=e.view.fields.DateField.extend({initialize:function(n){e.view.fields.DateField.prototype.initialize.call(this,n),t._tsFormat||t.initFormat()},onBeforeRender:function(){this.setDefaultValue(),this.calculateAndBackupInputValues(),this.setClearButtonVisibility()},onAfterRender:function(){this.setControls(),this.toggleControls()},bindDomChange:function(){this.setInputs(),t.nativeSupport&&this.inputs.on($.browser.chromeMobile?"change":"blur",_.bind(this.handleValueChange,this))},format:function(n){var r=_.isEmpty(n);return r||this.view.name==="edit"&&t.nativeSupport&&!this.isReadOnly()?n:e.date.format(new Date(n),t._tsFormat)},unformat:function(e){return e},setInputs:function(){this.dateInput=this.$("input[data-type=date]"),this.timeInput=this.$("input[data-type=time]"),this.inputs=this.dateInput.add(this.timeInput)},calculateAndBackupInputValues:function(){var n="",r="",i=this.getValue(),s;i&&(s=new Date(i),n=e.date.format(s,"Y-m-d"),r=e.date.format(s,"H:i:00")),this.values={date:n,time:r},this.formattedValues=null,i&&this.shouldFormatValues&&(s=new Date(i),this.formattedValues={date:e.date.format(s,t._dateFormat),time:e.date.format(s,t._timeFormat)}),this._prevValues=this.values},handleValueChange:function(e){this.setChanged(),this.setDefaultInputValues(),this.setModelValue(this.getDateInputValue(),this.getTimeInputValue()),this.calculateAndBackupInputValues(),this.toggleControls()},setDefaultInputValues:function(){var t=this.getDateInputValue(),n=this.getTimeInputValue(),r=this._prevValues.date&&!t,i=this._prevValues.time&&!n;if(t&&!n&&!i){var s=this.def.default_current_time?e.date.format(new Date,"H:i"):"00:00";this.setTimeInputValue(s)}else if(n&&!t&&!r){var o=e.date.format(new Date,"Y-m-d");this.setDateInputValue(o)}else r?this.setTimeInputValue(""):i&&this.setDateInputValue("")},onClick:function(e){if(this.isOnClickLocked())return!1;var t=e.target.getAttribute("data-type");this.setOnClickBlocker(),this.showDateTimePicker(t,e)},onBlur:function(){this.toggleControls()},getTimeInputValue:function(){var n=this.timeInput.val();if(n&&this.shouldFormatValues){var r=e.date.parse(n,t._timeFormat);n=e.date.format(r,"H:i")+":00"}return n},setTimeInputValue:function(n){if(n&&this.shouldFormatValues){var r=e.date.parse(n,"H:i");n=e.date.format(r,t._timeFormat)}this.timeInput.val(n)},setModelValue:function(e,n){var r="",i=new Date(this.getValue()),s,o;t.nativeSupport&&(o={disableRenderForContext:this.view}),e&&n&&(s=this._getDate(e+" "+n+":00",!0),r=s.toISOString()),(!s||s.getTime()!==i.getTime())&&this.model.set(this.name,r,o)},showDateTimePicker:function(n,r){var i=n==="date",s=this.getDateInputValue()||e.date.format(new Date,"Y-m-d"),o=this.getTimeInputValue()||(this.def.default_current_time?e.date.format(new Date,"H:i"):"00:00");if(t.ios7){var u={date:this._getDate(s+" "+o+":00",!0),mode:i?"date":"time"};this._setPopoverCoordinates(u,r),this.setDateInputValue(s),this.setTimeInputValue(o),this.setModelValue(s,o),this.toggleControls(),window.datePicker.show(u,_.bind(function(t){this.clearOnClickBlocker();if(i){var n=e.date.format(t,"Y-m-d H:i")+":00";this.setDateInputValue(n)}else this.setTimeInputValue(t);this.setDefaultInputValues(),this.setModelValue(this.getDateInputValue(),this.getTimeInputValue()),this.toggleControls()},this),_.bind(function(){this.clearOnClickBlocker()},this));return}e.nomad.showDateTimePicker(i?s:o,i?"showDatePicker":"showTimePicker",_.bind(function(e){this.clearOnClickBlocker(),i?this.setDateInputValue(e):this.setTimeInputValue(e),this.setDefaultInputValues(),this.setModelValue(this.getDateInputValue(),this.getTimeInputValue()),this.toggleControls()},this))},_adjustDefaultValue:function(e){return e.toISOString()},_getDate:function(e,t){var n=e.split(/[^0-9]/),r=new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5]),i=t?0:r.getTimezoneOffset()*6e4;return new Date(r.getTime()-i)},_dispose:function(){e.view.fields.DateField.prototype._dispose.call(this),this.inputs&&this.inputs.off()}},{initFormat:function(){t._tsFormat=e.user.getPreference("datepref")+" "+e.user.getPreference("timepref"),t._dateFormat=e.user.getPreference("datepref")||"Y-m-d",t._timeFormat=e.user.getPreference("timepref")}}),e.events.on("app:sync:complete",function(){t.initFormat()}).on("app:init",function(){t.setNativeSupport()})}(SUGAR.App),function(e){e.view.fields.IntField=e.view.NumericField.extend({})}(SUGAR.App),function(e){e.view.fields.InviteesField=e.view.NomadField.extend({cacheDisabled:!0,events:{"touchstart .checkbox":"touchCheckbox","click .secondary-btn":"onSecondaryClick","click .invitees":"onClick"},fieldTag:"invitees",touchCheckbox:function(e){e.stopPropagation()},onClick:function(t){if(t.defaultPrevented)return!1;var n=e.controller.createDynamicLayout("picker-list","list-layout",{name:"list-picker"});n.context.set({layout:"picker-list",toId:this.model.get("id"),module:this.module,model:this.model});var r=n.getComponent("list-picker");r.setTemplateOption("partials",{"list-item-picker":e.template.get("list-item-parent-picker")}),r.getHeaderData=function(){return{title:e.lang.getAppString("LBL_CHOOSE_LINK"),cancel:!0,plus:!1}};var i=["Contacts","Leads","Users"],s=e.metadata.getModuleNames({filter:"visible",access:"list"});e.acl.hasAccess("list","Users")&&s.push("Users"),i=_.intersection(i,s);var o=_.map(i,function(t){return{value:t,label:e.nomad.getPluralModuleName(t)}}).sort(function(e,t){return e.label>t.label?1:-1});r.setData({items:o}),r.on("row:clicked",function(e,t){this.createListLayout(t,this.model)},this),r.on("cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),e.controller.showDynamicLayout("picker-list",{track:"invitee-type"})},createListLayout:function(t,n){var r=e.context.getContext({module:t}).prepare(),i=e.controller.createDynamicLayout("invitees-list","list-layout",[{name:"search-box",context:r},{name:"list-invitees",context:r,module:t}]),s=i.getComponent("list-invitees");s.setTemplateOption("partials",{"list-item":e.template.get("list-item-invitees")}),s.on("click:cancel",function(){e.controller.disposeDynamicLayout()},this),s.on("save:clicked",function(n){n=_.map(n,function(e){var n=_.pick(e.attributes,"id","name");return n.link=t.toLowerCase(),n},this);var r=_.compact(this.model.get("invitees")),i=_.pluck(r,"id");i=_.map(i,function(e){return e.toString()}),n=_.chain(n).reject(function(e){return _.include(i,e.id.toString())}).union(r).value(),this.model.set("invitees",n),e.controller.disposeDynamicLayout(),e.controller.disposeDynamicLayout()},this),i.enableSearch("list-invitees"),e.controller.showDynamicLayout("invitees-list",{track:t})},onSecondaryClick:function(e){var t=this.model.get("invitees"),n=$(e.currentTarget).attr("uid"),r=_.reject(t,function(e){return e.id==n});return this.model.set("invitees",r),!1}})}(SUGAR.App),function(e){e.view.fields.ImageField=e.view.NomadField.extend({supportedTypes:["image/jpeg","image/png","image/gif"],events:{"click .input_upload":"_onInputClick","touchstart .picture-remove":"_onClearClick","change .input_upload":"_onFileSelected"},globalEvents:{"app:header:cancel":"_onHeaderCancelClick"},initialize:function(){e.view.NomadField.prototype.initialize.apply(this,arguments),this._canvas=document.createElement("canvas")},onAfterRender:function(){this._dirty=!1,this.$fileInput=this.$el.find(".input_upload"),this.value&&this._showAndPositionImage()},bindDomChange:function(){return},_onInputClick:function(t){e.acl.hasAccessToModel("edit",this.model,this.name)||(t.preventDefault(),t.stopPropagation())},_onFileSelected:function(){if(this.$fileInput[0].files.length===0)return;var t=this.$fileInput[0].files[0].type;if(t&&!this._isFiletypeSupported(t)){e.trigger("field:image:filechanged",this,e.lang.get("ERR_MOBILE_FILE_NOT_SUPPORTED"),"error");return}this._dirty=!0,e.trigger("field:image:filechanged",this,this.$fileInput,"fileselected")},_onClearClick:function(){this.$el.find(".picture-remove").addClass("hide"),this.$el.find("i.icon-picture").show(),this.$el.find("div.avatar").css({backgroundImage:"none"}),this._dirty=!0,e.trigger("field:image:fileclear",this)},_onHeaderCancelClick:function(){this._dirty&&this.context.get("action")==="edit"&&this.render()},_showAndPositionImage:function(t){var n=this,r=new Image,i=this.$el,s=i.find("div.avatar"),o=t||e.api.buildFileURL({field:this.name,module:this.module,id:this.model.id},e.nomad.getFileOptions())+"&_id="+this.model.get(this.name),u;r.onload=function(){var i={image:r,height:s.css("height"),width:s.css("width")};e.nomad.utils.sizePicture(i),u=t||n._resizeWithCanvas(r),s.css({backgroundSize:i.sizeProp,backgroundImage:"url("+u+")"})},r.onerror=function(){var t=n.context?n.context.isCreate()?"edit":n.context.get("action"):"detail",r=e.utils.formatString("url(img/offline-{0}.svg)",[t]);s.css({backgroundImage:r})},r.src=o},prepareFile:function(){e.trigger("field:image:filechanged",this,this.$fileInput,"preparing"),async.series([_.bind(this._readFileData,this),_.bind(this._resizeImage,this),_.bind(this._applyPreview,this)],_.bind(function(n){n?e.trigger("field:image:filechanged",this,n.message||e.lang.get("ERR_MOBILE_FILE_PROCESSING"),"error"):(this.$fileInput.fieldName=this.name,this.$el.find(".picture-remove").removeClass("hide"),this.$el.find("i.icon-picture").hide(),e.trigger("field:image:filechanged",this,this.$fileInput,"prepared"))},this))},_isFiletypeSupported:function(e){return this.supportedTypes.indexOf(e)!==-1},_readFileData:function(t){var n=this.$fileInput[0].files[0];if(n){var r=this,i=new FileReader,s=this._binaryToDataUri;i.onload=function(i){r.$fileInput.fileData={name:n.name,size:n.size,type:n.type,binary:i.target.result,dataURI:s(i.target.result,n.type)};try{var o=new JpegMeta.JpegFile(i.target.result,n.name),u;"tiff"in o?"Orientation"in o.tiff?(r.$fileInput.fileData.orientation=parseInt(o.tiff.Orientation,10),u="Orientation tag: "+o.tiff.Orientation):u='No "Orientation" tag in image':u="No TIFF tags in image",e.config.canvasTestModeOnUpload&&e.alert.show("orientation info",{level:"info",messages:u,closeable:!0,autoClose:!0})}catch(a){}finally{t()}},i.onerror=function(n){var r=n.target.error,i={1:"ERR_MOBILE_FILE_NOT_FOUND",2:"ERR_MOBILE_FILE_NOT_READABLE",3:"ERR_MOBILE_FILE_ABORTED",4:"ERR_MOBILE_FILE_SECURITY"};t({message:e.lang.getAppString(i[r.code]||"ERR_MOBILE_FILE_READ")}),e.logger.error("Failed to read file: ["+r.code+"]")},i.readAsBinaryString(n)}else t({message:"No file selected"})},_applyPreview:function(e){this.$el.find(".icon-user").hide(),this._showAndPositionImage(this.$fileInput.fileData.dataURI),e()},_resizeImage:function(t){var n=new Image,r=this,i=!1;n.onload=function(){function s(){r.$fileInput.fileData.type=n.split(",")[0].split(";")[0].split(":")[1],r.$fileInput.fileData.dataURI=n,r.$fileInput.fileData.binary=r._dataUriToBinary(n),t()}i=!0;var n=r._resizeWithCanvas(this);if(n.split(",")[1].length===0){t({message:"Image resizing failed (Failed to render to canvas)"});return}e.config.canvasTestModeOnUpload?$(r._canvas).css({position:"fixed",top:200,left:0,border:"2px red solid",zIndex:999999999}).appendTo("body").on("click",function(){$(r._canvas).remove(),s()}):s()},n.src=this.$fileInput.fileData.dataURI,_.delay(function(){i||t({message:"Image resizing failed (Failed to load file as image)"})},e.config.imageResizeTimeout)},_resizeWithCanvas:function(t){var n=this._canvas,r=e.config.resizeImagesOnUpload,i=t.naturalWidth,s=t.naturalHeight,o=Math.max(i,s),u=$.os.ios?this._iosRenderWithCanvas:this._commonRenderWithCanvas;r||(r=o);var a=o<r?1:r/o,f=Math.round(i*a),l=Math.round(s*a);return n.width=f,n.height=l,u(t,n,{width:f,height:l,orientation:this.$fileInput.fileData?this.$fileInput.fileData.orientation:1})},_iosRenderWithCanvas:function(t,n,r){var i=new MegaPixImage(t);return i.render(n,{maxWidth:r.width,maxHeight:r.height,orientation:r.orientation}),n.toDataURL()},_commonRenderWithCanvas:function(t,n,r){function s(e,t,n,r){switch(r){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var i=e.getContext("2d");switch(r){case 2:i.translate(t,0),i.scale(-1,1);break;case 3:i.translate(t,n),i.rotate(Math.PI);break;case 4:i.translate(0,n),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI),i.translate(t,-n),i.scale(-1,1);break;case 8:i.rotate(-0.5*Math.PI),i.translate(-t,0);break;default:}}var i=n.getContext("2d");return i.clearRect(0,0,r.width,r.height),r.orientation&&s(n,r.width,r.height,r.orientation),i.drawImage(t,0,0,r.width,r.height),n.toDataURL()},_binaryToDataUri:function(e,t){return"data:"+t+";base64,"+window.btoa(e)},_dataUriToBinary:function(e){return window.atob(e.split(",")[1])}})}(SUGAR.App),function(e){e.view.fields.FloatField=e.view.NumericField.extend({isFloat:!0})}(SUGAR.App),function(e){e.view.fields.EnumField=e.view.NomadField.extend({fieldTag:"select",cacheDisabled:!0,events:{"focusin select":"onFocus","focusout select":"onBlur"},onBeforeRender:function(){var t=this.model.get(this.name),n=this.view.isEditView();if(!this.model||!n||!e.nomad.isEmptyValue(t))return;if(n&&_.isUndefined(t)){var r=this.getDefaultValue();r&&(this.value=t,this.model.set(this.name,r,{silent:!0}))}},onAfterRender:function(){this.placeholder=this.$el.find(".placeholder").eq(0);var e=this.getValue(),t=this.getDefaultValue();e===""&&!this.hasEmptyOption()&&e!==t&&(e=t),this.value=e,_.isEmpty(e)||this.placeholder.hide()},onFocus:function(){this.placeholder.hide()},onBlur:function(){this.placeholder.toggle(!this.value)},onFieldChange:function(){var e=this.unformat(this._$fieldEl.val());this.value=e,this.model.set(this.name,e,{disableRenderForContext:this.view}),this.onBlur()},getValue:function(){return this.model.get(this.name)},getDefaultValue:function(){var e=this.def["default"],t=this.getKeys();return _.isNumber(e)&&(e=e.toString(10)),!_.contains(t,e)&&!_.isEmpty(t)&&(e=t[0]),e},hasEmptyOption:function(){var e=this.getKeys();return _.contains(e,"")},getKeys:function(){var t=[];return _.isString(this.def.options)?t=_.keys(e.lang.getAppListStrings(this.def.options)):_.isObject(this.def.options)&&(t=_.keys(this.def.options)),t}})}(SUGAR.App),function(e){e.view.fields.EmailField=e.view.NomadField.extend({events:{"click .actions-btn":"showActions",'keyup [email-id="-1"] input':"onNewEmailFieldKeyUp"},_getValue:function(){return this.model.get(this.name)},_render:function(){var t=this._getValue();t&&t.length&&(_.each(t,function(e){_.each(["primary_address","opt_out","invalid_email"],function(t){e[t]=!!Number(e[t])})}),t=_.sortBy(t,function(e){return-Number(e.primary_address)}),this.model.set(this.name,t,{silent:!0})),e.view.NomadField.prototype._render.apply(this,arguments)},_getEmailObject:function(e){var t=e.closest("[email-id]").attr("email-id");return t!=-1&&this._getValue()[t]||null},setPrimaryEmail:function(e){var t=this._getValue(),n=_.findWhere(t,{primary_address:!0});n&&(n.primary_address=!1),this.$el.find(".primary-address").removeClass("primary-address"),n=t[e],n.primary_address=!0,this.$el.find('[email-id="'+e+'"]').addClass("primary-address")},_toggleAttr:function(e,t){var n=this._getValue()[e],r=t.replace("_","-"),i=n[t]=!n[t];this._getEmailFieldRow(e)[i?"addClass":"removeClass"](r)},toggleOptOut:function(e){this._toggleAttr(e,"opt_out")},toggleInvalid:function(e){this._toggleAttr(e,"invalid_email")},_getEmailFieldRow:function(e){return this.$el.find('.controls-flex[email-id="'+e+'"]')},removeEmail:function(e){var t=this._getValue(),n=t.splice(e,1)[0];n.primary_address&&t.length&&(t[0].primary_address=!0),this.model.trigger("change:email")},_makeEmail:function(e){return _.isUndefined(e)&&(e=""),{email_address:e,primary_address:!this._getValue().length,invalid_email:!1,opt_out:!1}},onFieldChange:function(e){var t=$(e.currentTarget),n=this._getEmailObject(t),r=this.unformat(t.val()),i;n?n.email_address=r:r&&(i=this._getValue(),i||(i=[],this.model.set(this.name,i,{silent:!0})),i.push(this._makeEmail(r))),this.model.trigger("change:email")},onNewEmailFieldKeyUp:function(e){var t=$(e.currentTarget),n=this.unformat(t.val());this.$el.find(".add-btn").css({visibility:n?"visible":"hidden"})},_displayValidationMessage:function(t){var n,r=[];this.$(".controls").children(".error-display").remove(),this.$("[email-address]").removeClass("error").remove(".icon-exclamation-sign");if(t){var i=[];_.each(this._getValue(),function(e,n){_.contains(t.email,e.email_address)&&i.push(n)}),_.each(i,function(e){this.$('[email-id="'+e+'"]').addClass("error").append('<span class="icon icon-exclamation-sign"></span>')}),_.each(t,function(t,n){r.push(e.error.getErrorString(n,t))}),n=e.template.get("edit-field-error"),this.$(".controls").append(n(r))}e.analytics.trackEvent("validation",this.name)},showActions:function(t){function u(){n.removeClass("active")}var n=$(t.currentTarget);n.addClass("active");var r=n.closest("[email-id]").attr("email-id"),i=this._getValue()[r],s=[this.toggleOptOut,this.toggleInvalid,this.removeEmail],o=[i.opt_out?"LBL_EMAIL_ACTION_SET_OPT_IN":"LBL_EMAIL_ACTION_SET_OPT_OUT",i.invalid_email?"LBL_EMAIL_ACTION_SET_VALID":"LBL_EMAIL_ACTION_SET_INVALID","LBL_REMOVE"];return i.primary_address||(o.unshift("LBL_EMAIL_ACTION_SET_PRIMARY"),s.unshift(this.setPrimaryEmail)),s=_.map(s,function(e){return _.bind(e,this,r)},this),o=_.map(o,function(t){return e.lang.get(t)}),e.nomad._showActionSheet(null,o,function(e,t){s[t](),u()},u),!1}})}(SUGAR.App),function(e){e.view.fields.ParentField=e.view.NomadField.extend({events:{"click .secondary-btn":"onSecondaryClick","click .parent":"onClick"},onBeforeRender:function(){var t=this.model.get("parent_type");this.hasAccess=e.acl.hasAccess("read",t)&&!_.isEmpty(e.metadata.getModule(t))},onClick:function(t){if(t.defaultPrevented)return!1;var n=this.context.get("module"),r=e.controller.createDynamicLayout("parent-picker-list","list-layout",{name:"list-picker"});r.context.set({layout:"parent-picker-list",toId:this.model.get("id"),module:n,model:this.model});var i=r.getComponent("list-picker");i.setTemplateOption("partials",{"list-item-picker":e.template.get("list-item-parent-picker")}),i.getHeaderData=function(){return{title:e.lang.getAppString("LBL_CHOOSE_PARENT_TYPE"),cancel:!0,plus:!1}};var s=e.lang.getAppListStrings(this.def.options)||{},o=e.metadata.getModuleNames({filter:"visible"}),u=_.intersection(_.keys(s),o);_.contains(["Notes","Tasks"],this.module)&&(u=_.without(u,"Contacts")),u=_.filter(u,function(t){return e.acl.hasAccess("read",t)},this);var a=_.map(u,function(e){return{value:e,label:s[e]}}).sort(function(e,t){return e.label>t.label?1:-1});i.setData({items:a}),i.on("row:clicked",function(e,t){this.createParentListLayout(t,this.model)},this),i.on("cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),e.controller.showDynamicLayout("parent-picker-list")},createParentListLayout:function(t,n){var r=e.context.getContext({module:t}).prepare(),i=e.controller.createDynamicLayout("parent-list","list-layout",[{name:"search-box",context:r},{name:"list-parent",context:r,module:t}]),s=i.getComponent("list-parent");s.setTemplateOption("partials",{"list-item-picker":e.template.get("list-item-parent")}),s.on("click:cancel",function(t){e.controller.disposeDynamicLayout()},this),s.on("menu:item:clicked",function(r){n.set({id:n.id,parent_name:r.get("name"),parent_id:r.get("id"),parent_type:t}),e.controller.disposeDynamicLayout(),e.controller.disposeDynamicLayout()},this),i.enableSearch("list-parent"),e.controller.showDynamicLayout("parent-list",{track:t})},onSecondaryClick:function(e){return this.model.set({parent_name:"",parent_id:"",parent_type:""}),!1}})}(SUGAR.App),function(e){e.view.fields.PhoneField=e.view.NomadField.extend({format:function(e){if(!e)return;e=_.isString(e)?e.trim():e;var t="",n=e.match(/^\(?([0-9,;#*+]{3})?\)?[\-. ]?([0-9,;#*+]{3})[\-. ]?([0-9,;#*+]{4,10})$/);return n&&n.length===4&&(n[1]&&(t+="("+n[1]+") "),t+=n[2]+"-"+n[3]),t||e},unformat:function(e){e=_.isString(e)?e.trim():e;var t=e.replace(/[^0-9,;#*+]/g,"");return t||e},onFieldChange:function(){var e=this.unformat(this._$fieldEl.val()),t=this.model.get(this.name);this.model.set(this.name,e),t===e&&this.model.trigger("change:"+this.name,this.model,e)}})}(SUGAR.App),function(e){e.view.fields.TextareaField=e.view.NomadField.extend({fieldTag:"textarea",events:{"click .textarea":"onClick"},initialize:function(t){e.view.NomadField.prototype.initialize.call(this,t)},onClick:function(t){var n=this.isReadOnly();if(_.isEmpty(this.value)&&n)return;var r=e.controller.createDynamicLayout("textarea","textarea",[{name:"textarea-edit",context:this.context,editedFieldName:this.label,isReadOnly:n}]),i=r.getComponent("textarea-edit");i.on("textarea:edit:saved",function(t){this.model.set(this.name,t),e.controller.disposeDynamicLayout()},this),i.on("cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),e.controller.showDynamicLayout("textarea",{callback:_.bind(function(){var e=this.model.get(this.name);e&&i.setValue(e)},this)})}})}(SUGAR.App),function(e){var t;e.view.fields.EmailbodyField=t=e.view.fields.TextareaField.extend({fieldTag:"textarea",events:{"click textarea":"onClick"},onClick:function(t){if(_.isEmpty(this.value)&&this.isReadOnly())return;e.nomad.showEmailBody(this.def,this.model)},format:function(e){return _.isEmpty(e)&&(e=t.getPlainTextValue(this.name,this.model)),e}},{getPlainTextValue:function(e,t){var n=e.replace(/_html$/,""),r=t.get(n)||"";return $.trim(r)}})}(SUGAR.App),function(e){e.view.fields.RadioenumField=e.view.NomadField.extend({events:{"click .btn-group .btn":"onClick"},onClick:function(e){this.model.set(this.name,$(e.currentTarget).val())}})}(SUGAR.App),function(e){e.view.fields.RelateField=e.view.NomadField.extend({events:{"click .secondary-btn":"onSecondaryClick","click .relate":"onClick"},onBeforeRender:function(){var t=this.def.module;this.hasAccess=e.acl.hasAccess("read",t)&&!_.isEmpty(e.metadata.getModule(t)),!this.hasAccess&&this.view.name==="edit"&&(this.options.viewName="readonly")},onClick:function(t){if(t.defaultPrevented)return!1;var n=e.metadata.getModule(this.view.module).fields[this.name],r=n.module,i=e.context.getContext({module:r}).prepare(),s=e.controller.createDynamicLayout("relate","list-layout",[{name:"search-box",context:i},{module:r,name:"list-relate",context:i}]),o=s.getComponent("list-relate");o.context.set({view:o}),o.on("menu:item:clicked",function(t){this.onRelatedItemSelected(t),e.controller.disposeDynamicLayout()},this),o.on("menu:cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),s.enableSearch("list-relate"),e.controller.showDynamicLayout("relate",{track:r})},onRelatedItemSelected:function(t){var n={},r=e.metadata.getModule(this.view.module).fields[this.name];n[r.id_name]=t.get("id"),n[r.name]=t.get("name"),r.populate_list&&r.auto_populate&&_.each(r.populate_list,function(r,i){i=_.isNumber(i)?r:i;var s=t.get(i);!_.isUndefined(s)&&e.acl.hasAccessToModel("edit",this.model,r)&&(n[r]=s,this.view.module==="RevenueLineItems"&&i==="discount_price"&&_.each(["likely_case","best_case","worst_case"],function(e){n[e]=s})),i==="currency_id"&&this.model.get("currency_id")!==s&&this.model.changeCurrencyId(s)},this),this.model.set(n)},onSecondaryClick:function(e){return this.model.set(this.name,""),this.model.set(this.def.id_name,""),!1}})}(SUGAR.App),function(e){e.view.fields.MultienumField=e.view.NomadField.extend({events:{"touchstart .remove":"highlightRemoveClick","click .remove":"onRemoveClick","click .multiselect":"onClick"},onBeforeRender:function(){var e=this.model.get(this.name);this.view.isEditView()&&_.isArray(e)&&!this.def.required&&e.length===1&&e[0]===""&&this.model.set(this.name,[],{silent:!0})},onClick:function(t){if(t.defaultPrevented||this.isReadOnly())return!1;var n=e.controller.createDynamicLayout("multienum","list-layout",[{name:"list-multiselect"}]),r=n.getComponent("list-multiselect"),i=e.lang.getAppListStrings(this.def.options),s={};_.each(i,function(e,t){!_.contains(this.value,t)&&t!==""&&(s[t]=e)},this),r.setData({items:s}),r.on("multienum:save:clicked",this.onClickSave,this),r.on("cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),e.controller.showDynamicLayout("multienum"),t.preventDefault()},onClickSave:function(t){var n=_.compact(this.model.get(this.name));this.model.set(this.name,_.union(n,t)),e.controller.disposeDynamicLayout()},highlightRemoveClick:function(e){$(e.target).addClass("selected-item")},onRemoveClick:function(e){var t=this.model.get(this.name),n=$(e.target).is("[item-id]")?$(e.target):$(e.target).closest("[item-id]"),r=n.attr("item-id"),i=_.without(t,r);return this.model.set(this.name,i),!1}})}(SUGAR.App),function(e){e.view.fields.TeamsetField=e.view.NomadField.extend({cacheDisabled:!0,events:{"click .primary-btn":"onPrimaryClick","click .secondary-btn":"onSecondaryClick","click .teamset":"onClick"},initialize:function(t){e.view.NomadField.prototype.initialize.call(this,t),this.model.on("change:team_name",function(){this.$el.find("[team-id]").removeClass("active")},this)},_render:function(){var t=this.model.get(this.name);_.isArray(t)&&(t=_.sortBy(t,function(e){return e.primary!==!0}),this.model.set(this.name,t,{silent:!0})),e.view.NomadField.prototype._render.apply(this,arguments)},onClick:function(t){if(t.defaultPrevented||this.isReadOnly())return!1;var n="Teams",r=e.context.getContext({module:n}).prepare(),i=e.controller.createDynamicLayout("multienum","list-layout",[{name:"search-box",context:r},{module:n,name:"list-teamset",context:r}]),s=i.getComponent("list-teamset");s.on("multienum:save:clicked",this.onClickSave,this),s.on("multienum:cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),s.context.set({view:s}),i.enableSearch("list-teamset"),e.controller.showDynamicLayout("multienum",{track:"teamset"})},onClickSave:function(t){t=_.map(t,function(e){return _.pick(e.attributes,"id","name","name_2")});var n=_.compact(this.model.get("team_name")),r=_.pluck(n,"id");r=_.map(r,function(e){return e.toString()});var i=_.chain(t).reject(function(e){return _.include(r,e.id.toString())}).union(n).value();this.model.set("team_name",i),e.controller.disposeDynamicLayout()},onPrimaryClick:function(e){var t=this.$el.find("[team-id].active").removeClass("active").attr("team-id"),n=$(e.currentTarget);n.addClass("active");var r=_.find(this.model.get("team_name"),function(e){return e.id==t});r&&(r.primary=!1);var i=$(e.currentTarget).attr("team-id"),s=_.find(this.model.get("team_name"),function(e){return e.id==i});return s.primary=!0,!1},onSecondaryClick:function(e){var t=this.model.get("team_name"),n=$(e.target).is("[team-id]")?$(e.target):$(e.target).closest("[team-id]"),r=n.attr("team-id"),i=_.reject(t,function(e){return e.id==r});return this.model.set("team_name",i),!1}})}(SUGAR.App),function(e){e.view.fields.UrlField=e.view.NomadField.extend({regexp:/^(https?:\/\/)?([\da-zA-Z\.-]+)\.([a-zA-Z\.]{2,6})([\/\w \.-]*)*\/?$/,unformat:function(e){var t="://",n=e;e=$.trim(e);if(e.indexOf(t)>-1){n=e.split(t)[1];if(!n)return""}return e}})}(SUGAR.App),function(e){e.view.fields.FavoriteField=e.view.NomadField.extend({events:{"click .icon-star":"onClick"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.alert.dismissAll();var n=$(t.currentTarget),r=n.hasClass("active"),i=this.model,s=function(){i.set("my_favorite",r)};return i.favorite(!r,{error:s}),!1}})}(SUGAR.App),function(e){e.view.fields.FieldsetField=e.view.NomadField.extend({fields:null,subfields:"",initialize:function(t){var n=this;e.view.NomadField.prototype.initialize.call(this,t),_.each(this.def.fields,function(e){if(e.type==="label"){var t=e.css_class.match(/label_[^\s]+/);if(t.length>0){var r=t[0].substring(6);n.model.on("change:"+r,function(){var e=n.model.get(r);e||e===0||e===""?n.$el.find(".label_"+r).removeClass("hide"):n.$el.find(".label_"+r).addClass("hide")},n)}}})},_render:function(){this.template===e.template.empty&&e.view.NomadField.prototype._render.apply(this,arguments)},getPlaceholder:function(){var t="",n=this;return this.fields||(this.fields=[],_.each(this.def.fields,function(r){var i=e.view.createField({def:r,view:n.view,model:n.model});n.fields.push(i),t+=i.getPlaceholder()})),this.def.orientation==="horizontal"?(this.subfields=new Handlebars.SafeString(t),e.view.NomadField.prototype.getPlaceholder.call(this)):new Handlebars.SafeString(t)},onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.call(this)}})}(SUGAR.App),function(e){e.view.fields.FollowField=e.view.NomadField.extend({events:{"click .follow-label":"onClick"},onClick:function(e){e.preventDefault(),e.stopPropagation(),this.model.follow(!this.model.get("following"),{error:_.bind(this.onError,this)})},onError:function(){this.model.set("following",!this.model.get("following"))}})}(SUGAR.App),function(e){e.view.fields.LabelField=e.view.NomadField.extend({onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.call(this);if(this.el){var t=this.el.className.match(/label_[^\s]+/);if(t.length>0){var n=this.model.get(t[0].substring(6));n||n===0||n===""?$(this.el).removeClass("hide"):$(this.el).addClass("hide")}}}})}(SUGAR.App),function(e){e.view.fields.AddressField=e.view.NomadField.extend({cacheDisabled:!0,events:{click:"onClick"},initialize:function(t){e.view.NomadField.prototype.initialize.call(this,t),this.model.on("error:validation",this._handleValidationError,this),this.fieldNames=_.pluck(this.def.fields,"name"),this.required=_.any(this.def.fields,function(t){return t.required||e.metadata.getModule(this.module).fields[t.name].required},this)},onClick:function(t){if(this.isReadOnly())return;var n=e.controller.createDynamicLayout("address","address",[{name:"address-edit",context:this.context,editedFieldName:this.label,addressFields:this.def.fields}]),r=n.getComponent("address-edit");r.on("close:clicked",function(){e.controller.disposeDynamicLayout()},this),e.controller.showDynamicLayout("address")},bindDataChange:function(){this.model&&_.each(this.def.fields,function(e){this.model.on("change:"+e.name,this.render,this)},this)},onBeforeRender:function(){e.serverInfo.isSevenUp||(e.acl.hasAccessToModel("edit",this.model,this.def.fields[0].name)?this.options.viewName="edit":this.options.viewName="readonly"),e.acl.hasAccessToModel("read",this.model,this.def.fields[0].name)||this.$el.hide();var t=[],n=[],r=/street/;_.each(this.def.fields,function(e){var i=this.model.get(e.name);if(i){var s=e.name;r.exec(s)?t.push(i):n.push(i)}},this),this.address=(t.length>0?t.join()+"<br>":"")+n.join(" ")},_handleValidationError:function(t){var n,r={},i=[],s=this.$(".controls"),o=this.model.module;_.each(t,function(e,t){_.contains(this.fieldNames,t)&&(r[t]=e)},this),s.children(".error-display").remove();if(_.isEmpty(r))return;this.$(".control-group").addClass("error"),_.each(r,function(t,n){var r=_.find(this.def.fields,function(e){return e.name===n}),s=r?e.lang.get(r.label,o):n;_.each(t,function(t,n){i.push(s+" : "+e.error.getErrorString(n,t))})},this),n=e.template.get("edit-field-error"),s.append(n(i))}})}(SUGAR.App),function(e){var t,n;e.augment("nomad",{timePaused:0,globalEvents:["app:orientation:changed","app:view:beforechange","app:layout:show","layout:after:show","app:header:changed","app:header:save","app:header:cancel","app:header:head","app:header:home","app:header:add","app:header:menu:open","app:header:picturechanged","search:complete","search:clear:clicked","actionsheet:show","acl:change","field:image:filechanged","field:image:fileclear","list:item:clicked"],deviceReady:function(){e.isNative=!_.isUndefined(window.cordova),e.isTouchCapable="ontouchstart"in window,e.clientInfo={app:{name:e.config.appName||e.config.appId,isNative:e.isNative},device:null,browser:_.extend($.browser,{userAgent:navigator.userAgent})},e.nomad.initSupportedFeatures(),this.preInit(e.clientInfo,_.bind(this.start,this))},start:function(){this.setOrientation(),e.logger.debug("Client: "+JSON.stringify(e.clientInfo)),e.nomad._initializeRemoteWebInspector(),$.__swipeHelper.init();try{var t=e.config.env+":"+e.config.appId+":settings",n=window.localStorage.getItem(t);n&&n[1]==="'"&&window.localStorage.setItem(t,n.replace(/'/g,'"'))}catch(r){}e.init({el:"#nomad"}),e.api.debug=e.config.debugSugarApi,e.api.setRefreshTokenSuccessCallback(function(e){e()}),e.telephony.clearCallLog(),e.start(),e.logger.debug("App started in "+(e.isNative?"native shell":"browser")),document.addEventListener("pause",_.bind(this.onPause,this),!1),document.addEventListener("resume",_.bind(this.onResume,this),!1),document.addEventListener("memoryWarning",_.bind(this.onMemoryWarning,this),!1),document.addEventListener("backbutton",_.bind(this.onBackButtonClicked,this),!1),window.addEventListener("orientationchange",_.bind(this.onOrientationChange,this),!1),_.each(this.globalEvents,function(t){e.events.register(t,e)})},initSupportedFeatures:function(){e.supportedFeatures={fileUpload:function(){var n=$.os.version;if($.os&&$.os.version){if($.os.ios)return e.utils.versionCompare(n,"6",">=");if($.os.android)return e.utils.versionCompare(n,"4.0.3",">=")}return!0}(),menuAnimation:function(){return $.os&&$.os.version?!$.os.android||!e.utils.versionCompare($.os.version,"4.0.3","<"):!0}()}},isSevenUp:function(t){return t?e.utils.versionCompare(t.version,"7.0RC",">="):!1},resetMeta:function(t,n){var r=e.cache.get("app:build")!==e.config.appBuild,i=t||!e.config.cacheMeta||r,s=e.metadata.getHash();if(i){e.logger.debug("Resetting meta"),e.metadata.clearCache(),e.cache.cut("user");var o=JSON.parse(JSON.stringify(e.baseMetadata));!t&&s&&!r&&(o._hash=s),e.metadata.set(o,!1,!0),e.cache.set("app:build",e.config.appBuild)}(i||n)&&e.cache.set("app:synced","0"),e.isSynced=!n&&!i&&e.config.cacheMeta&&e.cache.get("app:synced")==="1",e.logger.debug("App is synced: "+e.isSynced)},resetAuth:function(){e[e.config.authStore].cut("AuthAccessToken"),e[e.config.authStore].cut("AuthRefreshToken")},saveUser:function(){e.cache.set("user",e.user.toJSON())},restoreUser:function(){e.user.set(e.cache.get("user")||{})},resetUser:function(){var t=this.fetchSettings(),n=t.loginName;t.prevUsername!==n&&(_.each(t,function(e,n){_.contains(["loginName","loginUrl","siteUrl"],n)||delete t[n]}),t.prevUsername=n,this.saveSettings(t),e.cache.cut("lang"),e.user.clear(),this.saveUser())},getSetting:function(e){return this.fetchSettings()[e]},setSetting:function(e,t){var n=this.fetchSettings();_.isObject(e)?n=_.extend(n,e):n[e]=t,this.saveSettings(n)},removeSetting:function(e){var t=this.fetchSettings();delete t[e],this.saveSettings(t)},fetchSettings:function(){return _.isUndefined(n)&&(n=e.cache.get("settings")||{}),n},saveSettings:function(t){n=t,e.cache.set("settings",n)},enableOffline:function(t){var n=!1;t&&(n=e.nomad.getSetting("prevSiteUrl")!==e.nomad.getSetting("siteUrl"),e.nomad.setSetting("prevSiteUrl",e.nomad.getSetting("siteUrl"))),e.offline.userEnabled=_.isUndefined(e.nomad.getSetting("offlineEnabled"))?!0:!n&&Boolean(e.nomad.getSetting("offlineEnabled"))},getRelationshipLink:function(t,n){var r=e.metadata.getModule(t),i=_.find(r.fields,function(t){if(t.type==="link"){var r=e.metadata.getRelationship(t.relationship);return r&&(r.lhs_module===n||r.rhs_module===n)}});return i?i.name:null},getRelationship:function(t,n){var r=e.metadata.getModule(t),i=r.fields[n].relationship;return e.metadata.getRelationship(i)},onPause:function(t){e.nomad.closeHeaderMenu(!0),e.activeComponents.closeAll(),e.telephony.appPaused(),e.logger.debug("App was paused"),e.logger.debug(t),e.analytics.trackEvent("device","pause"),this.timePaused=(new Date).getTime()},onResume:function(t){var n=((new Date).getTime()-(this.timePaused||0))/1e3;e.logger.debug("App resumed: "+n),e.logger.debug(t),n>60*(e.config.analytics.sessionTimeout||30)&&e.analytics.startSession(),e.analytics.trackEvent("device","resume",parseInt(n,10)),e.telephony.appResumed(),e.controller.layout&&this._shouldRefresh()&&(e.controller.context.resetLoadFlag(),e.controller.layout.loadData(),this.timePaused=0)},_shouldRefresh:function(){var t=e.controller.layout.name;if(t!=="edit"){var n=(new Date).getTime();if(n-this.timePaused>e.config.refreshOnResumeTimeout)return!0}return!1},onMemoryWarning:function(){e.controller.clean(!0,!0),e.logger.warn("App received memory warning"),e.analytics.trackEvent("device","low-memory")},onBackButtonClicked:function(){e.analytics.trackEvent("device","back");if(e.activeComponents.hasActiveComponents()){e.activeComponents.closeRecent();return}if(e.overlay.isActive())return;e.nomad.dismissAlerts();var t=e.events._events;document.activeElement&&document.activeElement.blur(),t["app:header:cancel"]?e.trigger("app:header:cancel"):e.controller.isOnDynamicLayout()?e.controller.disposeDynamicLayout():e.router.goBack()},onOrientationChange:function(){t!==window.orientation&&(e.analytics.trackEvent("orientation",window.orientation),e.trigger("app:orientation:changed",window.orientation),t=window.orientation),$.os.android&&($("body").addClass("rotate"),_.delay(function(){$("body").removeClass("rotate")},500)),this.setOrientation()},setOrientation:function(){e.nomad.utils.getOrientation()==="landscape"?$("html").removeClass("portrait").addClass("landscape"):$("html").removeClass("landscape").addClass("portrait")},dismissAlerts:function(){e.alert.dismissAll("success"),e.alert.dismissAll("error")},supportsFavs:function(t){if(t==="Home")return!0;var n=e.metadata.getModule(t);return n?n.favoritesEnabled:!1},supportsMyItems:function(t){if(t==="Home")return!0;var n=e.metadata.getModule(t);return n?!_.isUndefined(n.fields.assigned_user_id):!1},buildLinkRoute:function(e,t,n,r,i){var s=_.isString(e)?e:e.get("module");return s+="/"+t+"/link/"+n,r&&(s+="/"+r),i&&(s+="/"+i),s},_initializeRemoteWebInspector:function(){if(e.config.weinre&&e.config.weinre.server!==""){var t=document.createElement("script");t.setAttribute("src","http://"+e.config.weinre.server+":"+e.config.weinre.port+"/target/target-script-min.js#"+e.config.weinre.guid),$("body").append(t)}},contextMetaViews:{list:{numberOfItems:2},detail:{numberOfItems:999},all:{numberOfItems:999,customModsOnly:!0,useVarDef:!0}},contextMeta:{},initializeContextMeta:function(){var t=this;_.each(t.contextMetaViews,function(n,r){t.contextMeta[r]=t.contextMeta[r]||{};var i=n.type||r,s=e.metadata.getModuleNames();s.push("Users"),s.push("TxLog"),n.customModsOnly&&(s=_.reject(s,function(t){return e.nomad.isStandardModule(t)})),_.each(s,function(n){if(e.metadata.getModule(n)){var s=e.data.createBean(n);t.contextMeta[r][n]=t.calculateContextMeta(s,n,i)}})})},calculateContextMeta:function(t,n,r){var i=null,s=this.contextMetaViews[r].numberOfItems||999,o=this.contextMetaViews[r].useVarDef?[e.metadata.getModule(n)]:e.metadata.getView(n,r).panels;return _.each(o,function(e,n){i=t.getContextMetaData(e.fields,{fieldsNumber:s,contextData:i})}),i},getContextMeta:function(t,n){this.contextMeta[n]=this.contextMeta[n]||{};if(!this.contextMeta[n][t]){e.logger.warn("Context Menu Meta for "+t+":"+n+" was not found in the cache. Calculating.");var r=e.data.createBean(t);this.contextMeta[n][t]=this.calculateContextMeta(r,t,n)}return this.contextMeta[n][t]},isStandardModule:function(t){return _.contains(e.config.knownModules,t)},initSubpanels:function(){var t=e.metadata.getModuleNames();t.push("Users"),_.each(t,function(n){var r=e.metadata.getModule(n,"layouts"),i=r?r.subpanels:null;if(!i)return;var s=[];_.each(i.meta.components,function(r,i){var o,u;try{o=e.data.getRelatedModule(n,r.context.link),u=e.nomad.getRelationship(n,r.context.link)}catch(a){o=null,u=null}_.contains(t,o)||(o=null),o&&u?(r.module=o,r.creatable=(_.isUndefined(r.canCreate)&&_.isUndefined(r.creatable)?!0:r.canCreate||r.creatable)&&!_.contains(e.config.nonCreatableModules,o),r.linkable=(_.isUndefined(r.canLink)&&_.isUndefined(r.linkable)?!0:r.canLink||r.linkable)&&!_.contains(e.config.nonLinkableModules,o)&&(!_.contains(["Meetings","Calls","Notes","Tasks"],o)||!u.via_parent_id),r.unlinkable=_.isUndefined(r.unlinkable)?!0:r.unlinkable):s.push(i)});for(var o=0;o<s.length;++o)i.meta.components.splice(s[o]-o,1)})},hasLinkableSubpanels:function(t){return _.any(t,function(t){return t.linkable&&e.acl.hasAccess("list",t.module)})},hasCreatableSubpanels:function(t){return _.any(t,function(t){return t.creatable&&e.acl.hasAccess("create",t.module)})},getSubpanels:function(t){var n=e.metadata.getModule(t,"layouts").subpanels;return n&&n.meta?n.meta.components:[]},canCreateModule:function(t){var n=e.nomad.contextMeta.all[t]||{};return e.acl.hasAccess("create",t)&&!_.include(e.config.nonCreatableModules,t)&&(e.nomad.isStandardModule(t)||_.isEmpty(n.docFields)||!_.find(n.docFields,function(e){return e.type!=="image"}))},hasAccessToRequiredFields:function(t,n){var r,i=e.controller.context.get("model"),s=n||"edit";return r=!!_.chain(e.metadata.getModule(t).fields).filter(function(e){return e.required}).find(function(t){return!e.acl.hasAccessToModel(s,i,t.name)}).value(),!r},canCreateRelated:function(e,t){return this._getSubpanel(e,t).creatable},canLinkRelated:function(e,t){return this._getSubpanel(e,t).linkable},canUnlinkRelated:function(e,t){return this._getSubpanel(e,t).unlinkable},canDisplay:function(e,t){return!e.context.get("link")||!(t.type==="parent"||t.type==="relate"&&_.include(e.relateFields,t.name))},_getSubpanel:function(e,t){return _.find(this.getSubpanels(e),function(e){return e.context.link===t})||{}},getSingularModuleName:function(t){return e.lang.getAppListStrings("moduleListSingular")[t]||this.getPluralModuleName(t)},getPluralModuleName:function(t){return e.lang.getAppListStrings("moduleList")[t]||t},showAlert:function(t,n,r,i){this._showAlert(t,n,r||e.lang.getAppString("LBL_WARNING"),i||e.lang.getAppString("LBL_OK"))},showConfirm:function(t,n,r,i){this._showConfirm(t,n,r||e.lang.getAppString("LBL_CONFIRM"),i||[e.lang.getAppString("LBL_NO"),e.lang.getAppString("LBL_YES")])},_executeActionSheetCallback:function(t){e.routing.emulateBackButton?e.activeComponents.executeOnActiveComponentClose(t):t()},sendEmail:function(t,n,r){var i=this;t.length>1?this._showActionSheet(e.lang.getAppString("LBL_MOBILE_CHOOSE_RECIPIENT"),t,function(e,t){i._executeActionSheetCallback(function(){i._showEmailComposer(n,r,e)})}):this._showEmailComposer(n,r,t[0])},showEmailBody:function(t,n){var r=_.isArray(t)?t[0]:t,i=n.get(r.name),s=e.view.fields.EmailbodyField.getPlainTextValue(r.name,n),o="emailbody-edit",u=e.controller.createDynamicLayout(o,"EmailBodyView",[{name:o,context:e.controller.context,editedFieldName:e.lang.get(r.label,"Emails"),value:i||e.nomad.utils.nl2br(s)}]),a=u.getComponent(o);a.on("cancel:clicked",function(){e.controller.disposeDynamicLayout()},this),e.controller.showDynamicLayout(o)},sendConsoleLog:function(e,t,n){var r=this;this._getConsoleLogFilename(function(i){r._showEmailComposer(t,n,e,i)})},callPhone:function(t,n){var r=this;if(_.isArray(t)&&t.length>1){var i=this._buildNamedList(t);this._showActionSheet(e.lang.getAppString("LBL_MOBILE_CHOOSE_PHONE"),i,function(i,s){r._executeActionSheetCallback(function(){e.telephony.callPhone(r._extractValue(t,s),n)})})}else e.telephony.callPhone(this._extractValue(t),n)},sendSms:function(t,n){var r=this;if(_.isArray(t)&&t.length>1){var i=this._buildNamedList(t);this._showActionSheet(e.lang.getAppString("LBL_MOBILE_CHOOSE_PHONE"),i,function(e,i){r._executeActionSheetCallback(function(){r._showSmsComposer(r._extractValue(t,i),n)})})}else this._showSmsComposer(this._extractValue(t),n)},openUrl:function(t){if(_.isArray(t)&&t.length>1){var n=_.map(t,function(e){return _.keys(e)[0]}),r=this;this._showActionSheet(e.lang.getAppString("LBL_MOBILE_CHOOSE_URL"),n,function(e,n){r._executeActionSheetCallback(function(){r._browseUrl(r._normalizeUrl(r._extractValue(t,n)))})})}else this._browseUrl(this._normalizeUrl(this._extractValue(t)))},showDateTimePicker:function(e,t,n){this._showDateTimePicker(e,t,n)},openDoc:function(t){var n=this;if(_.isArray(t)&&t.length>1){var r=_.map(t,function(t,n,r){return e.nomad.utils.replaceGuid(_.keys(t)[0],e.lang.get("LBL_MOBILE_DOC")+" "+(n+1))});this._showActionSheet(e.lang.getAppString("LBL_MOBILE_CHOOSE_DOC"),r,function(e,r){n._executeActionSheetCallback(function(){n._openDocWorker(t,r)})})}else this._openDocWorker(t)},_openDocWorker:function(e,t){var n=_.clone(this._extractValue(e,t));n.url=this._normalizeUrl(n.url),this._flushCacheUrl(n),n.openExternally?this._browseUrl(n.url):this._browseDoc(n)},openAddress:function(t){var n=e.clientInfo.device,r=n.osVersion||n.version||"",i=!n.ios||n.ios&&!e.isNative?"g":"a";if(_.isArray(t)&&t.length>1){var s=this,o=_.map(t,function(e){return _.keys(e)[0]});this._showActionSheet(e.lang.getAppString("LBL_MOBILE_CHOOSE_LOCATION"),o,function(e,n){s._executeActionSheetCallback(function(){s._openMap(s._extractValue(t,n),i)})})}else this._openMap(this._extractValue(t),i)},_openMap:function(t,n){var r="",i=n==="a"?"maps.apple.com":"maps.google.com";if(!t)t="";else{var s="";if(t.country&&_.isString(t.country)){s=t.country.replace(/\s?\,\s?/g,",");if(/ of$/.test(s)||/ of the$/.test(s)){var o=s.split(",");s=o[o.length-1];for(var u=0;u<o.length-1;u++)s=s.concat(" "+o[u])}else s=t.country.replace(/\,/g,"")}t=_.compact([t.street,t.city,t.state,t.postalcode,s]).join(",")}r="http://"+i+"/maps?q="+encodeURI(t),e.logger.debug("Opening map: "+r),this._browseUrl(r)},_buildNamedList:function(e){return _.map(e,function(e){return _.keys(e)[0]+" - "+_.values(e)[0]})},_extractValue:function(e,t){return t||(t=0),_.isString(e)?e:_.values(e[t])[0]||e[t].value||e[t]},_normalizeUrl:function(e){if(/https?:\/\/|itms:\/\/|itms-apps:\/\//.test(e))return e;if(/^\.\.\//.test(e)){var t=window.location.href.split("#")[0].split("index.html")[0];return e=t+e,e}return"http://"+e},_flushCacheUrl:function(e){if(_.has(e,"noCache")&&!e.noCache)return;var t=e.url.split("#")[0],n=[t,t.indexOf("?")!==-1?"&":"?","__ts=",+(new Date)];e.noCache=!1,e.url=n.join("")},fillContent:function(e){this._div=this._div||$("#background"),this._div[e?"show":"hide"]()},isEmptyValue:function(e){return _.isNull(e)||_.isUndefined(e)||!_.isNumber(e)&&_.isEmpty(e)||_.isNumber(e)&&!_.isFinite(e)},redraw:function(e){function r(){t.append(n),_.delay(function(){n.remove()},e)}var t=$(document.body),n=$("<style> body {opacity: 0.99;}</style>");e?_.delay(r,e):r()},closeHeaderMenu:function(t){var n=e.additionalComponents.header;n&&n.closeMenus(t)},clearSelection:function(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},showDataSyncStartAlert:function(t){this.showDataSyncOverlay(),t&&e.alert.show("data_syncing",{level:"load",messages:t,closeable:!1,autoClose:!1})},showDataSyncOverlay:function(){e.additionalComponents.header.setButtonsEnabled(!1),e.overlay.show("data:sync",{spinner:!1})},hideDataSyncOverlay:function(t,n){e.overlay.hide("data:sync"),e.additionalComponents.header.setButtonsEnabled(!0,t,n)},showDataSyncEndAlert:function(t,n,r){this.hideDataSyncOverlay(n,r),e.alert.dismiss("data_syncing");if(n)return;t&&e.alert.show("data_sync_success",{level:"success",messages:t,autoClose:!0})},configure:function(t,n,r){function i(){window.location.href="#",e.router.navigate(r,{trigger:!0})}function s(){e.nomad.setSetting({loginName:n,loginUrl:t,siteUrl:e.config.siteUrl});var r=e.controller.context.get("params");if(r&&r.layout==="login"){$("#username").val(n),$("#url").val(t),$("#password").val("");var s=e.controller.context.get("model");s&&(s.set("username",n),s.set("url",t),s.set("password",""))}else e.router.login();_.delay(function(){i()},1e3)}if(!e.config.allowUrlReconfigure)return i(),!1;e.logger.debug("Reconfiguring the client with username="+n+" and loginUrl="+t),n=n?decodeURIComponent(n):"",t=t?decodeURIComponent(t):"";if(e.config.configUrlWhiteList){var o=0;for(;o<e.config.configUrlWhiteList.length;o++){var u=new RegExp(e.config.configUrlWhiteList[o]);if(u.test(t))break}o===e.config.configUrlWhiteList.length&&(e.logger.warn("Configure server URL "+t+" is not in the white list. Ignoring value"),t=e.nomad.getSetting("loginUrl")||"")}var a=n!==e.nomad.getSetting("loginName")||t!==e.nomad.getSetting("loginUrl");return a?e.api.isAuthenticated()?e.logout({complete:function(){s()}},!0):s():i(),a},updateAuthStore:function(){e.isNative&&(e.keychain.OAUTH["meta:hash"]=e.metadata.getHash(),e.keychain.OAUTH["userpref:hash"]=e.user.get("_hash"))},isDownloadTokenSupported:function(){return!_.isEmpty(e.api.getDownloadToken())},getFileOptions:function(){var t=e.nomad.isDownloadTokenSupported();return{htmlJsonFormat:!1,iframe:!1,passOAuthToken:!t,passDownloadToken:t}},getVersion:function(){return e.clientInfo.app.version+"."+e.clientInfo.app.build+(e.config.env!=="prod"?" ("+e.config.env+")":"")},getServerVersion:function(){var t="N/A";return e.serverInfo&&e.api.isAuthenticated()&&(t=e.serverInfo.version+" "+e.serverInfo.flavor+" (FTS: "+(e.serverInfo.fts.enabled?e.serverInfo.fts.type:"N/A")+")"),t},getServerUrl:function(){return e.isNative?e.config.siteUrl+"/rest/v"+e.config.restVersion:e.config.serverUrl},getDesktopUrl:function(){return e.config.siteUrl+"?mobile=0"},canFollow:function(t){var n=t.module;return e.serverInfo.isSevenUp&&_.contains(e.config.followableModules,n)&&e.acl.hasAccessToModel("view",t)},promptAndPreloadUserRecords:function(t){var n=this,r=e.lang.getAppString(t?"LBL_OFFLINE_PREFETCH_FIRST_PROMPT":"LBL_OFFLINE_PREFETCH_PROMPT"),i=t?[e.lang.getAppString("LBL_LATER"),e.lang.getAppString("LBL_YES")]:null,s="preload_prompted";if(t){var o=this.getSetting(s);if(o)return}e.nomad.showConfirm(r,function(t){n.setSetting(s,!0),t===2&&(e.nomad.dismissAlerts(),n._preloadRecords(function(t){e.controller.clean(!0,!0),t?e.alert.show("prefetch_failed",{level:"error",messages:e.lang.getAppString("LBL_OFFLINE_PREFETCH_ERROR"),autoClose:!0,closable:!0}):e.alert.show("prefetch_success",{level:"success",messages:e.lang.getAppString("LBL_OFFLINE_PREFETCH_SUCCESS"),autoClose:!0,closable:!0})}))},null,i)},_preloadRecords:function(t){var n={},r=_.filter(e.offline.utils.getOfflineModules(),function(t){return!e.config.offline.prefetch.staticModules[t]});_.each(r,function(t){var r=e.config.offline.prefetch.dynamicModules&&e.config.offline.prefetch.dynamicModules[t]?e.config.offline.prefetch.dynamicModules[t]:e.config.offline.prefetch.maxThreshold;r=r||100,n[t]=r});var i=e.utils.versionCompare(e.serverInfo.version,"7.2",">=")?["my_items","favorite","following"]:["my_items","favorite"];e.offline.syncManager.recordsPreloader.start({filter:i,modules:n,callback:t})}})}(SUGAR.App),function(e){e.nomad.utils={sizePicture:function(e){var t=parseInt(e.height,10),n=parseInt(e.width,10),r=e.image.naturalHeight,i=e.image.naturalWidth;r<i?e.sizeProp=t/r*i+"px "+t+"px":e.sizeProp=n+"px "+n/i*r+"px"},minutesToQuarterHours:function(e){e=parseInt(e,10);if(e===0)return e;if(e<8)return 15;var t=Math.floor(e/15),n=e%15;return n>7&&(t+=1),t*15},pad:function(e,t,n){return n=n||"0",e=String(e),e.length>=t?e:(new Array(t-e.length+1)).join(n)+e},getPrimaryEmail:function(e,t){var n=_.find(e,this.isPrimaryEmail);return t&&n?n.email_address:n},replaceGuid:function(e,t){var n=/([\w\d]{8}\-[\w\d]{4}-[\w\d]{4}-[\w\d]{4}-[\w\d]{12})/;return e.replace(n,t)},extractAndSortEmails:function(e){var t=_.flatten(_.map(e,_.values));return t=_.reject(t,function(e){return Number(e.invalid_email)||Number(e.opt_out)}),t=_.sortBy(t,function(e){return Number(e.primary_address)?0:1}),t=_.pluck(t,"email_address"),t},isPrimaryEmail:function(e){var t=e.primary_address;return _.isBoolean(t)||(t=!!parseInt(e.primary_address,10)),t},nl2br:function(e){var t=e||"";return t=String(t),t.replace(/\n|\r|\r\n/g,"<br />")},iso2sugar:function(n,r){return $.os.android&&(e.isNative||r.nativeSupport)?n:n.replace(/\.?\d+?Z/,"+00:00")},getTimeZoneOffsetString:function(e){var t=e||(new Date).getTimezoneOffset(),n=t>=0?"+":"-";t=Math.abs(t);var r=Math.floor(t/60),i=t%60;return n+this.pad(r,2)+":"+this.pad(i,2)},getHash:function(){var e=window.location.hash;return e&&(e=e.split("~")[0]),e||"#"},isOnDynamicRoute:function(){return window.location.hash.indexOf("~")!==-1},canGoBack:function(){var e=$.browser.chromeMobile?2:1;return window.history.length>e},resolveUrl:function(e,t){var n=document,r=n.getElementsByTagName("base")[0],i=r&&r.href,s=n.head||n.getElementsByTagName("head")[0],o=r||s.appendChild(n.createElement("base")),u=n.createElement("a"),a;return o.href=t,u.href=e,a=u.href,r?r.href=i:s.removeChild(o),a},merge:function(){function e(e,t){return t}return function(n,r,i){var s;if(_.isUndefined(n))s=r;else{if(!_.isUndefined(r)){var o=_.first(arguments,2),u=_.map(o,_.keys),a=_.intersection.apply(_,u),f={};return _.each(o,function(e,t){_.each(u[t],function(t){f[t]=e[t]})}),_.isUndefined(i)&&(i=e),_.each(a,function(e){f[e]=i(n[e],r[e])}),f}s=n}return _.clone(s)}}(),deepClone:function t(e){var n={};return _.each(e,function(e,r){n[r]=_.isObject(e)?t(e):e}),n},getOfflineStatusClass:function(){var t=e.offline.status;if(t){if(t.state===e.offline.STATE.ERROR)return"status-error";if(t.state===e.offline.STATE.WARNING)return"status-warning"}return"status-success"},humanFileSize:function(){function n(e){var n=0,r=1024;while(e>r/10&&++n<t.length-1)e/=r;this.value=(e+.05).toFixed(1),this.units=t[n]}var t=" K M G T P E Z Y".split(" ").map(function(e){return e+"B"});return n.prototype._i18nUnits=function(){var t="LBL_FILE_SIZE_UNITS_"+this.units,n=e.lang.get(t);return n===t?null:n},n.prototype.toString=function(e){var t=e&&this._i18nUnits()||this.units;return this.value+" "+t},function(e){return e!==-1?new n(e):null}}(),isErrorEmulationEnabled:function(){return e.config.errorEmulation.enabled&&e.user.get("user_name")===e.config.errorEmulation.user.toLowerCase()},parseQueryString:function(e){function t(e,t){var n=String(e).replace(/^&/,"").replace(/&$/,"").split("&"),r=n.length,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))};t||(t=this.window);for(i=0;i<r;i++){p=n[i].split("="),d=b(p[0]),v=p.length<2?"":b(p[1]);while(d.charAt(0)===" ")d=d.slice(1);d.indexOf("\0")>-1&&(d=d.slice(0,d.indexOf("\0")));if(d&&d.charAt(0)!=="["){g=[],m=0;for(s=0;s<d.length;s++)if(d.charAt(s)==="["&&!m)m=s+1;else if(d.charAt(s)==="]"&&m){g.length||g.push(d.slice(0,m-1)),g.push(d.substr(m,s-m)),m=0;if(d.charAt(s+1)!=="[")break}g.length||(g=[d]);for(s=0;s<g[0].length;s++){h=g[0].charAt(s);if(h===" "||h==="."||h==="[")g[0]=g[0].substr(0,s)+"_"+g[0].substr(s+1);if(h==="[")break}f=t;for(s=0,y=g.length;s<y;s++){d=g[s].replace(/^['"]/,"").replace(/['"]$/,""),l=s!==g.length-1,a=f;if(d!==""&&d!==" "||s===0)f[d]===c&&(f[d]={}),f=f[d];else{o=-1;for(u in f)f.hasOwnProperty(u)&&+u>o&&u.match(/^\d+$/g)&&(o=+u);d=o+1}}a[d]=v}}}var n={};return t(e,n),n},getOrientation:function(){var e=window.orientation===0||window.orientation===180?"portrait":"landscape";return e},docIsAvailable:function(t){return!_.isEmpty(t)&&(!e.offline||e.offline.isOnline())}}}(SUGAR.App),function(e){var t={_callbacks:[],_executeOnceOnPopState:[],CLOSE_RECENT:"close-recent",CLOSE_ALL:"close-all",enableBackButtonHandling:function(){window.addEventListener("popstate",_.bind(e.activeComponents.handlePopState,e.activeComponents),!0)},add:function(t,n,r){var i={componentId:t,closeCallback:n,context:r};if(e.routing.emulateBackButton){var s=this.buildHash(t);e.nomad.utils.isOnDynamicRoute()?window.history.replaceState(null,null,s):window.history.pushState(null,null,s)}this._callbacks.push(i)},remove:function(t,n,r,i){_.isUndefined(i)&&(i=!0);if(!t){this._callbacks=[];return}this._callbacks=_.reject(this._callbacks,function(e){return this._callbackMatches(e,t,n,r)},this),e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()&&i&&(this.hasActiveComponents()?this.setRecentComponentUrl():(window.manualGoBack=!0,window.history.go(-1)))},setRecentComponentUrl:function(){var t=_.last(this._callbacks),n=this.buildHash(t.componentId);e.nomad.utils.isOnDynamicRoute()?window.history.replaceState(null,null,n):window.history.pushState(null,null,n)},close:function(e,t,n){this._callbacks=_.reject(this._callbacks,function(r){var i=this._callbackMatches(r,e,t,n);return i&&this._runCallback(r),i},this)},closeAll:function(){_.each(this._callbacks,function(e){this._runCallback(e,this.CLOSE_ALL)},this),this.clear()},hasActiveComponents:function(){return this._callbacks.length>0},clear:function(){this._callbacks=[]},closeRecent:function(){var t=this._callbacks.pop();t&&(this._runCallback(t,this.CLOSE_RECENT),e.routing.emulateBackButton&&this.hasActiveComponents()&&this.setRecentComponentUrl())},_callbackMatches:function(e,t,n,r){var i=t===e.componentId,s=!n||n===e.closeCallback,o=!r||r===e.context;return i&&s&&o},_runCallback:function(e,t){var n=e.closeCallback,r=e.context;r?n.call(r,t):n(t)},buildHash:function(t){var n=e.nomad.utils.getHash();return n+"~"+t},getActiveComponentId:function(){return window.location.hash.split("~")[1]||""},executeOnActiveComponentClose:function(e){this._executeOnceOnPopState.push(e)},executePopStateCallbacks:function(){_.each(this._executeOnceOnPopState,function(e){e()}),this._executeOnceOnPopState=[]},handlePopState:function(){function t(){e.activeComponents.closeRecent();if(e.isRightMenuOpen||e.isLeftMenuOpen)e.isMenuDisabled=!1}this.executePopStateCallbacks();if(!e.controller.layout)return!0;if(window.manualGoBack){delete window.manualGoBack;return}e.activeComponents.hasActiveComponents()&&($.browser.chromeMobile||$.browser.chrome?_.defer(t):$.os.ios&&_.delay(t,100))}};e.augment("activeComponents",t,!1)}(SUGAR.App),function(e){var t=e.alert.show,n={};e.events.on("offline:status:update",function(e){e.noConnection||(n={})}),e.alert.show=function(r,i){if(i.pageHash&&i.pageHash!==window.location.hash)return;if(i.uid&&e.offlineEnabled){if(n[i.uid]>0)return;n[i.uid]=++n[i.uid]||1}t.apply(this,arguments)}}(SUGAR.App),function(e){var t=e.data.sync;_.extend(e.data,{sync:function(n,r,i){var s=this,o=i.success,u;i.apiOptions=i.apiOptions||{},i.apiOptions.pageHash=window.location.hash,i.success=function(e,t,n){s._computePaginationInfo(e,t,n),o&&o.apply(this,arguments)},r instanceof e.BeanCollection&&i.query&&(u=r.orderBy,delete r.orderBy),r instanceof e.MixedBeanCollection&&!_.isEmpty(r.module_list)&&(i.fields=_.chain(r.module_list).map(function(t){return e.metadata.getModule(t).mergedFields}).flatten().uniq().value()),t.apply(this,arguments),u&&(r.orderBy=u)},_computePaginationInfo:function(t,n,r){t instanceof e.BeanCollection&&(t.offset=t.next_offset!==-1?t.next_offset:r.offset,t.records_count=n.length)}})}(SUGAR.App),function(e){var t=e.plugins.attach;_.extend(e.plugins,{attach:function(n,r){_.each(n.plugins,function(t,i){if(_.isObject(t)){var s=_.keys(t)[0];t=s}var o=e.plugins._get(t,r);o&&!this._isPluginDisabled(n,t)&&o.globalEvents&&(n.constructor.prototype.hasOwnProperty("globalEvents")||(n.constructor.prototype.globalEvents={}),_.extend(n.constructor.prototype.globalEvents,o.globalEvents))},this),t.apply(this,arguments)}})}(SUGAR.App),function(e){function n(e,t){t&&e&&_.each(t,function(n,r){if(e[r])return;delete t[r]})}function r(e){var t=_.chain(e.subpanels.subpanel_setup).values().sortBy(function(e){return e.order}).value();_.each(t,function(e){e.context={link:e.get_subpanel_data},e.label=e.title_key,g(e,["subpanel_name","title_key","get_subpanel_data","order"])}),e.layouts=_.extend(e.layouts||{},{subpanels:{meta:{components:t}}}),delete e.subpanels}function i(t,n){if(t._hash==="_base_")return;var r=null;_.each(t.modules,function(i,s){var o=[];_.each(i.views,function(t){if(t.meta){var n=_.chain(t.meta.panels[0].fields).filter(function(e){return e.type!=="link"}).map(function(e){return _.isString(e)?{name:e}:e}).value();r=new e.view.View({context:e.context.getContext(),meta:{panels:[{fields:n}]}}),o=_.union(o,r.getFieldNames(s)),r.dispose(),_.contains(o,"email")&&o.push("email1")}}),o=_.union(o,n?["name","my_favorite","following"]:["name"]),_.find(o,function(e){return i.fields[e]&&i.fields[e].type==="currency"})&&(o=_.union(o,["currency_id"])),s==="Opportunities"&&(o=_.union(o,["closed_revenue_line_items"])),s==="Documents"&&(o=_.union(o,["doc_url","doc_type","filename"]));if(!t.server_info.ftsEnabled||!i.ftsEnabled)o=_.chain(i.fields).filter(function(e){return!!e.unified_search&&e.type!=="link"}).map(function(e){return e.name}).union(o).value();i.mergedFields=_.union(i.mergedFields||[],o)})}function s(e){var t=e.toUpperCase();return t.substr(-2)==="_C"&&(t=t.substr(0,t.length-2)),"LBL_"+t}function m(t){function a(e){function t(e){return e.charCodeAt(0)&255}var n=Array.prototype.map.call(e,t),r=new Uint8Array(n);return r.buffer}var n=t.files,r=t.files.fieldName,i=n.fileData.name||"newfile",s=n.fileData.type||"application/octet-stream",o=n.fileData.binary,u={"OAuth-Token":e.api.getOAuthToken()},f="xxxxxx",l="\r\n",c="";return c+="--"+f+l,c+="Content-Disposition: form-data;",c+='name="'+r+'"; filename="'+i+'"'+l,c+="Content-Type: "+s+l+l,c+=o+l,c+="--"+f+"--",$.ajax({complete:t.complete,error:t.error,success:t.success,type:"POST",url:t.url,data:a(c),processData:!1,contentType:"multipart/form-data; boundary="+f,headers:u,dataType:"json"})}function g(e,t){_.each(t,function(t){t instanceof RegExp?g(e,_.filter(_.keys(e),function(e){return t.test(e)})):delete e[t]})}e.metadata.copy=function(e){return e};var t=e.metadata.set;e.metadata.set=function(o,u,a){o._override_values&&_.each(o._override_values,function(e,t){o[e]||delete o._override_values[t]});if(o.config){var f={};o.config.analytics&&!e.isNative&&(e.config.analytics.enabled=Boolean(o.config.analytics.enabled),f.analytics=e.config.analytics,e.analytics.init()),f.offlineEnabled=Boolean(o.config.offlineEnabled),o.config=f}var l=!1;o.server_info?(l=e.nomad.isSevenUp(o.server_info),o.server_info.isSevenUp=l,o.server_info.offlineSupported=e.offline&&e.offline.isSupported(o.server_info),!l&&!_.contains(e.config.unsupportedModules,"Products")?e.config.unsupportedModules.push("Products"):l&&(e.config.unsupportedModules=_.without(e.config.unsupportedModules,"Products"))):o.server_info={};if(!a&&o._hash!=="_base_"){var c=e.metadata.getHash();c!==o._hash&&c!=="_base_"&&(o.modules?(e.logger.debug("Metadata hash has changed. Resetting to base."),e.metadata.reset(),e.metadata.set(JSON.parse(JSON.stringify(e.baseMetadata)),!1,!0)):o._hash=c),o.app_list_strings&&o.app_list_strings.available_language_dom&&delete o.app_list_strings.available_language_dom[""],o.currencies||(o.currencies={}),_.each(o.currencies,function(e){e.conversion_rate=e.conversion_rate||e.rate}),_.each(o.modules_info,function(t,n){_.contains(e.config.unsupportedModules,n)&&delete o.modules_info[n]}),o.mod_strings||(o.mod_strings={});var h=e.config.unsupportedModules||[];_.each(o.modules,function(e,t){_.contains(h,t)&&(delete o.modules[t],delete o.mod_strings[t])});var p=_.contains(["ENT","ULT"],o.server_info.flavor),d="portal_flag";_.isEmpty(o.relationships)&&(o.relationships={});var v=o.relationships.tasks_notes;v&&(v.relationship_role_column="parent_type",v.relationship_role_column_value="Tasks",v.relationship_type="one-to-many"),_.each(o.relationships,function(e,t){e.relationship_type=e.true_relationship_type||e.relationship_type;if(o.modules[e.lhs_module]&&o.modules[e.rhs_module]){if(e.relationship_role_column==="parent_type"||t==="contact_tasks"||t==="contact_notes")e.via_parent_id=!0}else t!=="_hash"&&delete o.relationships[t]}),o.relationships.accounts_opportunities&&(o.relationships.accounts_opportunities={lhs_key:"id",lhs_module:"Accounts",lhs_table:"accounts",name:"accounts_opportunities",relationship_type:"one-to-many",rhs_key:"account_id",rhs_module:"Opportunities",rhs_table:"opportunities"}),_.extend(o.relationships,e.baseMetadata.relationships);var m={},y={};_.each(o.modules,function(t,n){if(t._patched)return;l&&delete t.subpanels;var i={},u={};g(t,["config","fieldTemplates","filters","menu"]),t.layouts&&(g(t.layouts,_.filter(_.keys(t.layouts),function(e){return!_.contains(["list","detail","edit","subpanels"],e)})),t.layouts.subpanels&&t.layouts.subpanels.meta&&t.layouts.subpanels.meta.components&&_.each(t.layouts.subpanels.meta.components,function(e){i[e.label]=!0})),t.views&&g(t.views,_.filter(_.keys(t.views),function(e){return!_.contains(["list","detail","edit"],e)})),p||delete t.fields[d],(n==="RevenueLineItems"||n==="Products")&&t.fields.opportunity_name&&t.fields.opportunity_id&&t.fields.opportunity_id.required&&(t.fields.opportunity_name.required=!0),_.each(t.fields,function(e,n){g(e,["comment","dbType","isnull","table","reportable","audited","join_name","merge_filter","duplicate_merge","bean_name","cols","rows","function","importable","massupdate","studio","bean_filter_field","link_class","link_file","rhs_key_override","enable_range_search","sortable","duplicate_merge_dom_value","help","no_default","comments","custom_module","db_concat_fields","sort_on","subquery","query_type","operator","db_field","custom_type"]),i[e.vname]=!0,e.type==="id"&&delete e.len;if(e.name==="name"||e.type==="name")e.unified_search=!0;var r=["id","assigned_user_id","modified_user_id","create_by"];_.contains(r,e.name)&&(e.unified_search=!1),(e.type==="relate"||e.type==="parent")&&delete e.len,e.relationship_fields&&(u[e.name]=!0,_.each(e.relationship_fields,function(e){u[e]=!0;var n=t.fields[e];n&&(i[n.vname]=!0,n.options&&(y[n.options]=!0))})),e.required&&t.fields.email&&e.name==="email1"&&(t.fields.email.required=!0)});var a=t.fields.team_name;a&&(delete a.len,a.type="teamset"),a=t.fields.name,a&&(a.type="name"),n==="Meetings"&&(a=t.fields.date_start,a&&a.validation&&delete a.validation.compareto),t.views&&(delete t.views.listview,delete t.views.search);var f;o.mod_strings&&o.mod_strings[n]&&(o.mod_strings[n].LBL_EMAIL?f="LBL_EMAIL":o.mod_strings[n].LBL_EMAIL_ADDRESS&&(f="LBL_EMAIL_ADDRESS"));var c=/^(?=.*address)((?!email).)*$/;_.each(t.views,function(r,o){if(r.meta){delete r.meta.templateMeta;if(r.meta.panels){r.meta.panels.length&&(r.meta.panels.length=1);if(r.meta.panels[0]){var a=[],l=r.meta.panels[0].fields,h=-1;delete r.meta.panels[0].label,l=_.reject(l,function(r){var i=_.isString(r)?r:r.name,s=_.isEmpty(t.fields[i])&&r.type!=="fieldset";return s&&e.logger.error(n+"."+o+"."+i+" field is missing vardef"),s}),o==="list"&&(l=_.filter(l,function(e){return!!e["default"]})),r.meta.panels[0].fields=l,_.each(l,function(e,n){var r=_.isObject(e),v=r?e.name:e,m=t.fields[v],b;e.options&&(y[e.options]=!0),u[v]=!0,i[e.label||m.vname]=!0,m&&(m.options&&(y[m.options]=!0),m.type==="relate"?(u[m.id_name]=!0,u[m.link]=!0):m.type==="parent"&&(u.parent_id=!0,u.parent_type=!0)),e.type==="fieldset"&&_.each(e.fields,function(e){u[e.name]=!0,e["default"]?i[e["default"]]=!0:i[e.label||t.fields[e.name].vname]=!0,e.options&&(y[e.options]=!0)}),!p&&v===d&&(h=n);if(r){g(e,["default","enabled","link","width","wireless_edit_only","customCode"]);if(c.test(e.name)&&m)if(o==="edit")b=_.extend(e,{index:n}),b.group||(b.group=m.group),b.group&&a.push(b);else if(e.group||m.group)i[s(e.group||m.group)]=!0;e.name==="email1"&&(l[n]={name:"email",type:"email",label:e.label||f,required:m.required},i[e.label||f]=!0,u.email=!0)}else c.test(e)&&m&&(o==="edit"&&m.group?a.push({name:e,group:m.group,index:n}):m.group&&(i[s(m.group)]=!0)),e==="email1"&&(l[n]={name:"email",type:"email",label:f,required:m.required},i[f]=!0,u.email=!0)}),h!==-1&&l.splice(h,1);var v={};if(a.length>0){v=_.groupBy(a,"group");var m=0;_.each(v,function(e,t){var n=e[0].index-m;_.each(e,function(e){l.splice(n,1)});var r={name:t,fields:_.pluck(e,"name"),type:"address",label:s(t)};l.splice(n,0,r),m+=e.length-1,i[r.label]=!0})}o==="edit"&&(n==="Meetings"||n==="Calls")&&(l.push({name:"send_invites",type:"bool",label:"LBL_SEND_INVITE"}),l.push({name:"invitees",type:"invitees",label:"LBL_INVITEES"}))}}}});var v=[],b=[],w=function(t,n,r){v.push(n),n=t[n];if(n){var s=1e3;_.each(n.collection_list,function(n,u){if(!t[u]&&!n.generate_select&&!_.contains(b,n.module)&&!_.contains(h,n.module)){n.title_key="LBL_"+n.get_subpanel_data.toUpperCase()+"_SUBPANEL_TITLE",n.order=-(s++),n.creatable=!_.contains(e.config.nonCreatableModules,n.module),n.linkable=!1,t[u]=n;var a=o.mod_strings[r];a&&!a[n.title_key]&&(a[n.title_key]=n.module),i[n.title_key]=!0,b.push(n.module)}})}};_.isObject(t.subpanels)&&!_.isArray(t.subpanels)&&!_.isEmpty(t.subpanels.subpanel_setup)?(_.each(t.subpanels.subpanel_setup,function(r,s){if(!r)return;if(s!=="activities"&&s!=="history"){n!=="Meetings"&&n!=="Calls"||!_.contains(["Users","Leads","Contacts"],r.module)?r.panel_definition?r.module!=="Users"?(r.creatable=!_.contains(e.config.nonCreatableModules,r.module)&&!_.isEmpty(_.find(r.top_buttons,function(e){return!e.widget_class||e.widget_class.indexOf("Create")>-1})),r.linkable=!_.contains(e.config.nonLinkableModules,r.module)&&!_.isEmpty(_.find(r.top_buttons,function(e){return!e.widget_class||e.widget_class.indexOf("Select")>-1})),i[r.title_key]=!0):v.push(s):(r.creatable=(_.isUndefined(r.canCreate)?!0:r.canCreate)&&!_.contains(e.config.nonCreatableModules,r.module),r.linkable=(_.isUndefined(r.canLink)?!0:r.canLink)&&!_.contains(e.config.nonLinkableModules,r.module),i[r.title_key]=!0):(r.linkable=!0,r.creatable=r.module!=="Users",i[r.title_key]=!0),r.panel_definition&&(r.order=-r.order),r.get_subpanel_data&&r.get_subpanel_data.indexOf("function:")===0&&(r.get_subpanel_data=r.set_subpanel_data);var u=t.fields[r.get_subpanel_data];if(!u||!o.relationships[u.relationship])v.push(s),delete i[r.title_key],o.modules[r.module]&&e.logger.error("Invalid "+n+"."+s+" subpanel")}g(r,["add_subpanel_data","set_subpanel_data","top_buttons","panel_definition","sort_by","sort_order","subpanel_name"])}),w(t.subpanels.subpanel_setup,"activities",n),w(t.subpanels.subpanel_setup,"history",n),_.each(v,function(e){delete t.subpanels.subpanel_setup[e]}),r(t)):delete t.subpanels,e.config.skipStringCleanup||(o.mod_strings&&(_.each(o.mod_strings[n],function(t,r){!i[r]&&!_.contains(e._mod_strings,r)&&delete o.mod_strings[n][r]}),_.each(i,function(e,t){o.mod_strings[t]||(m[t]=!0)})),_.each(t.fields,function(e,n){if(n!=="_hash"&&_.isEmpty(e.name)){delete t.fields[n];return}if(n==="id")return;e.type==="link"?!o.relationships[e.relationship]:!u[n]||e.options&&(y[e.options]=!0)}))});if(!e.config.skipStringCleanup)if(_.isEmpty(o.modules)&&!_.isEmpty(e.metadata.getModules())){n(e.metadata.getStrings("app_strings"),o.app_strings),n(e.metadata.getStrings("app_list_strings"),o.app_list_strings);if(!_.isEmpty(o.mod_strings)){var b=e.metadata.getStrings("mod_strings");_.each(b,function(e,t){n(e,o.mod_strings[t])})}}else o.app_list_strings&&!o.app_list_strings._patched&&(_.each(o.app_list_strings,function(t,n){!y[n]&&!_.contains(e._app_list_strings,n)&&delete o.app_list_strings[n]}),o.app_list_strings._patched=!0),o.app_strings&&!o.app_strings._patched&&(_.each(e._app_strings,function(e){m[e]=!0}),_.each(o.app_strings,function(e,t){m[t]||delete o.app_strings[t]}),o.app_strings._patched=!0)}t.apply(this,arguments),i(o,l)};var o={base:1,bool:1,currency:1,date:1,datetimecombo:1,email:1,emailbody:1,"enum":1,"float":1,image:1,"int":1,multienum:1,name:1,parent:1,password:1,phone:1,radioenum:1,relate:1,address:1,invitees:1,send_invites:1,teamset:1,text:1,textarea:1,url:1},u={file:["edit"],image:function(){return e.supportedFeatures.fileUpload?undefined:["edit"]},password:["edit"],emailbody:["list"],html:[],encrypt:[],currency_id:[]},a={currency_symbol:[]},f=e.metadata._patchMetadata;e.metadata._patchMetadata=function(e,t){return!t||t._patched===!0?t:(f.apply(this,arguments),_.each(t.views,function(e,n){e.meta&&_.each(e.meta.panels,function(e){var r=[];_.each(e.fields,function(e,i){var s=u[e.type];_.isFunction(s)&&(s=s()),s&&(s.length===0||_.contains(s,n))&&r.push(i);var f=a[e.name];f&&(f.length===0||_.contains(f,n))&&r.push(i),n==="edit"&&!o[e.type]&&(e.view="readonly"),n==="edit"&&e.name==="date_modified"&&(e.view="readonly"),n==="edit"&&e.name==="date_entered"&&(e.view="readonly"),e.type==="url"&&t.fields[e.name]&&Boolean(t.fields[e.name].gen)&&r.push(i)}),_.each(r,function(t,n){e.fields.splice(t-n,1)})},this)},this),t)},e.error.errorName2Keys.email="ERR_MOBILE_EMAIL";var l={All:["created_by","created_by_name","modified_by_name","modified_user_id","date_entered","date_modified","my_favorite","deleted",/^email([^_]|_(?!c$))+$/],Employees:["user_name","user_hash","system_generated_password","pwd_last_changed","authenticate_id","sugar_login","is_admin","picture","status"],Calls:["status"],Contacts:["portal_active","portal_app","portal_name","portal_password","portal_password1"],Notes:["contact_email","contact_phone","file_mime_type","file_url"],Tasks:["contact_email","contact_phone","status"],Meetings:["status"],RevenueLineItems:["quote_id","quote_name"],Opportunities:["closed_revenue_line_items"]},c=["file","password","image"],h=function(){function r(e){return _.find(n,function(t,n){var r=n.split(/,\s*/);return _.contains(r,e)})}function i(){if(t!==null)return t;var n=e.metadata.getServerInfo().flavor,i=l,s=r(n);return t=e.nomad.utils.merge(i,s,function(e,t){return _.union(e,t)}),t}var t=null;e.events.on("app:sync:complete",function(){t=null});var n={"ENT, ULT":{Opportunities:["amount","date_closed"]}};return function(e){var t=i(),n=t.All,r=t[e];return r&&(n=_.union(n,r)),n}}(),p=e.Bean.prototype.copy;e.Bean.prototype.copy=function(t,n,r){p.call(this,t,n,r);var i=this.get("email1"),s=function(e,t){_.isString(t)?e.unset(t):_.each(e.attributes,function(n,r){t.test(r)&&e.unset(r)})};_.each(h(this.module),function(e){s(this,e)},this);var o=e.metadata.getModule(this.module),u=o?o.fields:null,a=_.chain(u).filter(function(e){return _.contains(c,e.type)}).pluck("name").value();_.each(a,function(e){this.unset(e)},this),i&&this.set("email1",i),e.controller.context.get("dupe")&&_.each(this.toJSON(),function(t,n){e.acl.hasAccessToModel("edit",this,n)||s(this,n)},this)},e.MixedBeanCollection.prototype.fetch=function(t){t=t||{},t.module_list=this.module_list=t.module_list||this.module_list||e.metadata.getModuleNames();if(!t.module_list.length)return;var n=_.clone(t),r=_.isUndefined(n.myItems)?this.myItems:n.myItems;return r&&(n.module_list=_.reject(n.module_list,function(t){return!e.nomad.supportsMyItems(t)})),e.BeanCollection.prototype.fetch.call(this,n)},e.augment("hacks",{hackModuleList:function(){var t=e.user.get("module_list"),n=e.metadata.getModules();for(var r=0;r<t.length;++r)n[t[r]]||t.splice(r--,1)},hackAcls:function(){var t=e.user.getAcls(),n=t.Users;n["delete"]="no",_.isArray(n.fields)&&(n.fields={}),n.fields.status={create:"no",write:"no"},_.each(_.keys(t),function(n){!e.metadata.getModule(n)&&!_.contains(e.user.get("module_list"),n)&&delete t[n]}),e.user.set("acl",t)}}),delete e.validation.validators.datetime,delete e.validation.validators.primaryEmail,e.data.getEditableFields=function(t,n){var r={};return r.id=t.get("id"),_.each(n,function(n){e.acl.hasAccessToModel("edit",t,n)&&(r[n]=t.get(n))}),r};var d=$.param;$.param=function(e){return e instanceof ArrayBuffer?e:d.apply(this,arguments)};var v=$.ajax;$.ajax=function(e){return e.files&&e.files.length>0?m(e):v.apply($,arguments)};var y=e.metadata.sync;e.metadata.sync=function(t,n){if(e.lang.getLanguage()&&e.user.get("preferences")&&e.lang.getLanguage()!==e.user.get("preferences").language||!e.config.cacheMeta)n=n||{},n.forceRefresh=!0,e.logger.debug("Forcing meta refresh as user language has changed");y.call(this,t,n)},e.accessibility={run:function(){}},e.events.on("app:init",function(){var t=e.api.records;e.api.records=function(n,r,i,s,o,u){r==="Meetings"&&n==="read"&&e.serverInfo.isSevenUp&&_.isEmpty(i)&&(s=s?e.utils.deepCopy(s):{},s.filter=s.filter||[],s.filter.push({date_start:{$gte:(new Date(new Date-9e5)).toISOString()}})),t.apply(e.api,arguments)}})}(SUGAR.App),function(e){e.augment("overlay",{init:function(){this.overlayHash={}},show:function(t,n){if(this.overlayHash[t])return!1;n=_.extend({tint:!1,spinner:!0,template:!1},n);var r=n.message||"";!r&&n.label&&(r=e.lang.getAppString(n.label));var i=$(e.template.get("overlay")());if(n.template)i.html(e.template.get(n.template)({message:r}));else{var s=i.find("#overlay-message");i.toggleClass("tint",n.tint),i.toggleClass("spinner",n.spinner),s.text(r).show()}e.$rootEl.append(i),i.show(),this.overlayHash[t]=i},hide:function(e,t){var n=this.overlayHash[e];n&&(t?n.animate({opacity:"0"},500,"ease",function(){n.remove()}):n.remove()),delete this.overlayHash[e]},hideAll:function(){_.each(this.overlayHash,function(e,t){e&&(e.remove(),delete this.overlayHash[t])},this)},isActive:function(){return!_.isEmpty(e.overlay.overlayHash)}})}(SUGAR.App),function(e){e.view.ActionSheet=Backbone.View.extend({events:{"touchstart .item":"onItemTouchStart","touchmove .item":"onItemTouchMove","click .item":"onSelect","click .cancel":"onCancel"},plugins:["fast-click-highlight"],ACTIONSHEET:"actionsheet",initialize:function(t){$(window).on("orientationchange.actionsheet",_.bind(this.position,this)),e.plugins.attach(this,"view"),this.container=$("#actionsheet-overlay"),this.orientationSupport=_.isNumber(window.orientation),this.options=_.extend({title:"",template:"actionsheet",items:[],onSelect:!1,onCancel:!1,cancelText:e.lang.get("LBL_CANCEL_BUTTON_LABEL")},t),this.render(),this.show(),e.activeComponents.add(this.ACTIONSHEET,this.onCancel,this)},onItemTouchStart:function(e){this._moved=!1},onItemTouchMove:function(e){this._moved=!0},onSelect:function(e){if(this._moved)return this._moved=!1,!1;var t=parseInt(e.target.dataset.index,10),n=this.options.items[t],r=!0;this.options.onSelect&&(r=this.options.onSelect.call(this,n,t)),r!==!1&&this.remove()},onCancel:function(){this.remove(),this.options.onCancel&&this.options.onCancel.call(this)},render:function(){var t=e.template.get(this.options.template)(this.options),n=$(t);this.popup=n,this.container.empty(),this.$el.empty().append(n).appendTo(this.container),_.delay(_.bind(this.position,this),20)},show:function(){this.render(),this.container.show(),e.trigger("actionsheet:show",!0)},hide:function(){this.container.hide(),$.os.ios&&e.nomad.redraw(100),e.trigger("actionsheet:show",!1)},position:function(){var e=this.popup,t=this.orientationSupport&&_.contains([90,-90],window.orientation);e.toggleClass("compact",t);var n=document.documentElement,r=e.get(0),i=n.clientWidth,s=n.clientHeight,o=r.offsetWidth,u=r.offsetHeight,a=s-u,f=i-o,l,c;a<=0?l=0:l=a/2,f<=0?c=0:c=f/2,e.css({top:l+"px",left:c+"px"}).removeClass("invisible")},remove:function(){Backbone.View.prototype.remove.call(this),this.hide(),this.container.empty(),$(window).off("orientationchange.actionsheet"),e.activeComponents.remove(this.ACTIONSHEET)}},{show:function(t,n,r,i){return new e.view.ActionSheet({title:t,items:n,onSelect:r,onCancel:i})}})}(SUGAR.App),function(e){function i(){if(!$.os.android)return!1;var e,t=navigator.userAgent.match(/Android\s+([\d\.]+)/);return t?(e=t[1],version_compare(e,"4.1","<")&&version_compare(e,"2.4",">=")):!1}var t=$.os.android?1e3:500,n=25,r=75,s=_.extend({instance:null,scrollFixClassName:"scroll-fix",needsScrollFix:i(),show:function(t,n){if(e.config.skipTutorial)return;if(e.tutorial.data)this.doTutorial(t,n);else{var r=this;$.getJSON(e.config.tutorualURL||"tutorial.json",function(i){e.tutorial.data=i,r.doTutorial(t,n)})}},doTutorial:function(t,n){var r=this.getPrefs(),i=new RegExp("^"+t+"([~:].*)?$","i"),s=_.chain(e.tutorial.data).keys().select(function(e){return i.test(e)}).value().sort(function(e,t){return e.indexOf(":")>-1?1:-1}),o,u;_.each(s,function(e){e.indexOf("~")>-1&&!_.contains(e.split("~"),n)?o=e:e.indexOf(":")>-1&&_.contains(e.split(":"),n)?o=e:e===t&&(o=e)}),u=e.tutorial.data[o],u&&(!r.skipVersion[o]||r.skipVersion[o]<u.version)&&(!r.viewedVersion[o]||r.viewedVersion[o]<u.version)&&this.createInstance(u,o,r)},createInstance:function(t,n,r){this.instance=new o(_.extend(t,{tutorialName:n})),this.instance.show(),r.viewedVersion[n]=t.version,e.nomad.setSetting("tutorialPrefs",r)},getPrefs:function(){var t=e.nomad.getSetting("tutorialPrefs")||{};return t.viewedVersion=t.viewedVersion||{},t.skipVersion=t.skipVersion||{},t},resetPrefs:function(t){t=t||{},t.viewedVersion={},t.skipVersion={},e.nomad.setSetting("tutorialPrefs",t)},skipTutorial:function(){var t=this.getPrefs();_.each(e.tutorial.data,function(n,r){t.skipVersion[r]=e.tutorial.data[r].version}),e.nomad.setSetting("tutorialPrefs",t)},addLeftMenuScrollFix:function(){if(!this.needsScrollFix)return;$("#moduleList").addClass(this.scrollFixClassName)},removeLeftMenuScrollFix:function(){if(!this.needsScrollFix)return;$("#moduleList").removeClass(this.scrollFixClassName)}}),o=Backbone.View.extend({events:{"click .btn.disabled":function(e){return!1},"click .back-btn:not(.disabled)":"back","click .next-btn:not(.disabled)":"next","click .done-btn":"hide",swipeLeft:"onSwipeLeft"},TUTORIAL:"tutorial",initialize:function(t){t||(t={}),this.index=0,this.setIntro(t.intro),this.setContent(t.content),this.setScroll(t.scroll),this.options=t,this.tutorialName=t.tutorialName,this.tplContext={brandName:e.config.brandName},e.events.on("app:orientation:changed",this._onOrientationChange,this)},_onOrientationChange:function(){this.highlightItem(this.index)},setContent:function(e){this.content=e},setIntro:function(e){this.intro=e},setScroll:function(e){this.scroll=e},reset:function(){this.index=0},onSwipeLeft:function(t){e.tutorial.skipTutorial(),this.hide(t)},show:function(t){t=_.extend({},t||{}),t.content&&this.setContent(t.content),t.intro&&this.setIntro(t.intro),t.scroll&&this.setScroll(t.scroll),t.reset&&this.reset(),this.render(),this.intro&&!this.introShown?(this.index=-1,this.introShown=!0,this.showMessageOnly(this.intro)):this.highlightItem(this.index),e.activeComponents.add(this.TUTORIAL,this.hide,this)},hide:function(t){!_.isString(t)&&t.preventDefault(),this.remove(),e.activeComponents.remove(this.TUTORIAL)},back:function(e){e.preventDefault(),this.highlightItem(this.index-1)},next:function(e){e.preventDefault(),this.highlightItem(this.index+1)},highlightItem:function(i){var s=this;if(i<0||i>=this.content.length||this.animate)return;var o=this.content[i];if(!o.name)this.showMessageOnly(o.text);else{var u=e.additionalComponents.header.$el.find(o.name);u=u.length?u:e.controller.layout.$el.find(o.name);var a=this.index>i?-1:1;if(u.length===0||u.css("display")==="none")return i+a>=this.content.length&&this.$el.find(".next-btn").addClass("disabled"),this.highlightItem(i+a);this.highlight||(this.highlight=$("<div/>"),this.highlight.attr("id","highlight"),this.highlightText=$("<div/>"),this.highlightText.attr("id","highlight-text"),this.highlight.html(this.highlightText),$("#tutorial-content").html(this.highlight)),this.highlightText.empty().hide(),this.hideGlow();var f=$(s.scroll),l,c,h,p,d=$("#header .navbar-inner").height();this.tutorialName==="home"&&(c=e.controller.layout,h=c.getComponent("home"),l=h.scroll.scroller,p=function(e){var t=$(window).height(),n=$(e).offset(),r=t-$("#tutorial-controls").offset().top,i=[d,t];return n.top>i[0]&&n.top+n.height<i[1]-r});var v=f[0];if(s.scroll&&f.find(o.name).length>0)if(l){if(!p(u)){var m=u.offset(),g=l.getValues().top,y=g+m.top-m.height/2-d;l.scrollTo(0,y,!1)}}else{var b=v.scrollTop,w=u.offset().top-f.offset().top,E=f.offset().height+b,S=b>b+w,x=b+w>E-u.height()-r;if(S||x){var T=b+w-n;e.tutorial.addLeftMenuScrollFix(),v.scrollTop=T}}var N=u.offset().top+(o.vertAdj||0),C=u.offset().left+(o.horizAdj||0);Math.floor($("#highlight").offset().top)===Math.floor(N)&&Math.floor($("#highlight").offset().left)===Math.floor(C)?((o.glow===undefined||o.glow!==!1)&&s.showGlow(),s.showHighlightText(o.text)):(s.animate=!0,s.highlight.animate({"-webkit-transform":"translate3d("+C+"px, "+N+"px, 0)",width:o.full?u.offset().width:"",height:o.full?u.offset().height:""},t,"linear",function(){if(s.disposed)return;(o.glow===undefined||o.glow!==!1)&&s.showGlow(),s.showHighlightText(o.text),s.animate=!1}))}i<=0?this.$el.find(".back-btn").addClass("disabled"):this.$el.find(".back-btn").removeClass("disabled"),i>=this.content.length-1?this.$el.find(".next-btn").addClass("disabled"):this.$el.find(".next-btn").removeClass("disabled"),this.index=i},showGlow:function(){this.$el.find("#mask").css("background-image","-webkit-radial-gradient("+(this.highlight.offset().left+this.highlight.width()/2)+"px "+(this.highlight.offset().top+this.getTotalHeight(this.highlight)/2)+"px , "+this.highlight.width()+"px "+this.highlight.height()+"px, transparent, black "+Math.max(this.highlight.width(),this.highlight.height())+"px)"),this.$el.find("#mask").css("background-color","transparent")},hideGlow:function(){this.$el.find("#mask").css({"background-color":"","background-image":""})},showHighlightText:function(t){var n;this.highlightText.html(e.lang.get(t,null,this.tplContext)),this.highlightText.show();if(this.highlight.offset().left-this.getTotalWidth(this.highlightText)>0&&this.findIntersectors([this.highlight.offset().left-this.getTotalWidth(this.highlightText),this.highlight.offset().left],[this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2+this.getTotalHeight(this.highlightText)],".btn-group").length===0)this.highlightText.css("left",0-this.getTotalWidth(this.highlightText)),n=this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlightText.offset().top+this.highlightText.offset().height>$(window).height()-50?this.highlightText.css("top",n-40):this.highlightText.css("top",n>=0?n:0),this.highlightText.css("text-align","right");else if(this.highlight.offset().left+this.getTotalWidth(this.highlight)+this.getTotalWidth(this.highlightText)<$(window).width()&&this.findIntersectors([this.highlight.offset().left+this.getTotalWidth(this.highlight),this.highlight.offset().left+this.getTotalWidth(this.highlight)+this.getTotalWidth(this.highlightText)],[this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2+this.getTotalHeight(this.highlightText)],".btn-group").length===0)this.highlightText.css("left",this.getTotalWidth(this.highlight)),n=this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlightText.offset().top+this.highlightText.offset().height>$(window).height()-50?this.highlightText.css("top",n-40):this.highlightText.css("top",n>=0?n:0),this.highlightText.css("text-align","left");else{var r=this.getTotalWidth(this.highlight)/2-this.getTotalWidth(this.highlightText)/2,i=this.highlight.offset().left+r;r=i<0?0-this.highlight.offset().left:r;var s=this.highlight.offset().left+r+this.getTotalWidth(this.highlightText);r=s>$(window).width()?r-(s-$(window).width()):r;var o;this.highlight.offset().top+this.getTotalHeight(this.highlight)+this.getTotalHeight(this.highlightText)<$(window).height()&&this.findIntersectors([this.highlight.offset().left+r,this.highlight.offset().left+r+this.getTotalWidth(this.highlightText)],[this.highlight.offset().top+this.getTotalHeight(this.highlight),this.highlight.offset().top+this.getTotalHeight(this.highlight)+this.getTotalHeight(this.highlightText)],".btn-group").length===0?o=this.getTotalHeight(this.highlight):o=-5-this.getTotalHeight(this.highlightText),this.highlightText.offset().top+this.highlightText.offset().height>$(window).height()-50&&(o-=40),this.highlightText.css("left",r),this.highlightText.css("top",o),this.highlightText.css("text-align","center")}},findIntersectors:function(e,t,n){var r=[],i=this;return this.$el.find(n).each(function(){var n=$(this),s=n.offset(),o=[s.left,s.left+i.getTotalWidth(n)],u=[s.top,s.top+i.getTotalHeight(n)];e[0]<o[1]&&e[1]>o[0]&&t[0]<u[1]&&t[1]>u[0]&&r.push(n)}),r},showMessageOnly:function(t){$("#tutorial-content").html("<div class='text-container'><div class='text'>"+e.lang.get(t,null,this.tplContext)+"</div></div>"),this.highlight=null,this.hideGlow()},getTotalWidth:function(e){var t=e.width();return t+=parseInt(e.css("padding-left"),10)+parseInt(e.css("padding-right"),10),t+=parseInt(e.css("margin-left"),10)+parseInt(e.css("margin-right"),10),t},getTotalHeight:function(e){var t=e.height();return t+=parseInt(e.css("padding-top"),10)+parseInt(e.css("padding-bottom"),10),t+=parseInt(e.css("margin-top"),10)+parseInt(e.css("margin-bottom"),10),t},render:function(){var t=e.template.get("tutorial");return $("body").append(t()),this.$el=$("#tutorial"),this.delegateEvents(),this.$el.show(),this},remove:function(){this.disposed=!0,delete this.highlight,delete this.highlightText,Backbone.View.prototype.remove.call(this),e.events.off("app:orientation:changed",this._onOrientationChange,this),this.tutorialName==="home-menu"&&e.tutorial.removeLeftMenuScrollFix();if(this.tutorialName==="home"){var t=e.controller.layout&&e.controller.layout.getComponent("home");t&&t.scroll.scroller.scrollTo(0,0)}else this.scroll&&($(this.scroll)[0].scrollTop=0)}});e.augment("tutorial",s)}(SUGAR.App),function(e){var t=e.Controller.extend({initialize:function(){e.plugins.attach(this,"view"),e.Controller.prototype.initialize.apply(this,arguments),this.layoutHash=[],this.dataHash={},this.layout=null,e.isTouchCapable&&e.config.fastClickEnabled&&window.FastClick.attach(document.body),_.isEmpty($.os)||$(document.body).addClass($.os.android?"android":"ios")},plugins:["dynamic-layout"],_getModelFromCache:function(e,t){if(!e||!t)return;e=e.toLowerCase();var n=this.dataHash[e]||this.dataHash.mixed,r=n?n.collection:null,i=r?r.get(t):null;return!i&&n&&n.moduleCollections&&_.each(n.moduleCollections,function(n){if(n.module_list.indexOf(e)>-1){i=n.get(t);if(i)return!0}}),i},loadView:function(t,n){if(_.isEqual(t,this.context.get("params")))return!1;t.layout!=="login"?(e.nomad.fillContent(!0),_.delay(_.bind(function(){this._loadView(t,n)},this),50)):this._loadView(t,n)},_loadView:function(t,n){this.disposeAllDynamicLayouts(),n=n||Backbone.history.getHash(),t.module==="Home"&&(n="");var r=t.module||t.parentModule,i=e.metadata.getModule(r);if(!_.contains(["Home","NomadErrors","Login","About"],r)&&t.create&&!e.nomad.canCreateModule(r)){e.events.trigger("app:view:access:error",403);return}if(t.module!=="Home"&&!i)return e.alert.show("meta_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_NOT_FOUND"),autoClose:!0}),e.logger.debug("navigate home from _loadView"),e.router.navigate("home",!0),!1;this.loadLayout(t,n)},loadLayout:function(t,n){e.nomad.clearSelection(),e.activeComponents.closeAll(),t.layout==="login"&&this.clean();var r=this.layout;t.parentModelId&&t.parentModule&&(t.parentModel=this._getModelFromCache(t.parentModule,t.parentModelId)),this.context.clear({silent:!0,clearAllListeners:!1}),this.context.set(t),this.context.set("params",t),this.context.prepare();var i=this.checkIsDisableCache(t.layout,t)?null:this.getLayoutFromHash(n),s;i&&(s=i.layout,t.needLoadData=i.needLoadData);var o=!s;return s=s||e.view.createLayout({name:t.layout,module:t.module,context:this.context}),s.params=t,this.processLayout(s,r,o,!1,!1,n)},processLayout:function(t,n,r,i,s,o){this.saveScrollTop(n);var u=n&&n.params?n.params.action||(n.params.create?"create":null):null,a=t.params||{};this.trigger("controller:layout:loaded",t,n),t.context.set("model",t.model),t.context.set("collection",t.collection),this._prepareLayout(t),this.context.set("layout",t);var f=this.dataHash[(a.mixed===!0?"mixed":a.module||a.link||"").toLowerCase()],l=f?f.collection:null;a.modelId&&(l=l?l.get(a.modelId):null,l||(f=this.dataHash.mixed,f&&_.find(f.moduleCollections,function(e){if(e.module_list.indexOf(a.module)>-1)return l=e.get(a.modelId),!!l})));var c=!0,h=!a.create,p=this.context.get("parentModel");if(l)if(a.modelId){var d=null;p?d=e.data.createRelatedCollection(p,a.link,[l]):d=e.data.createBeanCollection(a.module,[l]),c=t.model!==l,l.set(_.extend(t.model.attributes,l.attributes),{silent:!0}),t.model=l,t.collection=d,_.each(t._components,function(e){e.model=l,e.collection=d}),this.context.set({model:l}),this.context.set({collection:d}),h=!e.isBackPressed}else f.cid===t.cid?(this.context.set({collection:l},{silent:!0}),c=!!this.context.get("collection").query,h=n.options.name==="associate"||u==="create"&&!e.isBackPressed||!e.isBackPressed):(c=a.action==="create"||a.action==="edit"||a.create===!0,h=a.action!=="create"&&a.create!==!0);h=h||a.needLoadData,p&&t.model.link&&(t.model.link.bean=p,t.collection.link.bean=p,_.each(t.collection.models,function(e){e.link.bean=p})),e.trigger("app:view:beforechange",t),this.layout=t,s||(!r&&!c?this.renderCachedLayout(t):t.render()),e.trigger("app:header:changed",t.getHeaderData(),a),!this.checkIsDisableCache(a.layout,a)&&!i&&(this.addLayoutToHash(t,o),!a.modelId&&a.action!=="edit"&&(this.dataHash[(a.mixed===!0?"mixed":a.module||a.link).toLowerCase()]={collection:this.context.get("collection"),moduleCollections:t.moduleCollections,cid:t.cid}));if(e.config.viewAnimation.enabled)this.animateLayout(t,n,a);else{n&&n.unbindGlobalEvents();if(t.disposed)return;this.disposeLayout(n),this.showLayout(t),e.trigger("layout:after:show",t,n)}this.layout.bindGlobalEvents();if(h){var v={};e.offlineEnabled&&(v={params:{viewed:this.context.get("action")==="edit"||this.context.get("action")==="detail"}}),!a.modelId&&n&&(n.options.name==="associate"||u==="create")&&this.context.get("collection")&&this.context.get("collection").offset<=e.config.maxPageSize&&_.extend(v,{offset:0}),this.layout.loadData(v)}return e.isBackPressed&&this.setScrollTop(t),e.isBackPressed=!1,e.trigger("app:view:change",a),this.checkAlerts(),t},renderCachedLayout:function(e){e.onBeforeRender(),_.each(e._components,function(e){_.each(e.fields,function(e){(e.cacheDisabled===!0||e.hasAccess!==e.getAccess())&&e.render()})}),e.onAfterRender()},disposeLayout:function(e,t,n){e&&(this.trigger("before:layout:dispose"),n=n||this.checkIsDisableCache(e.options.name,e.params),n&&!t?e.dispose():e.disposed||e.$el.hide(),this.trigger("after:layout:dispose"))},showLayout:function(t){t.$el.parent().length?t.$el.show():e.$contentEl.append(t.$el);if($.os.ios&&window.ScrollFix)var n=new ScrollFix(t.params.action==="edit"?t.$el.find(".scroll").get(0):t.$el.get(0));t.onAfterShow(),e.nomad.fillContent(!1),e.trigger("app:layout:show")},checkIsDisableCache:function(t,n){return!!_.find(e.config.disableLayoutCache,function(e){return t===e||n.module===e})||!e.config.layoutCacheEnabled||n.action==="create"||n.create===!0},addLayoutToHash:function(t,n){var r=_.find(this.layoutHash,function(e){return e.uid===n});if(!r){if(this.layoutHash.length>=e.config.layoutCacheSize){var i=this.layoutHash.shift().layout;delete this.dataHash[i.module.toLowerCase()],i.dispose()}this.layoutHash.push({uid:n,layout:t})}},animateLayout:function(t,n,r){var i=e.isBackPressed?t:n,s=e.isBackPressed?n:t,o=e.config.viewAnimation.rules[s.layout],u=null;if(i&&!e.isLeftMenuOpen&&!e.isRightMenuOpen){u={start:"translate3d(0, 0, 0)",end:"translate3d(0, 0, 0)"};switch(o){case"right-to-left":u.start="translate3d(100%, 0, 0)",u.end="translate3d(0, 0, 0)";break;case"bottom-to-top":u.start="translate3d(0, 100%, 0)",u.end="translate3d(0, 0, 0)";break;default:u.start="translate3d(0, 100%, 0)",u.end="translate3d(0, 0, 0)"}if(e.isBackPressed){var a=u.start;u.start=u.end,u.end=a}}var f=e.isBackPressed?n:t;!e.isBackPressed&&u&&f.$el.css({"-webkit-transform":u.start}),this.showLayout(t),u?f.$el.animate({"-webkit-transform":u.end},300,"ease-out",_.bind(function(){this.disposeAnimation(f.$el),this.disposeLayout(n)},this)):this.disposeLayout(n)},disposeAnimation:function(e){e.css({"-webkit-transform":""})},getLayoutFromHash:function(e){return _.find(this.layoutHash,function(t){return t.uid===e})},clean:function(t,n){var r=this.getRootLayout();_.each(this.dynamicLayoutHash,function(e){!t&&e!==this.layout&&e.dispose()},this),this.dynamicLayoutHash={},_.each(this.layoutHash,function(e){if(t)if(e.layout===this.layout||e.layout===this.getRootLayout())return;e.layout.dispose()},this);var i=[];_.each(this.layoutHash,function(e){e.layout.disposed||i.push(e)}),this.layoutHash=i,this.dataHash={},r&&!t&&r.dispose(),!n&&this.context.clear({silent:!0}),e.session.cutAll(),!t&&this.layout&&(this.layout.dispose(),this.layout=null)},checkAlerts:function(){var t=e.alert.getAll();_.each(t,function(t,n){t.viewCounter?t.viewCounter++:t.viewCounter=1,t.viewCounter>=t.maxViewCounter&&e.alert.dismiss(n)})},executeOnViewChange:function(t){var n=function(){t(),e.events.off("app:view:change",n)};e.events.on("app:view:change",n)},saveScrollTop:function(t){if(t){var n=this.getScrollEl(t);n&&(n instanceof e.view.NomadView?t.scrollTop=n.scroll.scroller.getValues().top:t.scrollTop=n.scrollTop)}},setScrollTop:function(t){t&&_.delay(_.bind(function(){var n=this.getScrollEl(t);n&&(n instanceof e.view.NomadView?n.scroll.scroller.scrollTo(0,t.scrollTop||0,!1):n.scrollTop=t.scrollTop),t.scrollTop=0},this),0)},getScrollEl:function(e){if(e.disposed)return;var t=null;return e.params&&(e.params.action==="edit"||e.params.create)?t=e.$el.find(".scroll").get(0):t=_.find(e._components,function(e){return!!e.scroll}),t},_prepareLayout:function(t){if(e.isBodyScrollRequired){var n=_.find(t._components,function(e){return e._bodyScroll});if(!n){$("html").removeClass("bodyScroll loginView");var r=$("#alerts");r.remove(),_.delay(function(){document.body.scrollTop=0,$("#nomad").append(r)},0)}else $("html").addClass((t.name==="login"?"loginView":"")+" bodyScroll"),_.delay(function(){document.body.scrollTop=0},0)}},onRecordCreated:function(e){_.each(this.layoutHash,function(t){t.layout.module===e&&t.layout.name==="list"&&(t.needLoadData=!0)})}});e.augment("NomadController",t,!1)}(SUGAR.App),function(e){SUGAR.App.Router.prototype.goBack=function(){e.isBackPressed=!0,e.logger.debug("Navigating back..."),Backbone.history.fragment.length===0&&e.isNative?navigator.app&&navigator.app.exitApp&&(e.logger.debug("Exiting Application"),navigator.app.exitApp()):window.history.back()},_.extend(e.nomad,{declareRoutes:function(){var t=this.customRoutes;this.routes=[{route:"",name:"home",callback:t.home},{route:"home",name:"home",callback:t.home},{route:"about",name:"about",callback:t.about},{route:"settings",name:"settings",callback:t.settings},{route:"error/:code",name:"error:code",callback:t.error},{route:"error",name:"error",callback:t.error},{route:"logout",name:"logout",callback:t.logout},{route:"offline",name:"offline",callback:t.offline},{route:"offline/TxLog",name:"TxLog",callback:t.txLogsList},{route:"offline/TxLog/:id",name:"TxLogsDetail",callback:t.txLogsDetail},{route:"offline/settings",name:"offlineSettings",callback:t.offlineSettings},{route:"offline/stats",name:"offlineStats",callback:t.offlineStats},{route:"errors",name:"errorEmulation",callback:t.errorEmulation},{route:"logout/?clear=:clear",name:"logout:clear",callback:t.logout},{route:"createCall?direction=:direction&start_date=:start_date&duration_hours=:duration_hours&duration_minutes=:duration_minutes&status=:status",name:"relationships:createCall",callback:t.createCall},{route:":module",name:"list",callback:t.list},{route:":module/create",name:"create",callback:t.create},{route:":module/:id/duplicate",name:"duplicate",callback:t.duplicate},{route:":module/:id/:action",name:"record",callback:t.record},{route:":module/:id",name:"record",callback:t.record},{route:":module/:id/link/:calls_link/createCall?direction=:direction&start_date=:start_date&duration_hours=:duration_hours&duration_minutes=:duration_minutes&status=:status",name:"record:createCall",callback:t.createRelatedCall},{route:":module/:id/link/:link",name:"relationships:list",callback:t.relatedList},{route:":module/:id/link/:link/create?depth=:depth",name:"relationships:create",callback:t.createRelated},{route:":module/:id/link/:link/associate?depth=:depth",name:"relationships:associate",callback:t.associate},{route:":module/:id/link/:link/:relatedId",name:"relationships:detail",callback:t.relatedRecord},{route:":module/:id/link/:link/:relatedId/:action",name:"relationships:action",callback:t.relatedRecord},{route:":module/:id/links/:action",name:"relationships:picker",callback:t.pickerList},{route:/Configure\/([^\/]*)\/([^\/]*)\/([^\/]*)/,name:"Configure",callback:function(){}},{route:/Configure\/([^\/]*)\/([^\/]*)/,name:"Configure",callback:function(){}}],e.routing.setRoutes(this.routes);var n=e.routing.beforeRoute;e.routing.location=window.location,e.routing.history=window.history,e.routing.beforeRoute=function(t,r){document.activeElement&&document.activeElement.blur();if(t==="about")return!0;if(t==="Configure"){var i=r[0]||e.nomad.getSetting("loginUrl"),s=r[1]||e.nomad.getSetting("loginName"),o=r[2]?decodeURIComponent(r[2]):"#";return e.nomad.configure(i,s,o),e.events.on("app:header:changed",function l(){if(!e.api.isAuthenticated())return;$("#backBtn").hide(),e.events.off("app:header:changed",l)}),!1}if(e.api.isAuthenticated()&&e.routing.firstStart){e.logger.debug("PARSING ROUTE ON STARTUP FOR DETECTING SUGAR ROUTE"),e.routing.firstStart=!1;var u=this.location.hash.replace("#","").split("~")[0];if(u){var a=e.nomad.convertSugarRoute(u);if(a!==u)return _.isString(a)?this.location.replace("#"+a):e.nomad.showBackToSugarPage(u),!1}}if(e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()){if(e.nomad.utils.canGoBack())window.history.go(-1);else{var f=e.nomad.utils.getHash();window.location.replace(f)}return!1}return n.call(this,t,r)}},convertSugarRoute:function(t){if(_.isEmpty(t))return"";if(t==="logout")return"logout";var n=_.reduce(e.nomad.routes,function(e,t){var n=t.route;return _.isString(n)&&n.indexOf(":")===-1&&e.push(n),e},[]);if(_.contains(n,t))return t;var r=t.split("/"),i=r[0],s;if(i==="bwc"){var o=r[1],u=o.split("?")[1],a=e.nomad.utils.parseQueryString(u);i=a.module;if(!i)return"";var f=a.action,l=a.record;f=f.toLowerCase(),f==="index"?s=[i]:f==="detailview"&&!_.isEmpty(l)?s=[i,l]:f==="editview"&&_.isEmpty(l)?a.parent_type&&a.parent_id?s=[a.parent_type,a.parent_id,"link",i.toLowerCase(),"create?depth=2"]:s=[i,"create"]:s=[i]}else s=r;var c=e.metadata.getModule(i),h=s.join("/"),p=s[1],d=s[2],v=s[3];if(i.toLowerCase()==="home")return"";if(i==="Configure")return h;if(c){var m=s[1]==="create";if(m)return e.nomad.canCreateModule(i)?i+"/"+"create":!1;var g=["vcard-import","create"];if(!_.isEmpty(p)&&!m){if(_.isEmpty(d)&&!_.contains(g,p))return i+"/"+p;if(_.contains(["duplicate","edit"],d)&&_.isEmpty(v))return s.join("/");if(d==="links"&&_.contains(["create","associate"],v))return h}var y=["vcard-import"];if(!_.isEmpty(p)&&_.contains(y,p))return!1;if(d==="link"){var b=s[4],w=s[5];return!_.isEmpty(v)&&_.isEmpty(b)?h:b&&_.isEmpty(w)?h:b&&_.contains(["duplicate","edit"],w)?h:!1}return i}return p==="offline"&&d==="TxLog"&&!_.isEmpty(v)?h:i==="error"&&p&&!d?h:!1},showBackToSugarPage:function(t){e.controller.loadView({module:"NomadErrors",layout:"error",create:!0,backToSugar:!0,sugarRoute:t,code:404})},customRoutes:{list:function(t){e.logger.debug("Route changed to list of "+t),e.controller.loadView({module:t,layout:"list"})},record:function(t,n,r){e.logger.debug("Route changed: "+t+"/"+n+"/"+r),r=r||"detail",e.controller.loadView({module:t,modelId:n,action:r,layout:r})},create:function(t,n){e.logger.debug("Route changed: create "+t),e.controller.loadView(_.extend({module:t,create:!0,layout:"edit"},n||{}))},associate:function(t,n,r,i){var s=e.data.getRelatedModule(t,r);e.logger.debug("Route changed to associate rels: "+t+"/"+n+"/"+r+"/"+s),e.controller.loadView({module:s,layout:"associate",viaLink:r,toModule:t,toId:n,parentModule:t,parentModelId:n,depth:i})},txLogsList:function(){e.controller.loadView({module:"TxLog",layout:"list"})},txLogsDetail:function(t){e.controller.loadView({module:"TxLog",modelId:t,layout:"detail"})},relatedList:function(t,n,r){e.logger.debug("Route changed to list rels: "+t+"/"+n+"/"+r),e.controller.loadView({parentModule:t,parentModelId:n,link:r,layout:"relationships"})},pickerList:function(t,n,r){e.logger.debug("Route changed to list rels: "+t+"/"+n+"/link/picker/"+r),e.controller.loadView({parentModelId:n,parentModule:t,layout:"pickerlist",action:r})},createRelated:function(t,n,r,i,s){e.logger.debug("Route changed to create rel: "+t+"/"+n+"/"+r+"/create"),e.controller.loadView(_.extend({module:e.data.getRelatedModule(t,r),parentModule:t,parentModelId:n,link:r,create:!0,layout:"edit",action:"create",depth:i},s||{}))},relatedRecord:function(t,n,r,i,s){e.logger.debug("Route changed to action rel: "+t+"/"+n+"/"+r+"/"+i);if(s==="duplicate"){e.nomad.customRoutes._duplicateAction(t,n,r,i);return}s=s||"detail",e.controller.loadView({parentModule:t,parentModelId:n,link:r,modelId:i,action:s,layout:s})},home:function(){e.controller.loadView({mixed:!0,module:"Home",layout:"home"})},about:function(){e.controller.loadView({module:"About",layout:"about",create:!0})},logout:function(t){e.activeComponents.closeAll(),e.overlay.show("logout",{spinner:!0,tint:!0,label:"LBL_MOBILE_WAIT"}),e.router.logout(t)},settings:function(){e.controller.loadView({module:"Settings",layout:"settings",create:!0})},error:function(t){e.controller.loadView({module:"NomadErrors",layout:"error",create:!0,code:t})},offline:function(){e.controller.loadView({module:"Offline",layout:"offline",create:!0})},offlineSettings:function(){e.controller.loadView({module:"Offline",layout:"offlineSettings",create:!0})},offlineStats:function(){e.controller.loadView({module:"Offline",layout:"offlineStats",create:!0})},errorEmulation:function(){e.controller.loadView({module:"ErrorEmulation",layout:"errorEmulation",create:!0})},duplicate:function(t,n){e.nomad.customRoutes._duplicateAction(t,n)},_duplicateAction:function(t,n,r,i){var s=e.controller.context.get("model");e.controller.executeOnViewChange(function(){var o=e.controller.context.get("model");e.controller.context.set("dupe",!0);if(!s)if(r){var u=e.data.createBean(t,{id:n});s=e.data.createRelatedBean(u,i,r)}else s=e.data.createBean(t,{id:n});s.fetch({relate:!!r,complete:function(){o.copy(s)}})}),r?this.createRelated(t,n,r,undefined,{dupe:!0}):this.create(t,{dupe:!0})},createCall:function(t,n,r,i,s){e.router.create("Calls"),e.nomad.customRoutes._createCall(_.toArray(arguments))},createRelatedCall:function(t,n,r,i,s,o,u,a){e.nomad.customRoutes.createRelated(t,n,r),e.nomad.customRoutes._createCall(_.toArray(arguments).slice(3))},_createCall:function(t){e.controller.executeOnViewChange(function(){var n=e.controller.context.get("model"),r=t[3],i=t[2];r=e.nomad.utils.minutesToQuarterHours(r),r===60&&(i+=1,r=0),n.set({direction:t[0],date_start:t[1],duration_hours:String(i),duration_minutes:String(r),status:t[4]})})}}})}(SUGAR.App),function(e){function o(){if(!e.offline.isUp()){e.nomad.showAlert(e.lang.get("ERR_OFFLINE_START_FAILED_OUT_OF_SPACE"));return}var t=new Date-0;if(t-s<e.config.offline.cleanupConfirmationInterval)return;s=t,e.nomad.showConfirm(e.lang.getAppString("ERR_OFFLINE_CLEAN_UP_CONFIRMATION"),function(t){var n="db_cleanup";e.nomad.dismissAlerts(),t===2&&(e.overlay.show(n),e.alert.show(n,{level:"info",messages:e.lang.getAppString("LBL_OFFLINE_DB_CLEANING_IN_PROGRESS"),autoClose:!1,closable:!1}),e.offline.compactStorage({callback:function(t){e.router.navigate("home",!0),e.overlay.hide(n),e.alert.dismiss(n),t?e.alert.show(n,{level:"error",messages:e.lang.getAppString("ERR_OFFLINE_DB_CLEANING_ERROR"),autoClose:!0,closable:!0}):e.alert.show(n,{level:"success",messages:e.lang.getAppString("LBL_OFFLINE_DB_CLEANING_COMPLETED"),autoClose:!0,closable:!0})}}))})}var t=window.nomadAppEventHandlerContext={},n=[],r,i=function(e){var t=_.pluck(n,"module"),r=_.indexOf(t,e.module);r!==-1?n[r]=e:n.unshift(e)},s=0;e.events.on("all",function(t){var n=[],r=arguments;_.each(e.events._events,function(e,r){var i=r.split(".");i.length>1&&i[0]===t&&n.push(r)}),n.length>0&&_.each(n,function(t){r[0]=t,e.events.trigger.apply(e.events,r)})}),e.events.on("app:init",function(){window.clearInterval(e.metadata._validateMDInterval),e.metadata._validateMDInterval=null,e.routing.emulateBackButton=!e.isNative&&e.config.emulateBackButton,e.routing.emulateBackButton&&e.activeComponents.enableBackButtonHandling();var t=!window.store.enabled&&$.os.ios&&$.browser.webkit,n=$.os.ios&&$.browser.chromeMobile;e.routing.buggyLocationReplace=t||n,e.routing.firstStart=!0,e.isBodyScrollRequired=$.os.android||$.os.ios&&$.os.version[0]==="7",_.extend(e.metadata.fieldTypeMap,{iframe:"url",link:"url",multienum:"multienum",name:"name","double":"float"}),_.extend(e.view.NomadField.prototype.viewFallbackMap,{view:"readonly",edit:"readonly",about:"readonly",settings:"edit"}),e.serverInfo=e.metadata.getServerInfo(),e.nomad.resetMeta(!1,!1),e.nomad.restoreUser(),e.nomad.enableOffline(),e.nomad.initSubpanels(),e.data.declareModels(),e.nomad.declareRoutes(),e.nomad.updateAuthStore(),e.isSynced&&e.nomad.initializeContextMeta();if(e.isNative){var r=e.nomad.getSetting("serverUrl"),i=e.nomad.getSetting("siteUrl");r&&(r=r.replace(/\/rest\/v10/,""),e.nomad.removeSetting("serverUrl")),e.config.siteUrl=i||r||"http://localhost:8888",e.api.serverUrl=e.nomad.getServerUrl(),i||e.nomad.setSetting("siteUrl",e.config.siteUrl)}e.logger.debug("Site URL: "+e.config.siteUrl),e.isNative&&navigator.splashscreen&&_.delay(function(){navigator.splashscreen.hide()},500)},t).on("app:sync",function(){e.nomad._isSyncing=!0,r=e.metadata.getHash(),e.overlay.show("app:sync",{template:"preloader-panel",label:"LBL_LOADING"})},t).on("app:sync:complete",function(){e.nomad._isSyncing=!1,e.nomad._hasAskedForSync=!1,e.logger.debug("Sync complete"),e.serverInfo=e.metadata.getServerInfo(),e.hacks.hackModuleList(),e.nomad.initSubpanels(),e.hacks.hackAcls(),e.nomad.saveUser(),e.nomad.initializeContextMeta(),e.nomad.updateAuthStore(),e.analytics.init(),_.delay(function(){e.overlay.hide("app:sync",!0)},300),e.cache.set("app:synced","1");var t=r!==e.metadata.getHash();e.offlineEnabled&&e.config.offline.prefetch.enabled&&(t||e.offline.storage.getMigrationSummary().storageRebuilt)&&(e.logger.debug("Prefetching static modules"),e.offline.syncManager.recordsPreloader.start({callback:function(){e.nomad.promptAndPreloadUserRecords(!0)}}))},t).on("app:sync:error",function(t){e.nomad._isSyncing=!1,e.nomad._hasAskedForSync=!1,e.logger.debug("Sync failed");if(t instanceof SUGAR.Api.HttpError)t.code!=="invalid_grant"?e.nomad.showConfirm(e.lang.getAppString("LBL_MOBILE_META_SYNC_FAILED_RETRY"),function(t){e.nomad.dismissAlerts(),t!==2?(e.overlay.hide("app:sync",!0),e.router.login()):e.sync()},e.lang.getAppString("ERR_GENERIC_TITLE"),e.lang.getAppString("LBL_MOBILE_RELOGIN_BUTTON")+","+e.lang.getAppString("LBL_YES")):(e.overlay.hide("app:sync"),e.error.handleInvalidGrantError());else{var n=_.extend({version:"N/A",flavor:"N/A",minVersion:e.config.minServerVersion,supportedFlavors:e.config.supportedServerFlavors.join(", ")},t.server_info);t=e.lang.get(t.label,null,n)||(_.isString(t)?t:e.lang.getAppString("LBL_MOBILE_META_SYNC_FAILED")),e.nomad.showAlert(t,function(){e.nomad.dismissAlerts(),e.overlay.hide("app:sync",!0),e.router.login()},e.lang.getAppString("ERR_GENERIC_TITLE"))}},t).on("offline:prefetch:start",function(){n=[],e.overlay.show("offline:prefetch",{template:"preloader-panel",label:"LBL_OFFLINE_PREFETCHING"})},t).on("offline:prefetch:complete",function(t){n=[],t&&e.nomad.showAlert(e.lang.getAppString("ERR_OFFLINE_PREFETCH_FAILED")),_.delay(function(){e.overlay.hide("offline:prefetch",!0)},300)},t).on("offline:prefetch:progress",function(t){var r=e.config.maxPreloaderPanelMessages||4,s=[];i(t),_.each(n,function(t,n){if(n+1>r)return!1;t=_.extend({},t,{module:e.nomad.getPluralModuleName(t.module)}),n===0?(t.estimatedTime,s.push("<span class='current'>"+e.lang.get("LBL_OFFLINE_PREFETCHING_MODULE",null,t)+"</span>")):s.push("<span class='completed'>"+e.lang.get("LBL_OFFLINE_PREFETCHING_MODULE_COMPLETE",null,t)+"</span>")}),e.overlay.hide("offline:prefetch"),e.overlay.show("offline:prefetch",{template:"preloader-panel",message:s.join("<br />")})},t).on("data:sync:start",function(t,n,r){if(!!r.disableGlobalDataAlerts)return;var i;if(t==="read"){if(e.offlineEnabled)return;_.isUndefined(r.offset)&&(i=e.lang.getAppString("LBL_LOADING"))}else t==="delete"?i=r.relate?e.lang.getAppString("LBL_UNLINKING"):e.lang.getAppString("LBL_DELETING"):i=e.lang.getAppString("LBL_SAVING");e.nomad.showDataSyncStartAlert(i)},t).on("data:sync:success",function(t,n,r,i){if(t==="read"){var s=n.get("_acl");if(s){var o=s?s.fields:null,u=n._acl_previous||{};n._acl_previous=o,o=_.extend(u,o),e.trigger("acl:change",o)}}if(!!r.disableGlobalDataAlerts)return;var a;t==="delete"?a=r.relate?e.lang.getAppString("LBL_UNLINKED"):e.lang.getAppString("LBL_DELETED"):t!=="read"&&(a=e.lang.getAppString("LBL_SAVED")),e.nomad.showDataSyncEndAlert(a,null,t)},t).on("data:sync:error",function(t,n,r,i){if(!!r.disableGlobalDataAlerts)return;e.nomad.showDataSyncEndAlert(null,i,t)},t).on("app:view:access:error",function(t){e.controller.loadView({module:"NomadErrors",layout:"error",create:!0,code:t})},t).on("app:login:success",function(){e.nomad.resetUser(),e.nomad.enableOffline(!0)},t).on("app:logout",function(){e.alert.dismiss("logout"),e.nomad.resetMeta(!1,!0),e.data.declareModels()},t).on("app:view:change",function(t){_.defer(function(){e.tutorial.show(t.layout,t.module)})},t).on("bean:save",function(t){t.action==="create"&&e.controller.onRecordCreated(t.module)},t).on("app:start",function(){},t).on("offline:data:updated",function(t){t.action==="delete"&&e.controller.clean(!0,!0)},t).on("offline:failure",function(t){t===e.offline.Error.StorageUnavailableError&&e.nomad.showAlert(t.localizedMessage()+"\n"+e.lang.get("LBL_OFFLINE_DISABLED")),t!==e.offline.Error.OfflineDisabledError&&(t===e.offline.Error.OutOfSpaceError?o():e.alert.show("offline_error",{level:"error",messages:t.localizedMessage(),autoClose:!0}))},t)}(SUGAR.App),function(e){var t=1048576,n=function(e,t,n){e[t]||(e[t]=[]),e[t].push(n)},r=function(e,t,n){e[t]=n},i={byType:{name:{dataName:"nameField",action:r},fullname:{dataName:"fullNameField",action:r},image:{dataName:"imageField",action:function(e,t,n){e.docFields[n.name]=n,e[t]||r(e,t,n)}},phone:{dataName:"phoneFields",action:n},url:{dataName:"urlFields",action:n},email:{ignore:!1,dataName:"emailFields",action:n},file:{dataName:"docFields",action:function(e,t,n){e.docFields[n.name]=n}},fieldset:{action:function(e,t,r){var s=!0;_.each(r.fields,function(t){var n=i.byType[t.type];n&&(n.action(e,n.dataName,r),s=!1)}),s&&n(e,"otherFields",r)}},emailbody:{dataName:"emailbodyFields",action:n}},byNameRegEx:{"^(?=.*address)((?!email).)*$":{dataName:"addressFields",action:n}},"default":{dataName:"otherFields",action:n}},s=function(e){var t=null;return _.each(i.byNameRegEx,function(n,r){var i=new RegExp(r);i.test(e.name)&&(t=n)}),t},o=e.data.beanModel;e.NomadBean=e.data.beanModel.extend({initialize:function(){this.addValidationTask("nomadValidation",_.bind(this._nomadValidator,this)),o.prototype.initialize.apply(this,arguments)},_nomadValidator:function(t,n,r){var i=e.metadata.getModule(this.module).fields;_.each(t,function(e,t){var r=i[t];r&&r.type==="image"&&this._imageRequiredValidator(r,t,this)&&(n[t]=n[t]||{},n[t].required=!0)},this),r(null,t,n)},_imageRequiredValidator:function(t,n,r){if(!e.supportedFeatures.fileUpload)return;var i=!1;return t.required&&(i=_.isEmpty(r.get(n))),i},getContextMetaData:function(t,n){n=n||{};var r=n.fieldsNumber||0,o=i,u=this,a={},f=n.contextData||{otherFields:n.otherFields||[],phoneFields:[],urlFields:[],emailFields:[],addressFields:[],displayListFields:[],docFields:{},emailbodyFields:[]};_.each(t,function(t,n){var i=o.byType[t.type]||s(t)||(f[o["default"].dataName].length<r?o["default"]:null);i&&!i.ignore&&i.action(f,i.dataName,t),n>0&&n<=e.config.numberOfAdditionalListFields&&f.displayListFields.push(t)}),f.headerField=f.fullNameField||f.nameField,f.subpanels=e.nomad.getSubpanels(this.module),f.hasLinkableSubpanels=e.nomad.hasLinkableSubpanels(f.subpanels),f.hasCreatableSubpanels=e.nomad.hasCreatableSubpanels(f.subpanels);var l=_.find(t,function(e){return e.type==="image"&&e.name==="picture"&&_.contains(["Contacts","Leads","Employees","Users"],u.module)});l&&(f.imageField=l,f.showIcon=!0),f.addressFieldsGroups=_.groupBy(f.addressFields,function(e){return e.type==="address"?e.name:u.fields[e.name].group}),f.actions=a,f.phoneFields.length&&(a.phone={cssClass:"phone",iconCssClass:"icon-phone",action:"phone"},a.message={cssClass:"message sms",iconCssClass:"icon-comment",action:"sms"}),f.emailFields.length&&(a.email={cssClass:"email",iconCssClass:"icon-envelope",action:"email"}),f.urlFields.length&&(a.url={cssClass:"link",iconCssClass:"icon-external-link",action:"url"}),_.keys(f.addressFieldsGroups).length&&(a.map={cssClass:"map",iconCssClass:"icon-map-marker",action:"map"});if(this._canHaveFiles(f.docFields)||this._canHavePDFs()||this.canHaveAttachments())a.doc={cssClass:"doc",iconCssClass:"icon-file",action:"doc"};return f.emailbodyFields.length&&(a.emailbody={cssClass:"emailbody",iconCssClass:"icon-font",action:"emailbody"}),a.available=_.any(a),f},getAddresses:function(t){var n,r,i,s=this;return _.chain(t).map(function(t,o){o.lastIndexOf("_c")===o.length-2&&(o=o.replace("_c","")),i={},_.each(t,function(t,r){var u=s.get(t.name);if(u){n=t.name,n=n.replace(o+"_",""),n.lastIndexOf("_c")===n.length-2&&(n=n.replace("_c",""));if(t.type==="enum"){var a=e.metadata.getModule(s.module).fields[t.name],f=e.lang.getAppListStrings(a.options)||{};u=f[u]||u}i[n]=u}});if(_.keys(i).length){r={};var u=e.lang.get("LBL_"+o.toUpperCase(),s.module);return r[u]=i,r}}).compact().value()},getDocuments:function(t){var n=this;this.docsLoading=!0,t=_.filter(t,function(t){return e.acl.hasAccessToModel("read",this,t.name)},this);if(this.canHaveAttachments()){var r=this.get("attachment_list");this._createDocData(r,t)}else if(this._canHaveFiles(t)){var i=[],s=this.get("doc_url");if(_.has(this.fields,"doc_url")&&!_.isEmpty(s)){var o=this.get("filename");_.has(this.fields,"doc_type")&&(o+=" ("+this.get("doc_type")+")"),i=this._createDocData([{name:o,uri:s,openExternally:!0,nonSugarURL:!0}],t,null,{silent:!0})}this.getFiles({success:function(e){n._createDocData(e,t,i)},error:function(t){e.logger.debug("Error creating file url for "+n.module+" : "+t),n.docsLoading=!1,n.trigger("docs:ready",i)}},{iframe:!1})}else this._canHavePDFs()?this._createDocData([{name:this.module+".pdf",uri:e.api.serverUrl+"/"+this.module+"/"+this.id+"/pdf",file_mime_type:"application/pdf",filename:this.get("name")+".pdf",oauth:!0}],t):(this.docsLoading=!1,this.trigger("docs:ready",[]))},_createDocData:function(n,r,i,s){var o=this;return this.docsLoading=!1,s=s||{},i=i||[],_.each(n,function(n,s){var u,a,f,l,c=n.uri||n.file_uri,h=n["content-length"],p=n.name||n.document_revision_filename;if(!c||!e.acl.hasAccessToModel("read",this,s))return;a=_.find(r,function(e){return e.name===s}),f=a?e.lang.get(a.label,o.module):p,p&&h&&(f+=" ("+o._fileSizeFormat(n["content-length"])+")",h>t&&(n.openExternally=!0)),p&&!n.nonSugarURL&&(l=c.split(/rest\/v\d*\//)[1],c=e.api.serverUrl+"/"+l+"?platform="+e.config.platform,e.nomad.isDownloadTokenSupported()?n.oauth||(c+="&download_token="+e.api.getDownloadToken()):c+="&oauth_token="+e.api.getOAuthToken()),u={},u[f]={url:c,openExternally:n.openExternally||!1,isImage:a&&a.type==="image",file_mime_type:n.file_mime_type||this.get("file_mime_type")||n["content-type"]||"",filename:n.filename||this.get("filename")||n.name||"",oauth:n.oauth},i.push(u)},this),s.silent||this.trigger("docs:ready",i),i},_fileSizeFormat:function(t){return t<=0?"0":""+e.nomad.utils.humanFileSize(t)},_canHaveFiles:function(t){var n=e.config.modulesWithFiles||[];return!_.isEmpty(t)||_.contains(n,this.module)||_.has(this.fields,"doc_url")},_canHavePDFs:function(){var t=e.config.modulesWithPDFs||[];return _.contains(t,this.module)},getFieldsDataArray:function(t,n){var r,i,s,o,u=[],a=this,f,l;return _.each(t,function(t){o={},i=a.get(t.name),l=t.name,s=e.metadata.getModule(a.module).fields[l],i&&(_.isUndefined(n)||i.match(n))&&(f=t.label||s.label||s.vname||l,r=e.lang.get(f,a.module),o[r]=i,u.push(o))}),u},isDataDefined:function(e,t){return _.any(e,function(e){var n=this.get(e.name);return t?_.isString(n)&&n.match(t):n},this)},hasPrimaryEmail:function(t){return _.any(t,function(t){var n=this.get(t.name),r=e.nomad.utils.getPrimaryEmail(n,!0);return!_.isEmpty(r)},this)},hasActiveEmail:function(e){return _.any(e,function(e){return _.any(this.get(e.name),function(e){return!Number(e.invalid_email)&&!Number(e.opt_out)})},this)},hasDeleteAccess:function(){if(e.acl.hasAccessToModel("delete",this)&&!_.contains(e.config.nonDeletableModules,this.module))return!e.serverInfo.isSevenUp||!this.get("closed_revenue_line_items")&&!_.find(e.config.nonDeletableSalesStages,function(e){return e===this.get("sales_status")||e===this.get("sales_stage")},this)},hasUnlinkAccess:function(t,n){return n.relationship_type==="many-to-many"?!0:_.isEmpty(t)?n.via_parent_id?e.acl.hasAccessToModel("edit",this,n.relationship_role_column):!0:!_.find(t,function(t){return!e.acl.hasAccessToModel("edit",this,t.name)},this)},changeCurrencyId:function(t,n){n=n||{};var r=this.get("currency_id")||t,i={},s=n.silentField||{};_.each(this.fields,function(n,s){if(n.type!=="currency")return;var o=this.get(s);if(!!o){var u=e.currency.convertAmount(o,r,t);this.set(s,u,{silent:!0})}i[s]=!0},this),this.set("currency_id",t,{silent:!0}),n.silent||_.each(i,function(e,t){if(s===t)return!1;this.trigger("change:"+t)},this)},getChangeDiff:function(e,t){var n={};return e=e||{},t=t||[],_.each(this.attributes,function(r,i){if(_.contains(t,i))return;var s=e[i];_.isEqual(s,r)||(n[i]=s)}),n},save:function(t,n){n=n||{},n.lastModified=this.get("date_modified");var r=n.success,i={module:this.module,action:this.isNew()?"create":"update"};return n.success=function(){e.events.trigger("bean:save",i),r&&r.apply(this,arguments)},o.prototype.save.call(this,t,n)},uploadFile:function(t,n,r,i){r=r||{},i=i||{},i.iframe=!1;var s=this;return e.api.file("create",{id:this.id,module:this.module,field:t},n,{success:function(e,n,i){var o=e[t];if(o)s.set(t,e[t].name),r.success&&r.success(e);else{var u=new SUGAR.Api.HttpError({xhr:i});u.responseText=e.xhr?e.xhr.message:u.responseText,r.error&&r.error(u)}},error:function(e){e.isFileUploadError=!0,r.error.call(this,e)}},i)}}),e.data.beanModel=e.NomadBean}(SUGAR.App),function(e){function n(){e.router.login()}var t={INTERNET_UNAVAILABLE:-1,CONNECTION_FAILED:-2,CONNECTION_TIMEOUT:-3,INVALID_CREDENTIALS:-4},r=e.error.handleStatusCodesFallback,i=e.error.enableOnError,s=e.error.handleUnhandledError;e.error=_.extend(e.error,{enableOnError:function(){return e.config.raven&&e.config.raven.enabled?!0:i.apply(this,arguments)},_alertUnauthorized:function(){e.alert.show("auth_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_NOT_AUTHORIZED"),autoClose:!0})},_alertSystemError:function(t){var n;t instanceof e.offline.Error?n=t.localizedMessage():n=e.lang.getAppString("ERR_MOBILE_INTERNAL").replace("{{{code}}}",t.status||"N/A"),e.alert.show("system_error",{level:"error",messages:n,autoClose:!0,uid:"ERR_MOBILE_INTERNAL",pageHash:t.request?t.request.params.pageHash:null})},handleNeedLoginError:function(){e.alert.show("auth_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_INVALID_CREDS"),autoClose:!0}),n(),this._sendAnalytics(t.INVALID_CREDENTIALS)},handleInvalidGrantError:function(){e.alert.show("auth_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_SESSION_EXPIRED"),autoClose:!0}),n()},handleUnhandledError:function(t,n,r){try{this.logFatalError(t,{url:n,line:r,version:e.nomad.getVersion(),serverVersion:e.nomad.getServerVersion(),serverUrl:e.nomad.getServerUrl(),clientInfo:e.clientInfo})}catch(i){}},logFatalError:function(t,n){try{var r=e.config.env==="prod";t=t||"Unknown error",e.logger.fatal(JSON.stringify(n)),t=r?e.lang.getAppString("ERR_INTERNAL_ERR_MSG"):"FATAL: "+t,e.alert.show("system_error",{level:"error",messages:t,autoClose:!0}),e.analytics.trackEvent("device","exception")}catch(i){}},handleUnauthorizedError:function(){this._alertUnauthorized(),n()},handleForbiddenError:function(e){this._alertUnauthorized(),this._sendAnalytics(e.status)},handleNotFoundError:function(t){e.alert.show("not_found_error",{level:"error",messages:this._adjustErrorMessage("ERR_MOBILE_NOT_FOUND",t),autoClose:!0}),this._sendAnalytics(t.status)},handleTimeoutError:function(n){e.alert.show("system_error",{level:"error",messages:this._adjustErrorMessage("ERR_MOBILE_TIMEOUT",n),autoClose:!0,uid:"ERR_MOBILE_TIMEOUT",pageHash:n.request.params.pageHash}),this._sendAnalytics(t.CONNECTION_TIMEOUT)},handleMethodConflictError:function(t){this._sendAnalytics(t.status);if(e.controller.context.get("action")!=="edit")return;var n=e.controller.context.get("layout")._components[0];e.nomad.showConfirm(e.lang.getAppString("ERR_MOBILE_CONFLICT"),function(r){var i={},s=n.model,o=t.payload.record;r===2?(_.each(n._getChangedFields(),function(e){i[e]=s.get(e)}),n.backupModel(o),o=e.data.beanModel.merge(o,i,n.module)):n.backupModel(o),s.set(o)})},handleStatusCodesFallback:function(i){var s,o=i.status;e.alert.dismissAll();if(_.isUndefined(i.status)){i===e.offline.Error.OutOfSpaceError&&e.alert.show("offline_error",{level:"error",messages:i.localizedMessage(),autoClose:!0});return}if(i.status!="0"||i.textStatus!=="error"&&i.textStatus!=="abort"||!_.isEmpty(i.errorThrown))if(i.status=="412"){if(e.nomad._isSyncing||e.nomad._hasAskedForSync)return;e.nomad._hasAskedForSync=!0,e.nomad.showConfirm(e.lang.getAppString("ERR_MOBILE_METADATA_CHANGED_RELOAD"),function(t){e.nomad.dismissAlerts(),t===2?(document.activeElement&&document.activeElement.blur(),e.controller.clean(),e.sync()):(e.nomad._hasAskedForSync=!1,e.alert.show("meta_error",{level:"error",messages:e.lang.getAppString("ERR_MOBILE_METADATA_CHANGED"),autoClose:!0}))})}else i.status=="433"?e.nomad.showConfirm(e.lang.get("ERR_MOBILE_INCOMPATIBLE_CLIENT_VERSION",null,{brandName:e.config.brandName}),function(t){e.nomad.dismissAlerts(),t===2&&e.nomad.openAppStore(),n()}):(this._alertSystemError(i),i.status=="400"&&n());else{var u;e.nomad.isOnline()?(u=this._adjustErrorMessage("ERR_MOBILE_CONNECTION_FAILED",i),s="Server is unreachable. "+(navigator.connection?"Connection: "+navigator.connection.type:""),o=t.CONNECTION_FAILED):(u=e.lang.getAppString("ERR_MOBILE_INTERNET_UNAVAILABLE"),s="Device is offline",o=t.INTERNET_UNAVAILABLE),e.alert.show("network_error",{level:"error",messages:u,autoClose:!0,uid:"ERR_MOBILE_CONNECTION_FAILED",pageHash:i.request.params.pageHash})}var a=!_.contains([0,433,412],i.status);if(a||!a&&e.logger.levels[e.config.logLevel].value<=e.logger.levels.DEBUG.value)s&&e.logger.error(s),r(i),this._logRequestUrl(i);this._sendAnalytics(o)},handleNotSupportedPlatform:function(){window.location.replace("error-not-supported-platform.html?desktop_url="+e.nomad.getDesktopUrl())},_sendAnalytics:function(t){t=t||"unknown",e.analytics.trackEvent("api-error",t)},_adjustErrorMessage:function(t,n){var r=n&&n.request&&n.request.params?e.api.isLoginRequest(n.request.params.url):!1;return r&&(t+="_LOGIN"),e.lang.get(t,null,{brandName:e.config.brandName,minVersion:e.config.minServerVersion,supportedFlavors:e.config.supportedServerFlavors.join(", ")})},_logRequestUrl:function(t){t.request&&t.request.params&&t.request.params.url&&e.logger.error("URL of failed request: "+t.request.params.url)}})}(SUGAR.App),function(e){var t={DIMENSIONS:{offline_mode:1,connection:2},METRICS:{},initialized:!1,trackEventSplitter:/^(.*):([\-\w]+)\.?(\S+)?$/,eventSplitter:/\s{2,}/,currentViewId:"",loginProcessed:!0,init:function(){e.config.analytics.enabled&&e.nomad.loadAnalytics();if(e.config.analytics.enabled&&typeof Analytics!="undefined"&&Analytics){if(this.initialized)return;this.initialize();var t=e.config.analytics.id;t=_.isObject(t)?e.isNative?t["native"]:t.web:t,analytics.start(t,e.config.analytics),e.logger.debug("Analytics enabled - "+t)}else e.events.off(null,null,this),this.initialized=!1,e.logger.debug("Analytics disabled")},initialize:function(){e.events.on("app:view:change",function(t){var n=t.module||t.parentModule||e.controller.context.get("module"),r=t.layout+(n?"/"+n:"")+(t.track?"/"+t.track:"");t.link&&(r+="/"+t.link),t.dupe?r+="/duplicate":t.create&&(r+="/create"),t.layout==="associate"&&(r+="/"+t.parentModule+"/"+t.viaLink),e.analytics.currentViewId=r,e.analytics.trackPageView(e.analytics.currentViewId)},this).on("app:login:success",function(){_.isEmpty(e.serverInfo.version)?e.analytics.loginProcessed=!1:(e.analytics.trackEvent("login",e.serverInfo.version),e.analytics.loginProcessed=!0)},this).on("app:sync:complete",function(){e.analytics.loginProcessed||(e.analytics.trackEvent("login",e.serverInfo.version),e.analytics.loginProcessed=!0)},this).on("app:logout",function(){e.analytics.loginProcessed=!1},this).on("offline:enabled",function(t){e.analytics.setDimension(e.analytics.DIMENSIONS.offline_mode,t?"enabled":"disabled")},this).on("offline:failure",function(t){e.analytics.trackEvent("offline-failure",t.code)},this).on("offline:tx:create",function(t){e.analytics.trackEvent("tx-create",e.offline.utils.actionToSymbol(t.txOptions))},this).on("offline:tx:success",function(t){e.analytics.trackEvent("tx-success",e.offline.utils.actionToSymbol(t.tx),e.offline.utils.getTxAge(t.tx))},this).on("offline:tx:error",function(t){e.analytics.trackEvent("tx-error",t.errorCode||"unknown",e.offline.utils.getTxAge(t.tx),e.offline.utils.actionToSymbol(t.tx))},this).on("offline:tx:rollback",function(t){e.analytics.trackEvent("tx-rollback",e.offline.utils.actionToSymbol(t.tx),e.offline.utils.getTxAge(t.tx))},this).on("offline:wins:completed",function(t){e.analytics.trackEvent("offline:wins","synced",t.syncedRecords,"numRecords")},this),this.initialized=!0},trackPageView:function(t){if(!this.initialized)return;e.logger.debug("GAN-page: "+t),e.offlineEnabled&&this.setDimension(this.DIMENSIONS.connection,e.offline.status.noConnection?"offline":"online"),analytics.trackPageView(t)},trackEvent:function(t,n,r,i){if(!this.initialized)return;n=""+(n||"[unknown]"),i=""+(i||this.currentViewId),e.logger.debug("GAN-event: "+t+":"+n+"("+r+")"+" for "+i),analytics.trackEvent({category:t,action:n,label:i,value:r})},startSession:function(){if(!this.initialized)return;analytics.startSession()},setDimension:function(e,t){if(!this.initialized)return;analytics.setDimension({index:e,value:t})},setMetric:function(e,t){if(!this.initialized)return;analytics.setMetric({index:e,value:t})},detachAnalytics:function(e){var t=this.getTrackableElements(e);t.unbind(".analytics")},attachAnalytics:function(e){var t=this,n=this.getTrackableElements(e);n.unbind(".analytics"),n.each(function(e,n){t._attachAnalytics(n)})},getTrackableElements:function(e){var t=this._getTrackableElements(e);return e.attr("track")&&(t=t.add(e)),t},_getTrackableElements:function(e){return $("[track]",e)},_attachAnalytics:function(e){var t=$(e),n=(t.attr("track")||"").trim();if(n==="")return;var r=n.match(this.trackEventSplitter),i=(r[1]||"").trim(),s=r[2],o=r[3]||"",u=i.replace(this.eventSplitter," ").split(" ");u=_.map(u,function(e){return e+".analytics"}),i=u.join(" "),this._attachEvents(i,s,o,t)},_attachEvents:function(t,n,r,i){t&&(i.off(t),i.on(t,function(t){n=n||t.currentTarget.id,e.analytics.trackEvent(t.type,n,r&&$(this).hasClass(r)?1:0)}))}};e.augment("analytics",t,!1)}(SUGAR.App),function(e){var t={CALL_STATE:{IDLE:"IDLE",DIALING:"DIALING"},_callModule:"Calls",getCallLog:function(){return e.nomad.getSetting("callLog")},setCallLog:function(t){e.nomad.setSetting("callLog",t)},clearCallLog:function(){e.nomad.removeSetting("callLog")},callPhone:function(t,n){var r={phone:t,module:n.module,recordId:n.id,recordName:n.get("name")};this.setCallLog(r),e.isNative||this.bindCallEnd(),e.logger.debug("Initiating a phone call to "+t),e.nomad._callPhone(t)},callStateChanged:function(t){t=JSON.parse(t);if(t.length===0)return;e.logger.debug("Call state changed: "+t.length);var n=t[0];e.logger.debug("First call: "+n.id+":"+n.state);var r=this.getCallLog();r&&(n.state===this.CALL_STATE.DIALING?(r.state=n.state,r.direction="Outbound",r.startedOn=(new Date).getTime(),r.started=!0,this.setCallLog(r)):n.state===this.CALL_STATE.IDLE&&(r.state=n.state,r.endedOn=(new Date).getTime(),this.setCallLog(r)))},appPaused:function(){},appResumed:function(){if(!e.isSynced)return;var t=this.getCallLog();if(!t)return;if($.os.android&&t.state!==this.CALL_STATE.IDLE&&e.isNative)return;if(!t.started){this.clearCallLog();return}t.endedOn=t.endedOn||(new Date).getTime();var n=this;this._canLogCall(t)&&e.nomad.showConfirm(e.lang.getAppString("LBL_MOBILE_LOG_CALL_CONFIRM"),function(e){e===2&&n.logCall(t)}),this.clearCallLog()},logCall:function(t){var n=t.endedOn-t.startedOn,r=n/1e3,i=1,s=0;r>60&&(i=r/60,i>60&&(s=i/60,i%=60));var o=e.nomad.getRelationshipLink(t.module,this._callModule),u=t.direction==="Outbound"&&o?e.nomad.buildLinkRoute(t.module,t.recordId,o,null,"createCall"):"createCall";u+="?direction="+t.direction+"&start_date="+(new Date(t.startedOn)).toISOString()+"&duration_hours="+s+"&duration_minutes="+i+"&status=Held",e.router.navigate(u,{trigger:!0})},_canLogCall:function(t){var n=["Employees","Calls"],r=!_.contains(n,t.module),i=e.metadata.getModule(this._callModule),s=i&&e.acl.hasAccess("create",this._callModule),o=t.module==="Users"&&t.recordId===e.user.get("id");return s&&i&&r&&!o},bindCallEnd:function(){var t,n=JSON.stringify([{state:this.CALL_STATE.DIALING}]);this.callStateChanged(n),$.os.android?(t=_.bind(function(){this._pageIsVisible()&&(e.logger.debug("bindCallEnd return handler called"),document.removeEventListener("webkitvisibilitychange",t),this.appResumed())},this),document.addEventListener("webkitvisibilitychange",t,!1)):$.os.ios&&(t=_.bind(function(){window.removeEventListener("pageshow",t),this.appResumed()},this),window.addEventListener("pageshow",t,!1))},_pageIsVisible:function(){return!document.webkitHidden}};e.augment("telephony",t,!1)}(SUGAR.App),function(e){e.baseMetadata={_hash:"_base_",modules:{Teams:{_hash:"TeamsHash",favoritesEnabled:!1,ftsEnabled:!1,mergedFields:["id","name","name_2"],fields:{_hash:"TeamsFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"varchar",unified_search:!0},name_2:{name:"name_2",type:"varchar",unified_search:!0},primary:{name:"primary",type:"boolean"}},views:{list:{meta:{panels:[{fields:[{name:"name",type:"text"},{name:"name_2",type:"varchar"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}}},Login:{_hash:"LoginHash",fields:{_hash:"LoginFieldsHash",username:{name:"username",type:"varchar",required:!0},password:{name:"password",type:"password",required:!0},url:{name:"url",type:"url",required:!0}},views:{login:{meta:{panels:[{label:"Login",fields:[{name:"username",label:"Username"},{name:"password",label:"Password"},{name:"url",label:"URL"}]}]}}},layouts:{login:{meta:{type:"login",components:[{view:"login"}]}}}},About:{_hash:"AboutHash",fields:{_hash:"AboutFieldsHash",app_version:{name:"app_version",type:"varchar"},server_version:{name:"server_version",type:"varchar"},server_url:{name:"server_url",type:"varchar"},support_email:{name:"support_email",type:"url"},support_website:{name:"support_website",type:"url"}},views:{about:{meta:{panels:[{label:"LNK_ABOUT",fields:[{name:"app_version",label:"LBL_MOBILE_APP_VERSION",view:"readonly"},{name:"server_version",label:"LBL_MOBILE_SERVER_VERSION",view:"readonly"},{name:"server_url",label:"LBL_MOBILE_SERVER_URL",view:"readonly"},{name:"support_email",label:"LBL_MOBILE_FEEDBACK",css_class:"support_email hide"},{name:"support_website",label:"LBL_MOBILE_SUPPORT",css_class:"support_website"}]}]}}},layouts:{about:{meta:{type:"about",components:[{view:"about"}]}}}},NomadErrors:{_hash:"NomadErrors",fields:{_hash:"NomadErrorsHash",message:{name:"message",type:"varchar"}},layouts:{error:{meta:{type:"error",components:[{view:"error"}]}}}},Settings:{_hash:"SettingsHash",fields:{_hash:"SettingsFieldsHash",language:{name:"language",type:"enum","default":"en_us"},logging:{name:"logging",type:"enum","default":e.config.logLevel}},views:{settings:{meta:{panels:[{label:"LNK_SETTINGS",fields:[{name:"language",label:"LBL_LANGUAGE",options:"available_language_dom",view:"edit","default":"en_us"},{name:"logging",label:"LBL_LOG_LEVEL",options:["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"],view:"edit","default":e.config.logLevel}]}]}}},layouts:{settings:{meta:{type:"settings",components:[{view:"settings"}]}}}},TxLog:{_hash:"txLogHash",fields:{_hash:"TxLogFieldsHash",_tx_action:{name:"_tx_action"},_tx_bean_module:{name:"_tx_bean_module"},_tx_updated_fields:{name:"_tx_updated_fields"},_tx_error_count:{name:"_tx_error_count"}},views:{list:{meta:{panels:[{label:"XXX",fields:[{name:"_tx_action"},{name:"_tx_bean_module"}]}]}},detail:{meta:{panels:[{label:"XXX",fields:[{name:"_tx_action"},{name:"_tx_bean_module"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}},detail:{meta:{type:"detail",components:[{view:"detail"}]}}}},Offline:{_hash:"OfflineHash",fields:{_hash:"OfflineFieldsHash",language:{name:"language",type:"enum","default":"en_us"},logging:{name:"logging",type:"enum","default":e.config.logLevel}},views:{offline:{meta:{panels:[{label:"LNK_SETTINGS",fields:[]}]}}},layouts:{offline:{meta:{type:"offline",components:[{view:"offline"}]}},offlineSettings:{meta:{type:"offline",components:[{view:"offline-settings"}]}},offlineStats:{meta:{type:"offline",components:[{view:"offline-stats"}]}}}},ErrorEmulation:{_hash:"ErrorEmulationHash",fields:{_hash:"ErrorEmulationHash",language:{name:"language",type:"enum","default":"en_us"}},views:{errors:{meta:{panels:[{label:"LNK_SETTINGS",fields:[]}]}}},layouts:{errorEmulation:{meta:{type:"errors",components:[{view:"error-emulation"}]}}}},ProductTypes:{_hash:"ProductTypesHash",fields:{_hash:"ProductTypesFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"varchar",vname:"LBL_NAME"}},views:{list:{meta:{panels:[{fields:[{name:"name"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["name"],ftsEnabled:!1,favoritesEnabled:!1,_patched:!0},ProductCategories:{_hash:"ProductCategoriesHash",fields:{_hash:"ProductCategoriesFieldsHash",id:{name:"id",vname:"LBL_ID",type:"id",required:!0},name:{name:"name",vname:"LBL_NAME",type:"varchar",len:50,required:!0},parent_id:{name:"parent_id",type:"id",vname:"LBL_PARENT_NAME"},parent_name:{id_name:"parent_id",link:"member_categories",module:"ProductCategories",name:"parent_name",source:"non-db",type:"relate",unified_search:!0,vname:"LBL_PARENT_CATEGORY"}},views:{list:{meta:{panels:[{fields:[{name:"name"},{name:"parent_name"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["name","parent_name","parent_id"],ftsEnabled:!1,favoritesEnabled:!1,_patched:!0},ProductTemplates:{_hash:"ProductTemplatesHash",fields:{_hash:"ProductTemplatesFieldsHash",id:{name:"id",vname:"LBL_ID",type:"id",required:!0},deleted:{name:"deleted",vname:"LBL_DELETED",type:"bool",required:!1,"default":"0"},date_entered:{name:"date_entered",vname:"LBL_DATE_ENTERED",type:"datetime"},date_modified:{name:"date_modified",vname:"LBL_DATE_MODIFIED",type:"datetime"},modified_user_id:{name:"modified_user_id",rname:"user_name",id_name:"modified_user_id",vname:"LBL_MODIFIED_ID",type:"assigned_user_name"},created_by:{name:"created_by",rname:"user_name",id_name:"modified_user_id",vname:"LBL_CREATED_ID",type:"assigned_user_name"},type_id:{name:"type_id",type:"id",required:!1,vname:"LBL_TYPE_ID"},manufacturer_id:{name:"manufacturer_id",type:"id",required:!1,vname:"LBL_LIST_MANUFACTURER_ID"},manufacturer_name:{name:"manufacturer_name",rname:"name",id_name:"manufacturer_id",type:"relate",vname:"LBL_MANUFACTURER_NAME",join_name:"manufacturers",link:"manufacturer_link",module:"Manufacturers"},category_id:{name:"category_id",type:"id",required:!1,vname:"LBL_LIST_CATEGORY_ID"},category_name:{name:"category_name",rname:"name",id_name:"category_id",vname:"LBL_CATEGORY_NAME",join_name:"product_categories",type:"relate",link:"category_link",module:"ProductCategories",source:"non-db"},type_name:{name:"type_name",rname:"name",id_name:"type_id",vname:"LBL_TYPE",join_name:"product_types",type:"relate",link:"type_link",module:"ProductTypes",source:"non-db"},name:{name:"name",vname:"LBL_NAME",type:"varchar",len:50,required:!0},mft_part_num:{name:"mft_part_num",vname:"LBL_MFT_PART_NUM",type:"varchar",len:50},vendor_part_num:{name:"vendor_part_num",vname:"LBL_VENDOR_PART_NUM",type:"varchar",len:50},date_cost_price:{name:"date_cost_price",vname:"LBL_DATE_COST_PRICE",type:"date"},cost_price:{name:"cost_price",vname:"LBL_COST_PRICE",type:"currency",required:!0,len:null},discount_price:{name:"discount_price",vname:"LBL_DISCOUNT_PRICE",required:!0,type:"currency",len:null},list_price:{name:"list_price",vname:"LBL_LIST_PRICE",required:!0,type:"currency",len:null},cost_usdollar:{name:"cost_usdollar",vname:"LBL_COST_USDOLLAR",type:"currency",len:null},discount_usdollar:{name:"discount_usdollar",vname:"LBL_DISCOUNT_USDOLLAR",type:"currency",len:null},list_usdollar:{name:"list_usdollar",vname:"LBL_LIST_USDOLLAR",type:"currency",len:null},currency_id:{name:"currency_id",vname:"LBL_CURRENCY",type:"currency_id",required:!1,"default":"-99"},currency_symbol:{name:"currency_symbol",type:"varchar",vname:"LBL_CURRENCY_SYMBOL_NAME",source:"non-db"},currency:{name:"currency",vname:"LBL_CURRENCY",type:"varchar",required:!1,sortable:!1},status:{name:"status",vname:"LBL_STATUS",type:"enum",options:"product_template_status_dom",len:100},tax_class:{name:"tax_class",vname:"LBL_TAX_CLASS",type:"enum",options:"tax_class_dom",len:100},date_available:{name:"date_available",vname:"LBL_DATE_AVAILABLE",type:"date"},website:{name:"website",vname:"LBL_URL",type:"varchar",len:255},weight:{name:"weight",vname:"LBL_WEIGHT",type:"decimal",len:12,precision:"2"},qty_in_stock:{name:"qty_in_stock",vname:"LBL_QUANTITY",type:"int",len:5},description:{name:"description",vname:"LBL_DESCRIPTION",type:"text"},support_name:{name:"support_name",vname:"LBL_SUPPORT_NAME",type:"varchar",len:50},support_description:{name:"support_description",vname:"LBL_SUPPORT_DESCRIPTION",type:"varchar",len:255},support_contact:{name:"support_contact",vname:"LBL_SUPPORT_CONTACT",type:"varchar",len:50},support_term:{name:"support_term",vname:"LBL_SUPPORT_TERM",type:"enum",options:"support_term_dom",len:100},pricing_formula:{name:"pricing_formula",vname:"LBL_PRICING_FORMULA",type:"varchar",len:100},pricing_factor:{name:"pricing_factor",vname:"LBL_PRICING_FACTOR",type:"decimal",len:8,precision:"2"},created_by_link:{name:"created_by_link",type:"link",relationship:"product_templates_created_by",vname:"LBL_CREATED_BY_USER",link_type:"one",module:"Users",source:"non-db"},modified_user_link:{name:"modified_user_link",type:"link",relationship:"product_templates_modified_user",vname:"LBL_MODIFIED_BY_USER",link_type:"one",module:"Users",source:"non-db"},category_link:{name:"category_link",type:"link",relationship:"product_templates_product_categories",vname:"LBL_PRODUCT_CATEGORIES",link_type:"one",module:"ProductCategories",source:"non-db"},type_link:{name:"type_link",type:"link",relationship:"product_templates_product_types",vname:"LBL_PRODUCT_TYPES",link_type:"one",module:"ProductTypes",source:"non-db"},manufacturer_link:{name:"manufacturer_link",type:"link",relationship:"product_templates_manufacturers",vname:"LBL_MANUFACTURERS",link_type:"one",module:"Manufacturers",source:"non-db"}},views:{list:{meta:{panels:[{fields:[{name:"name",label:"LBL_NAME"},{name:"category_name",label:"LBL_CATEGORY_NAME"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["currency_id","category_id","category_name","cost_price","cost_usdollar","discount_price,","discount_usdollar","list_price","list_usdollar","mft_part_num","name","tax_class","weight"],ftsEnabled:!1,favoritesEnabled:!1,_patched:!0},Manufacturers:{_hash:"ManufacturersHash",fields:{_hash:"ManufacturersFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"name",unified_search:!0}},views:{list:{meta:{panels:[{fields:[{name:"name",label:"LBL_NAME","default":!0,enabled:!0,type:"name"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["name"],ftsEnabled:!1,favoritesEnabled:!1}},relationships:{product_templates_product_types:{lhs_key:"id",lhs_module:"ProductTypes",lhs_table:"product_types",name:"product_templates_product_types",relationship_type:"one-to-many",rhs_key:"type_id",rhs_module:"ProductTemplates",rhs_table:"product_templates"},product_templates_product_categories:{lhs_key:"id",lhs_module:"ProductCategories",lhs_table:"product_categories",name:"product_templates_product_categories",relationship_type:"one-to-many",rhs_key:"category_id",rhs_module:"ProductTemplates",rhs_table:"product_templates"}},app_strings:{LBL_LATER:"Later",LBL_LOADING_FILES:"Still loading document list. Please try again later",LBL_NEW_WEB_VERSION:"A new version of this application is available. Would you like to update?",LBL_MOBILE_DOWNLOAD_FAILED:"Download failed\r\n{{{this}}}",LBL_MOBILE_DETAIL_SHOW_MORE:"More...",LBL_MOBILE_DETAIL_SHOW_LESS:"...Less",LBL_OFFLINE_MODE:"Offline Mode",LBL_OFFLINE_DELETED:"Record not found. It was probably deleted.",LBL_OFFLINE_DELETED_RELATED:"Related record not found. It was probably deleted or unlinked.",LBL_OFFLINE_PREFETCH_PROMPT:"Downloading your assigned, favorited, and followed records for offline access may take some time to complete. A fast connection is recommended. Would you like to proceed?",LBL_OFFLINE_PREFETCH_FIRST_PROMPT:"Do you want your assigned, favorited, and followed records to be downloaded now for offline access? A fast connection is recommended as this operation may take some time. You may download later from Main Menu > Offline.",LBL_OFFLINE_PREFETCH_SUCCESS:"Records downloaded successfully",LBL_OFFLINE_PREFETCH_ACTION:"Download your records...",LBL_OFFLINE_PREFETCH_ERROR:"Error while downloading records",LBL_OFFLINE_PREFETCHING:"Loading records...",LBL_OFFLINE_PREFETCHING_MODULE:"Loading {{module}} {{progressValue}}...",LBL_OFFLINE_PREFETCHING_EST_TIME:"Time left is about {{estimatedTime}}s...",LBL_OFFLINE_PREFETCHING_MODULE_COMPLETE:"Loading {{module}} completed",LBL_OFFLINE_DB_CLEANING_IN_PROGRESS:"Cleaning storage...",LBL_OFFLINE_DB_CLEANING_COMPLETED:"Clean-up completed",LBL_OFFLINE_ROLLBACK_PROMPT:"Do you want to rollback this change?",LBL_OFFLINE_ROLLBACK_SUCCESS:"Rollback completed",LBL_OFFLINE_ROLLBACK_FAILED:"Rollback failed",LBL_OFFLINE_CLEAR_DB:"Clear Storage...",LBL_OFFLINE_COMPACT_DB:"Compact Storage...",LBL_OFFLINE_CLEAN_UP_PROMPT:"This action will delete records you haven't accessed in a while. Proceed?",LBL_OFFLINE_CLEAR_DB_PROMPT:"Do you want to delete all records from the local storage?",LNK_OFFLINE_SETTINGS:"Offline",LBL_OFFLINE_SETTINGS:"Debug settings",LBL_OFFLINE_STATUS_NO_PENDING_TX:"No changes pending synchronization.",LBL_OFFLINE_STATUS_PENDING_TX:"Changes are pending synchronization.",LBL_OFFLINE_STATUS_ONLINE:"Device is online.",LBL_OFFLINE_STATUS_OFFLINE:"Device is offline.",LBL_OFFLINE_STATUS_BAD_NETWORK:"Unable to reach the server.",LBL_OFFLINE_STATUS_SYNC_FAILED:"Last synchronization attempt failed. Check the transaction log.",LBL_OFFLINE_SYNC_IN_PROGRESS:"Synchronization in progress...",LBL_OFFLINE_TRANSACTION_SYNCED:"Transaction synchronized.",LBL_OFFLINE_ENABLE_PROMPT:"Are you sure you want to turn on offline support?",LBL_OFFLINE_DISABLE_PROMPT:"Do you want to turn off offline support? All changes pending synchronization will be lost.",LBL_OFFLINE_ENABLED:"Offline mode enabled",LBL_OFFLINE_DISABLED:"Offline mode disabled",LBL_OFFLINE_STATS:"Storage statistics",LBL_OFFLINE_SERVER_FETCH:"Fetching from server...",LBL_OFFLINE_MERGE_DATA_CONFIRM:"Someone has edited the same record on the server. Confirm to auto-merge your changes or reject to discard them.",LBL_OFFLINE_LAST_SYNC_TS:"Last synchronization attempt: {{ts}}",LBL_ACTION_UPDATE:"UPDATE",LBL_ACTION_CREATE:"CREATE",LBL_ACTION_DELETE:"DELETE",LBL_ACTION_LINK:"LINK",LBL_ACTION_UNLINK:"UNLINK",LBL_ACTION_FAVORITE:"FAVORITE",LBL_ACTION_FOLLOW:"FOLLOW",LBL_ACTION_CREATE_EXPLANATION:'Created {{module}} "{{name}}"',LBL_ACTION_UPDATE_EXPLANATION:'Updated {{module}} "{{name}}"',LBL_ACTION_DELETE_EXPLANATION:'Deleted {{module}} "{{name}}"',LBL_ACTION_LINK_EXPLANATION:'Linked {{module}} "{{name}}" to {{relatedModule}} "{{relatedName}}"',LBL_ACTION_UNLINK_EXPLANATION:'Unlinked {{module}} "{{name}}" from {{relatedModule}} "{{relatedName}}"',LBL_ACTION_FOLLOW_EXPLANATION:'Followed {{module}}: "{{name}}"',LBL_ACTION_UNFOLLOW_EXPLANATION:'Unfollowed {{module}}: "{{name}}"',LBL_ACTION_FAVORITE_EXPLANATION:'Favorited {{module}}: "{{name}}"',LBL_ACTION_UNFAVORITE_EXPLANATION:'Unfavorited {{module}}: "{{name}}"',LBL_ACTION_CREATE_RELATED_EXPLANATION:'Created {{module}} "{{name}}" related to {{relatedModule}} "{{relatedName}}"',LBL_EMAIL_ACTION_SET_PRIMARY:"Primary",LBL_EMAIL_ACTION_SET_OPT_OUT:"Opt-out",LBL_EMAIL_ACTION_SET_OPT_IN:"Opt-in",LBL_EMAIL_ACTION_SET_VALID:"Valid",LBL_EMAIL_ACTION_SET_INVALID:"Invalid",LBL_ROLLBACK_BUTTON:"Rollback",LBL_TX_LOG:"Transaction Log",LBL_TX_LOG_DETAIL:"Transaction Detail",LBL_RECORD_DELETED:"(Record deleted)",LBL_FILE_SIZE_UNITS_B:"Bytes",LBL_FILE_SIZE_UNITS_KB:"kB",LBL_FILE_SIZE_UNITS_MB:"MB",LBL_CHOOSE_ITEMS:"Choose items",LBL_OFFLINE_DB_SIZE:"Database size",LBL_OFFLINE_RECORDS_PER_MODULE:"Records per module",LBL_OFFLINE_TOTAL_RECORDS_COUNT:"Total number of records",ERR_MOBILE_METADATA_CHANGED_RELOAD:"Server configuration has changed and reload is required. Proceed?",ERR_MOBILE_CONFLICT:"Someone has edited the same record on the server. Confirm to auto-merge your changes or reject to discard them.",ERR_MOBILE_METADATA_CHANGED:"Server configuration has changed.",ERR_MOBILE_FILE_READ:"Failed to read the file",ERR_MOBILE_FILE_NOT_FOUND:"File not found",ERR_MOBILE_FILE_NOT_READABLE:"File not readable",ERR_MOBILE_FILE_ABORTED:"Read operation was aborted",ERR_MOBILE_FILE_SECURITY:"File is locked",ERR_MOBILE_VIEW_NOT_SUPPORTED:"Mobile version does not support this functionality. Do you want to open the desktop version?",ERR_OFFLINE:"Offline error",ERR_OFFLINE_STORAGE_UNAVAILABLE:"Failed to open local storage",ERR_OFFLINE_STORAGE_CREATE:"Failed to create local storage",ERR_OFFLINE_START_FAILED_OUT_OF_SPACE:"Failed to create local storage: you've run out of space.",ERR_OFFLINE_OUT_OF_SPACE:"You've run out of space for local storage.",ERR_OFFLINE_DB_CLEANING_ERROR:"Database clean-up failed",ERR_OFFLINE_CLEAN_UP_CONFIRMATION:"You've run out of space for offline storage. Storage clean-up is strongly recommended. Do you want to perform it now?",ERR_OFFLINE_PREFETCH_FAILED:"Failed to prefetch records from server",ERR_OFFLINE_SYNC_ERROR:"Synchronization error",ERR_OFFLINE_SYNC_CONFLICT:"Date modified conflict",ERR_OFFLINE_SERVERTIME_UNAVAILABLE:"Failed to get server time",LBL_OK:"OK",LBL_YES:"Yes",LBL_NO:"No",LBL_CANCEL_BUTTON_LABEL:"Cancel",LBL_MOBILE_RELOGIN_BUTTON:"Re-login",LBL_MOBILE_META_SYNC_FAILED:"Unable to sync with server.",LBL_MOBILE_META_SYNC_FAILED_RETRY:"Unable to sync with server. Retry?",LBL_LOADING:"Loading...",LBL_WARNING:"Warning",LBL_CONFIRM:"Confirm",LNK_ABOUT:"About",LBL_MOBILE_APP_VERSION:"App Version",LBL_MOBILE_SERVER_VERSION:"Server Version",LBL_MOBILE_SERVER_URL:"Server URL",LBL_MOBILE_FEEDBACK:"Feedback",LBL_MOBILE_SUPPORT:"Support",LBL_COPYRIGHT:"Copyright  2004-2014 SugarCRM Inc. All Rights Reserved.",LBL_TRADEMARK:"SugarCRM is a trademark of SugarCRM, Inc. All other company and product names may be trademarks of the respective companies with which they are associated.",LBL_TRADEMARK2:"SugarCRM , Sugar Enterprise and Sugar are trademarks of SugarCRM Inc.",LBL_USERNAME:"Username",LBL_PASSWORD:"Password",LNK_TERMS_OF_USE:"Terms of Use",LNK_PRIVACY_POLICY:"Privacy Policy",LBL_LOGIN:"Log In",LBL_LOG_LEVEL:"Log Level",LBL_NOT_AVAILABLE:"N/A",LBL_USE_HTTPS:"Use secure connection",ERR_SYNC_FAILED:"Unable to sync with server.",ERR_MOBILE_NOT_AUTHORIZED:"Access not authorized.",ERR_MOBILE_INVALID_CREDS:"Invalid username or password.",ERR_MOBILE_SESSION_EXPIRED:"Your session expired.",ERR_MOBILE_NOT_FOUND:"Resource not found.",ERR_MOBILE_TIMEOUT:"Server is not responding.",ERR_MOBILE_CONNECTION_FAILED:"Can't reach the server.",ERR_MOBILE_NOT_FOUND_LOGIN:"No {{{brandName}}} server found at the given URL.",ERR_MOBILE_TIMEOUT_LOGIN:"Server is not responding at the given URL.",ERR_MOBILE_CONNECTION_FAILED_LOGIN:"Server unavailable at the given URL.",ERR_MOBILE_INTERNET_UNAVAILABLE:"Internet connection unavailable.",ERR_MOBILE_INTERNAL:"Internal error ({{{code}}}). Please try again later.",ERR_MOBILE_VALIDATION:"Record is invalid",ERR_SERVER_FLAVOR_INCOMPATIBLE:"Incompatible server flavor: {{{flavor}}}. Supported flavors: {{{supportedFlavors}}}.",ERR_SERVER_VERSION_INCOMPATIBLE:"Incompatible server version: {{{version}}}. Minimum required version: {{{minVersion}}}.",ERR_MOBILE_INCOMPATIBLE_CLIENT_VERSION:"Your app is outdated and is no longer compatible with the {{{brandName}}} instance you are connecting to. Do you want to download the new version from App Store?",ERR_GENERIC_TITLE:"Error"}},e._mod_strings=["LBL_RELATED_RECORD_DEFAULT_NAME","LBL_RELATED_MODULE","LBL_CREATE_RELATED","LBL_CREATE_MODULE","LBL_RELATED_MODULE","LBL_EDIT_RELATED","LBL_EDIT","LBL_ASSOC_EXISTING","LBL_ASSOC","LBL_ASSIGN","LBL_RELATED_MODULE_PLURAL"],e._app_list_strings=["record_type_display","moduleIconList","moduleList","moduleListSingular","available_language_dom"],e._app_strings=_.keys(e.baseMetadata.app_strings).concat(["LBL_LATER","LBL_ACTION_UPDATE","LBL_ACTION_CREATE","LBL_ACTION_DELETE","LBL_ACTION_LINK","LBL_ACTION_UNLINK","LBL_ACTION_FAVORITE","LBL_ACTION_FOLLOW","LBL_ROLLBACK_BUTTON","LBL_UNLINKING","LBL_DELETING","LBL_SAVING","LBL_UNLINKED","LBL_DELETED","LBL_SAVED","LBL_MOBILE_CHOOSE_RECIPIENT","LBL_MOBILE_CHOOSE_PHONE","LBL_MOBILE_CHOOSE_URL","LBL_MOBILE_DOC","LBL_MOBILE_CHOOSE_DOC","LBL_MOBILE_CHOOSE_LOCATION","LBL_MOBILE_WAIT","LBL_MOBILE_LOG_CALL_CONFIRM","LBL_MOBILE_TUTORIAL_HOME_INTRO","LBL_MOBILE_TUTORIAL_HOME_LOGO","LBL_MOBILE_TUTORIAL_HOME_CREATE","LBL_MOBILE_TUTORIAL_HOME_SEARCH","LBL_MOBILE_TUTORIAL_HOME_FAVORITES_BTN","LBL_MOBILE_TUTORIAL_HOME_MY_ITEMS_BTN","LBL_MOBILE_TUTORIAL_HOME_UPCOMING","LBL_MOBILE_TUTORIAL_HOME_RECENT","LBL_MOBILE_TUTORIAL_HOME_FAVORITES_ICON","LBL_MOBILE_TUTORIAL_HOME_GRIP","LBL_MOBILE_TUTORIAL_HOME_END","LBL_MOBILE_TUTORIAL_HOME_MENU_INTRO","LBL_MOBILE_TUTORIAL_HOME_MENU_PROFILE","LBL_MOBILE_TUTORIAL_HOME_MENU_LOGO","LBL_MOBILE_TUTORIAL_HOME_MENU_MODULES","LBL_MOBILE_TUTORIAL_HOME_MENU_SETTINGS","LBL_MOBILE_TUTORIAL_HOME_MENU_DESKTOP","LBL_MOBILE_TUTORIAL_DETAIL_INTRO","LBL_MOBILE_TUTORIAL_DETAIL_RIGHT_ACTION","LBL_MOBILE_TUTORIAL_DETAIL_RECORD_ACTIONS","LBL_MOBILE_TUTORIAL_DETAIL_BACK","LBL_MOBILE_DOWNLOAD_STARTED","LBL_MOBILE_DOWNLOAD_COMPLETED","LBL_UPCOMING","LBL_MOBILE_NO_RECORDS","LBL_RECENTLY_UPDATED","LBL_MOBILE_NO_ACTIONS_AVAILABLE","LBL_DELETE_BUTTON","LBL_SAVE_BUTTON_LABEL","LBL_HOME","LBL_MOBILE_DESKTOP","LBL_LOGOUT","LBL_QUICK_CREATE_TITLE","LBL_SEARCH_ALL_RECORDS","LBL_MOBILE_SEARCH_TEAMS","LBL_SEARCH_ALL","LBL_DONE_BUTTON_LABEL","LBL_OPTIONAL","LBL_CHOOSE_LINK","LBL_NO_ACCESS","LBL_CHOOSE_PARENT_TYPE","LBL_RELATED_MODULE","LBL_MOBILE_UPLOAD_IN_PROGRESS","LBL_MOBILE_UPLOAD_SUCCESS","LBL_MOBILE_PROCESSING_IMAGE","LBL_MOBILE_DELETE_CONFIRM","LBL_DUPLICATE_BUTTON","LBL_CREATE_RELATED_RECORD","LBL_ASSOC_RELATED_RECORD","LBL_MOBILE_SELECT_TEAMS","LBL_CHOOSE_ITEMS","LBL_VIEW_BUTTON","LBL_EDIT_BUTTON","LBL_UNLINK_BUTTON","LBL_CALL_BUTTON","LBL_SMS_BUTTON","LBL_EMAIL_BUTTON","LBL_MAP_BUTTON","LBL_URL_BUTTON","LBL_FILE_BUTTON","LBL_FOLLOW","LBL_UNFOLLOW","LBL_FOLLOWING","LBL_MOBILE_SHOW_MORE_TOP","LBL_MOBILE_SHOW_MORE","LBL_MOBILE_DETAIL_SHOW_MORE","LBL_MOBILE_DETAIL_SHOW_LESS","LBL_MOBILE_PTR_PULL","LBL_MOBILE_PTR_RELEASE","LBL_LOADING_FILES","LBL_MOBILE_UNLINK_CONFIRM","LBL_INVITEES","LBL_SEND_INVITE","LBL_SELECT_ACTION_LABEL","LNK_SETTINGS","LBL_LANGUAGE","LBL_NAME","LBL_TIME_RELATIVE","LBL_TIME_AGO_NOW","LBL_TIME_AGO_SECONDS","LBL_TIME_AGO_MINUTE","LBL_TIME_AGO_MINUTES","LBL_TIME_AGO_HOUR","LBL_TIME_AGO_HOURS","LBL_TIME_AGO_DAY","LBL_TIME_AGO_DAYS","LBL_TIME_AGO_YEAR","LBL_TIME_UNTIL_SECONDS","LBL_TIME_UNTIL_MINUTE","LBL_TIME_UNTIL_MINUTES","LBL_TIME_UNTIL_HOUR","LBL_TIME_UNTIL_HOURS","LBL_TIME_UNTIL_DAY","LBL_TIME_UNTIL_DAYS","LBL_TIME_UNTIL_YEAR","LBL_NOT_AVAILABLE","LBL_FILE_SIZE_UNITS_B","LBL_FILE_SIZE_UNITS_KB","LBL_FILE_SIZE_UNITS_MB","LBL_USE_HTTPS","LBL_REMOVE","LBL_OFFLINE_MODE","LBL_OFFLINE_PREFETCH_PROMPT","LBL_OFFLINE_PREFETCH_FIRST_PROMPT","LBL_OFFLINE_PREFETCH_SUCCESS","LBL_OFFLINE_PREFETCH_ERROR","LBL_OFFLINE_PREFETCH_ACTION","LBL_OFFLINE_PREFETCHING","LBL_OFFLINE_DELETED","LBL_OFFLINE_DELETED_RELATED","LBL_OFFLINE_PREFETCHING_MODULE","LBL_OFFLINE_PREFETCHING_EST_TIME","LBL_OFFLINE_PREFETCHING_MODULE_COMPLETE","LBL_OFFLINE_DB_CLEANING_IN_PROGRESS","LBL_OFFLINE_DB_CLEANING_COMPLETED","LBL_OFFLINE_ROLLBACK_PROMPT","LBL_OFFLINE_ROLLBACK_FAILED","LBL_OFFLINE_ROLLBACK_SUCCESS","LNK_OFFLINE_SETTINGS","LBL_OFFLINE_ENABLE_PROMPT","LBL_OFFLINE_DISABLE_PROMPT","LBL_OFFLINE_ENABLED","LBL_OFFLINE_DISABLED","LBL_OFFLINE_CLEAR_DB","LBL_OFFLINE_COMPACT_DB","LBL_OFFLINE_CLEAN_UP_PROMPT","LBL_OFFLINE_CLEAR_DB_PROMPT","LBL_OFFLINE_SERVER_FETCH","LBL_OFFLINE_MERGE_DATA_CONFIRM","LBL_OFFLINE_LAST_SYNC_TS","LBL_OFFLINE_SYNC_IN_PROGRESS","LBL_OFFLINE_TRANSACTION_SYNCED","LBL_OFFLINE_TOTAL_RECORDS_COUNT","LBL_OFFLINE_DB_SIZE","LBL_OFFLINE_RECORDS_PER_MODULE","LBL_TX_LOG","LBL_TX_LOG_DETAIL","LBL_OFFLINE_SETTINGS","LBL_OFFLINE_STATS","LBL_OFFLINE_STATUS_SUCCESS","LBL_OFFLINE_STATUS_WARNING","LBL_OFFLINE_STATUS_ERROR","LBL_ACTION_CREATE_EXPLANATION","LBL_ACTION_UPDATE_EXPLANATION","LBL_ACTION_DELETE_EXPLANATION","LBL_ACTION_LINK_EXPLANATION","LBL_ACTION_UNLINK_EXPLANATION","LBL_ACTION_FAVORITE_EXPLANATION","LBL_ACTION_FOLLOW_EXPLANATION","LBL_ACTION_UNFOLLOW_EXPLANATION","LBL_ACTION_UNFAVORITE_EXPLANATION","LBL_ACTION_CREATE_RELATED_EXPLANATION","LBL_EMAIL_ACTION_SET_PRIMARY","LBL_EMAIL_ACTION_SET_OPT_OUT","LBL_EMAIL_ACTION_SET_OPT_IN","LBL_EMAIL_ACTION_SET_VALID","LBL_EMAIL_ACTION_SET_INVALID","LBL_EMAIL_ADD","LBL_RECORD_DELETED","ERR_MOBILE_EMAIL","ERR_MOBILE_FILE_NOT_SUPPORTED","ERR_MOBILE_FILE_READ","ERR_MOBILE_FILE_NOT_FOUND","ERR_MOBILE_FILE_NOT_READABLE","ERR_MOBILE_FILE_ABORTED","ERR_MOBILE_FILE_SECURITY","ERR_MOBILE_BROWSER_NOT_AUTHORIZED","ERR_MOBILE_BROWSER_FORBIDDEN","ERR_MOBILE_BROWSER_PAGE_NOT_FOUND","ERR_MOBILE_BROWSER_INTERNAL_SERVER_ERROR","ERR_MOBILE_BROWSER_SERVICE_UNAVAILABLE","ERR_MOBILE_STORAGE_UNAVAILABLE","ERR_MOBILE_GENERIC_NATIVE_ERROR","ERR_MOBILE_FILE_PROCESSING","ERR_MOBILE_METADATA_CHANGED","ERR_NO_DOCS","ERR_MOBILE_UPLOAD","ERR_MOBILE_VALIDATION","ERR_NO_RECORDS_SELECTED","ERR_RENDER_FAILED_TITLE","ERR_RENDER_FAILED_MSG","ERR_RENDER_FIELD_FAILED_MSG","ERR_CONTACT_TECH_SUPPORT","ERR_NO_VIEW_ACCESS_TITLE","ERR_LAYOUT_RENDER_TITLE","ERR_INTERNAL_ERR_MSG","ERROR_MAXVALUE","ERROR_MINVALUE","ERROR_MAX_FIELD_LENGTH","ERROR_MIN_FIELD_LENGTH","ERROR_DATETIME","ERROR_FIELD_REQUIRED","ERROR_EMAIL","ERROR_NUMBER","ERROR_IS_BEFORE","ERROR_IS_AFTER","ERROR_DUPLICATE_EMAIL","ERR_MOBILE_CONFLICT","ERR_MOBILE_VIEW_NOT_SUPPORTED","ERR_OFFLINE","ERR_OFFLINE_STORAGE_UNAVAILABLE","ERR_OFFLINE_STORAGE_CREATE","ERR_OFFLINE_START_FAILED_OUT_OF_SPACE","ERR_OFFLINE_OUT_OF_SPACE","ERR_OFFLINE_CLEAN_UP_CONFIRMATION","ERR_OFFLINE_PREFETCH_FAILED","ERR_OFFLINE_DB_CLEANING_ERROR","ERR_OFFLINE_SYNC_CONFLICT","ERR_OFFLINE_SYNC_ERROR","ERR_OFFLINE_SERVERTIME_UNAVAILABLE","LBL_RELATED_RECORD_DEFAULT_NAME","LBL_RELATED_MODULE","LBL_CREATE_RELATED","LBL_CREATE_MODULE","LBL_RELATED_MODULE","LBL_EDIT_RELATED","LBL_EDIT","LBL_ASSOC_EXISTING","LBL_ASSOC","LBL_ASSIGN","LBL_RELATED_MODULE_PLURAL"])}(SUGAR.App),function(e){var t=[],n=function(e){return _.find(t,function(t){return t.key===e})},r={maxCount:3,has:function(e){return _.isUndefined(this.get(e))?!1:!0},get:function(e){var t=n(e);return t?t.val:undefined},set:function(e,r){if(this.has(e)){var i=n(e);i.val=r}else this.maxCount<=t.length&&t.shift(),t.push({key:e,val:r})},cut:function(e){var n=null;_.find(t,function(t,r){var i=t.key===e;return i&&(n=r),i})&&t.splice(n,1)},cutAll:function(){t=[]}};e.augment("session",r)}(SUGAR.App),function(e){e.plugins.register("clear-field","view",{events:{"keyup input":"checkIfFieldEmpty","focusin input":"checkIfFieldEmpty","touchend .icon-remove-sign":"clearOnClick","touchstart .icon-remove-sign":"preventOnChange"},preventOnChange:function(e){e.preventDefault(),e.stopPropagation()},checkIfFieldEmpty:function(e){var t=$(e.currentTarget);t.val()?t.parent().addClass("not-empty"):t.parent().removeClass("not-empty")},clearOnClick:function(t){var n=$(t.currentTarget).parent().find("input");n.val(""),n.parent().removeClass("not-empty");var r,i,s;n.hasClass("search-query")?(e.trigger("search:clear:clicked"),r=this.$el.find("input"),s=0):(i=n.parents(".control-group").eq(0).parent().index(),s=n.parents(".control-group").find("input").index(n),n.trigger("change"),r=this.$(".pad, .modal-body form").children().eq(i).find("input")),r.get(s).focus(),r.get(s).select(),t.preventDefault(),t.stopPropagation()}})}(SUGAR.App),function(e){e.plugins.register("hide-alerts-onfocus","view",{events:{"focusin.hide input":"fieldOnFocus","touchstart.hide select":"fieldOnFocus"},fieldOnFocus:function(){var t={animate:!1};e.alert.dismissAll(!1,t)}})}(SUGAR.App),function(e){e.plugins.register("fast-click-highlight","view",{events:{"touchstart .fast-click-highlighted":"onTouchStart","touchmove .fast-click-highlighted":"onTouchMove","touchend .fast-click-highlighted":"onTouchEnd","touchcancel .fast-click-highlighted":"onTouchEnd"},onTouchStart:function(e){_.delay(_.bind(function(){!this._flag&&$(e.currentTarget).hasClass("fast-click-highlighted")&&!$(e.target).hasClass("inert")&&!$(e.target).hasClass("grip")&&$(e.currentTarget).addClass("selected-item")},this),50)},onTouchEnd:function(){_.delay(_.bind(function(){this.$el&&(this.$el.find(".selected-item").removeClass("selected-item"),this._flag=!1)},this),50)},onTouchMove:function(){this._flag||this.$el.find(".selected-item").removeClass("selected-item"),this._flag=!0}})}(SUGAR.App),function(e){e.plugins.register("dynamic-layout","view",{dynamicLayoutHash:{},createDynamicLayout:function(t,n,r){var i=e.view.createLayout({className:n,name:t,meta:{}});return i.parentLayout=this.layout,i.isDynamic=!0,_.isArray(r)?_.each(r,function(t){i.addComponent(e.view.createView(t))}):_.isObject(r)&&i.addComponent(e.view.createView(r)),this.dynamicLayoutHash[i.options.name]=i,i},showDynamicLayout:function(t,n){var r=_.isString(t)?this.dynamicLayoutHash[t]:t;r&&(e.nomad.fillContent(!0),r.params=_.extend(n?{track:n.track}:{},r.params||{layout:t}),this.processLayout(r,this.layout,!0,!0,!1),n&&_.isFunction(n.callback)&&n.callback(),e.nomad.clearSelection()),e.routing.emulateBackButton&&e.activeComponents.add("layout-"+t,this.disposeDynamicLayout,this)},disposeDynamicLayout:function(t){if(this.layout&&this.layout.parentLayout){e.nomad.fillContent(!0),e.routing.emulateBackButton&&e.activeComponents.remove("layout-"+this.layout.name),e.isBackPressed=!0,delete this.dynamicLayoutHash[this.layout.name];var n=this.layout.parentLayout;n.params=n.params||{},this.processLayout(n,this.layout,!0,!0,!0),_.isFunction(t)&&t(),e.nomad.clearSelection()}},getRootLayout:function(){var e=this.layout,t;while(e)e.parentLayout&&(t=e.parentLayout),e=e.parentLayout;return t},showRootLayout:function(){this.layout.parentLayout&&this.processLayout(this.getRootLayout(),this.layout,!0,!0,!0)},disposeAllDynamicLayouts:function(){_.each(this.dynamicLayoutHash,function(e){e.dispose()}),this.dynamicLayoutHash={}},isOnDynamicLayout:function(){return!!this.layout.isDynamic},disposeLayout:function(e){e&&this.constructor.prototype.disposeLayout.apply(this,[e,!_.isEmpty(this.dynamicLayoutHash),e.isDynamic])}})}(SUGAR.App),function(e){e.plugins.register("pagination","view",{events:{"click  .show-more-top-btn":"showMoreTopRecords","click  .show-more-bottom-btn":"showMoreBottomRecords"},globalEvents:{"app:layout:show.pagination":function(){this.toggleServerFetchLbl(!1)},"offline:server:read.pagination":function(e){this.toggleServerFetchLbl(e)},"data:sync:success.pagination":function(){(this.needShowMoreTopButton()||this.collection.next_offset===-1&&this.collection.records_count+this.collection.offset>this.getMaxPageSize())&&this.$(".show-more-top-btn").show(),this.collection.next_offset!==-1&&this.$(".show-more-bottom-btn").show(),this.scroll&&this.scroll.reflow()}},showMoreTopRecords:function(){this.showLoadingMsg(".show-more-top-btn",!0);var t=Math.max(this.collection.offset-this.collection.length-e.config.maxQueryResult,0);this.collection.options=null;var n=_.bind(function(e,n){if(n){this.collection.reset([]),this.$(".show-more-top-btn")[t===0?"hide":"show"]();while(n.length)this.collection.add(n.pop(),{addTop:!0,at:0});if(this.collection.length>this.getMaxPageSize())while(this.collection.length>this.getMaxPageSize()){var r=this.collection.pop({silent:!0});this.onItemRemoved(r)}this.collection.next_offset>-1&&this.$(".show-more-bottom-btn").show()}this.showLoadingMsg(".show-more-top-btn",!1)},this);this.collection.fetch({add:!0,relate:!!this.context.get("link"),silent:!0,offset:t,limit:e.config.maxPageSize,fields:this.collection.fields,success:n,error:n})},showMoreBottomRecords:function(){this.showLoadingMsg(".show-more-bottom-btn",!0),this.collection.options=null;var e=_.bind(function(){if(this.collection.length>this.getMaxPageSize()){this.$(".show-more-top-btn").show();while(this.collection.length>this.getMaxPageSize()){var e=this.collection.shift({silent:!0});this.onItemRemoved(e)}}this.showLoadingMsg(".show-more-bottom-btn",!1),this.collection.next_offset===-1&&this.$(".show-more-bottom-btn").hide(),this.scroll&&this.scroll.reflow()},this);this.collection.paginate({add:!0,relate:!!this.context.get("link"),success:e,error:e})},showLoadingMsg:function(e,t){t?(this.$(e+" .show_more_posts").hide(),this.$(e+" .loading-holder").show()):(this.$(e+" .show_more_posts").show(),this.$(e+" .loading-holder").hide())},toggleServerFetchLbl:function(t){if(this instanceof e.view.views.HomeView&&!this.collection.query)return;t?(this.$(".show-more-bottom-btn").hide(),this.$(".no-records-found").hide(),this.$(".server-fetch-lbl").show()):(this.collection.next_offset!==-1&&this.collection.next_offset&&this.$(".show-more-bottom-btn").show(),this.$(".server-fetch-lbl").hide(),this.collection.length?this.$(".no-records-found").hide():this.$(".no-records-found").show()),this.scroll&&this.scroll.reflow()},needShowMoreTopButton:function(){return this.collection.offset>this.getMaxPageSize()},needShowMoreBottomBtn:function(){return this.collection.models.length&&this.collection.next_offset!==-1}})}(SUGAR.App),function(e){_.extend(e.nomad,{preInit:function(t,n){t.app.version=e.config.appVersion,t.app.build=e.config.appBuild,t.device=$.os,window.navigator.standalone&&window.location.replace("#home"),this.initAppCache(),this.initAnalytics(),!e.config.allowBrowserContextMenu&&$.browser.chromeMobile&&window.addEventListener("contextmenu",function(e){e.preventDefault()});if(!this._isPlatformSupported()){e.error.handleNotSupportedPlatform();return}e.offline&&e.config.offline&&(e.config.offline.storageAdapter="webSql"),n()},initAppCache:function(){var t=window.applicationCache;if(!t)return;t.addEventListener("updateready",function(n){e.nomad.showConfirm(e.lang.getAppString("LBL_NEW_WEB_VERSION"),function(){e.logger.debug("Swapping application cache and reloading page"),t.swapCache(),window.location.reload()})},!1)},_showConfirm:function(e,t,n,r){var i=confirm(e),s=i?2:1;t(s)},_showAlert:function(e,t,n,r){alert(e),t&&t()},_getConsoleLogFilename:function(e){e()},_showEmailComposer:function(e,t,n){window.location="mailto:"+n+"?subject="+(e||"")+"&body="+(t||"")},_showSmsComposer:function(e,t){window.location="sms:"+e},_callPhone:function(e){window.location="tel:"+e},_browseUrl:function(e){window.open(e)},openAppStore:function(){},_browseDoc:function(e){e.oauth?this._downloadDoc(e):this._browseUrl(e.url)},_downloadDoc:function(t){var n=new window.XMLHttpRequest,r="download_doc";n.open("GET",t.url),n.addEventListener("loadend",_.bind(function(){e.alert.dismiss(r);var i=this._getBlob(n.response,t.file_mime_type);this._makeBlobUrl(i,function(e){window.location=e})},this),!1),n.setRequestHeader("OAuth-Token",e.api.getOAuthToken()),n.overrideMimeType("application/octet-stream; charset=x-user-defined"),n.responseType="arraybuffer",n.send(null),e.alert.show(r,{level:"info",messages:e.lang.get("LBL_MOBILE_DOWNLOAD_STARTED",null,t.filename),autoClose:!0,closeable:!1})},_getBlob:function(e,t){var n;try{n=new Blob([e],{type:t})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(r.name=="TypeError"&&window.BlobBuilder){var i=new BlobBuilder;i.append([e.buffer]),n=i.getBlob(t)}else{if(r.name!="InvalidStateError")throw r;n=new Blob([e.buffer],{type:t})}}return n},_makeBlobUrl:function(t,n){var r=window.URL||window.webkitURL,i=$.os.ios&&(e.utils.versionCompare($.os.version,7,"<")||$.browser.chromeMobile);if(r&&!i)n(r.createObjectURL(t));else{var s=new window.FileReader;s.onloadend=function(){n(s.result)},s.readAsDataURL(t)}},_showActionSheet:function(t,n,r,i){e.view.ActionSheet.show(t,n,r,i)},_showDateTimePicker:function(e,t,n){},initAnalytics:function(){function e(){window.ga&&ga.apply(window,arguments)}Analytics=function(){},_.extend(Analytics.prototype,{start:function(t,n){e("create",t,"none"),n.optOut&&(window["ga-disable-"+t]=!0),e("set","anonymizeIp",n.anonymize)},startSession:function(){},trackPageView:function(t){e("send","pageview",t)},trackEvent:function(t){e("send","event",t.category,t.action,t.label,t.value)},setDimension:function(t){e("set","dimension"+t.index,t.value)},setMetric:function(t){e("set","metric"+t.index,t.value)}}),analytics=new Analytics},loadAnalytics:function(){(function(e,t,n,r,i,s,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(n),o=t.getElementsByTagName(n)[0],s.async=1,s.src=r,o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga")},getConnectionType:function(){return"none"},isOnline:function(){return window.navigator.onLine},_isPlatformSupported:function(){return $.os.ios?e.utils.versionCompare($.os.version,"6",">="):$.os.android&&$.browser.chrome?!0:$.os.desktop?!0:e.config.env==="dev"}})}(SUGAR.App)